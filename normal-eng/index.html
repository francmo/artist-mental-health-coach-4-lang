
<!DOCTYPE html>
<html lang="en">
<!--
  Artist Mental Health Coach
  Designed and developed by: Francesco Mariano
  2023
  Contact: francescomariano@gmail.com
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Mental Health Coach</title>

    <meta name="description" content="A mental wellness coach dedicated to Students and Artists. Track your mood, practice creative exercises, and receive personalized support.">
    <meta name="author" content="Francesco Mariano">

    <meta property="og:title" content="Artist Mental Health Coach">
    <meta property="og:description" content="A mental wellness coach dedicated to Students and Artists. Track your mood, practice creative exercises, and receive personalized support.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://francmo.github.io/artist-mental-health-coach-4-lang/assets/og-preview.png?v=2">
    <meta property="og:url" content="https://yourdomain.com">
    <meta property="og:site_name" content="Artist Mental Health Coach">
    <meta property="og:locale" content="en_US">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Artist Mental Health Coach">
    <meta name="twitter:description" content="A mental wellness coach dedicated to Students and Artists. Track your mood, practice creative exercises, and receive personalized support.">
    <meta name="twitter:image" content="https://i.imgur.com/placeholder.png">

    <meta name="theme-color" content="#7dd3c0">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK (versione 10.x compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #e8f5f1 0%, #d4f1e8 100%);
            overflow-x: hidden;
        }

        /* Wellness Gradient Background */
        .gradient-art {
            background: linear-gradient(135deg, #7dd3c0 0%, #a8d5ba 50%, #f0f8f5 100%);
            position: relative;
            overflow: hidden;
        }

        /* Calming fog effect */
        .gradient-art::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse at 50% 100%, rgba(168, 213, 186, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 50%, rgba(125, 211, 192, 0.2) 0%, transparent 50%),
                radial-gradient(ellipse at 100% 50%, rgba(125, 211, 192, 0.2) 0%, transparent 50%);
            animation: cloudMove 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes cloudMove {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 0.6; transform: translateY(-20px); }
        }

        /* Floating butterflys */
        @keyframes butterflyFloat {
            0% { transform: translateX(-100px) translateY(0) scale(1); }
            25% { transform: translateX(25vw) translateY(-30px) scale(0.8); }
            50% { transform: translateX(50vw) translateY(20px) scale(1.1); }
            75% { transform: translateX(75vw) translateY(-10px) scale(0.9); }
            100% { transform: translateX(calc(100vw + 100px)) translateY(0) scale(1); }
        }

        .butterfly {
            position: fixed;
            font-size: 24px;
            animation: butterflyFloat 15s linear infinite;
            z-index: 1000;
            pointer-events: none;
            opacity: 0.7;
        }

        .butterfly:nth-child(2) { animation-delay: 5s; top: 20%; }
        .butterfly:nth-child(3) { animation-delay: 10s; top: 60%; animation-duration: 18s; }

        /* Floating flowers */
        @keyframes flowerFloat {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0.6; }
            25% { transform: translateY(-20px) translateX(10px); opacity: 0.8; }
            50% { transform: translateY(-10px) translateX(-10px); opacity: 0.6; }
            75% { transform: translateY(-30px) translateX(5px); opacity: 0.7; }
        }

        .flower {
            position: fixed;
            font-size: 32px;
            animation: flowerFloat 6s ease-in-out infinite;
            z-index: 999;
            pointer-events: none;
        }

        .flower:nth-child(2) { animation-delay: 2s; right: 10%; top: 20%; animation-duration: 8s; }
        .flower:nth-child(3) { animation-delay: 4s; left: 15%; bottom: 20%; animation-duration: 7s; }

        /* Flower pulse */
        @keyframes flowerPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3); }
        }

        .flower {
            display: inline-block;
            animation: flowerPulse 2s ease-in-out infinite;
        }

        

        

        /* Card hover with calming effect */
        .card-hover {
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid rgba(125, 211, 192, 0.3);
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(10px);
        }

        .card-hover:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow:
                0 20px 40px -5px rgba(125, 211, 192, 0.5),
                0 0 20px rgba(168, 213, 186, 0.3),
                inset 0 0 20px rgba(125, 211, 192, 0.1);
            border-color: rgba(125, 211, 192, 0.6);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes calmGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(125, 211, 192, 0.5); }
            50% { box-shadow: 0 0 30px rgba(125, 211, 192, 0.8), 0 0 50px rgba(168, 213, 186, 0.6); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }

        .animate-slideIn {
            animation: slideIn 0.3s ease-out;
        }

        .calm-glow {
            animation: calmGlow 2s ease-in-out infinite;
        }

        /* Pianta animata */
        .butterfly-float {
            position: fixed;
            font-size: 4.5em;
            z-index: 9999;
            animation: floatAround 25s linear infinite, plantBounce 0.4s ease-in-out infinite, plantShake 0.1s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(125, 211, 192, 0.6));
        }

        @keyframes floatAround {
            0% { top: -5%; left: 0%; }
            10% { top: 10%; left: 15%; }
            20% { top: 25%; left: 30%; }
            30% { top: 15%; left: 50%; }
            40% { top: 40%; left: 70%; }
            50% { top: 60%; left: 85%; }
            60% { top: 75%; left: 65%; }
            70% { top: 80%; left: 40%; }
            80% { top: 55%; left: 20%; }
            90% { top: 30%; left: 5%; }
            100% { top: -5%; left: 0%; }
        }

        @keyframes plantBounce {
            0%, 100% { transform: translateY(0) rotate(var(--plant-angle, 0deg)); }
            50% { transform: translateY(-8px) rotate(var(--plant-angle, 0deg)); }
        }

        @keyframes plantShake {
            0%, 100% { transform: translateX(0) translateY(var(--bounce-y, 0)) rotate(var(--plant-angle, 0deg)); }
            25% { transform: translateX(-2px) translateY(var(--bounce-y, 0)) rotate(var(--plant-angle, 0deg)); }
            75% { transform: translateX(2px) translateY(var(--bounce-y, 0)) rotate(var(--plant-angle, 0deg)); }
        }

        /* Animazioni mood selezionato */
        @keyframes moodSelect {
            0% { transform: scale(1); }
            50% { transform: scale(2.5); }
            100% { transform: scale(1); }
        }

        @keyframes showCheckmark {
            0% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        .mood-selected {
            animation: moodSelect 0.8s ease-in-out;
            position: relative;
        }

        .mood-selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            color: #10b981;
            font-weight: bold;
            animation: showCheckmark 0.5s ease-out 0.4s both;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
        }

        /* Plant that moves toward target with fluid animation */
        .plant-run-to-target {
            animation: plantBounce 0.3s ease-in-out infinite, plantShake 0.08s ease-in-out infinite !important;
            transition: top 1.5s cubic-bezier(0.1, 0.3, 0.4, 1),
                        left 1.5s cubic-bezier(0.1, 0.3, 0.4, 1),
                        transform 0.1s ease-in-out !important;
        }

        /* Pianta spaventata si muove velocemente */
        .plant-scared {
            animation: plantBounce 0.2s ease-in-out infinite, plantShake 0.08s ease-in-out infinite !important;
            transition: top 1.2s cubic-bezier(0.4, 0.1, 0.3, 1),
                        left 1.2s cubic-bezier(0.4, 0.1, 0.3, 1) !important;
            filter: drop-shadow(0 0 20px rgba(255, 183, 197, 0.8)) !important;
        }

        /* Wellness text colors */
        .text-wellness-primary { color: #7dd3c0; }
        .text-wellness-secondary { color: #a8d5ba; }
        .text-wellness-accent { color: #b8e6d5; }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #e8f5f1;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #7dd3c0, #a8d5ba);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #b8e6d5, #7dd3c0);
        }
    </style>
</head>
<body>
    <!-- Wellness Decorations -->
    <div class="butterfly" style="top: 10%;">🦋</div>
    <div class="butterfly" style="top: 30%;">🦋</div>
    <div class="butterfly" style="top: 70%;">🦋</div>

    <div class="flower" style="right: 20%; top: 15%;">🌸</div>
    <div class="flower" style="left: 25%; top: 40%;">🌸</div>
    <div class="flower" style="right: 15%; bottom: 30%;">🌸</div>

    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Heart = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>;
        const BookOpen = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const Wind = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg>;
        const TrendingUp = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>;
        const Palette = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>;
        const Sparkles = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>;
        const Zap = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>;
        const Award = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="8" r="7" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.21 13.89L7 23l5-3 5 3-1.21-9.12" /></svg>;
        const Clock = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6l4 2" /></svg>;
        const Settings = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><circle cx="12" cy="12" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/></svg>;
        const Shuffle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 3h5m0 0v5m0-5l-6 6M9 9L4 4m11 11l6 6m-6 0v-5m0 5h5" /></svg>;
        const Bot = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="10" x="3" y="11" rx="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="12" cy="5" r="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 7v4M8 16h.01M16 16h.01" /></svg>;
        const RefreshCw = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M1 4v6h6M23 20v-6h-6" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15" /></svg>;
        const CheckCircle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const X = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
        const Info = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 16v-4M12 8h.01" /></svg>;
        const Key = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>;
        const AlertCircle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4M12 16h.01" /></svg>;
        const Calendar = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="4" rx="2" ry="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 2v4M8 2v4M3 10h18" /></svg>;
        const Lightbulb = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>;
        const Volume2 = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07" /></svg>;
        const Timer = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="13" r="9" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v5l3 3M9 2h6" /></svg>;
        const Play = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3l14 9-14 9V3z" /></svg>;
        const Pause = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 4h4v16H6zM14 4h4v16h-4z" /></svg>;
        const RotateCcw = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M1 4v6h6M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></svg>;
        const Camera = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z" /><circle cx="12" cy="13" r="4" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/></svg>;
        const Upload = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" /></svg>;
        const ImageIcon = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="8.5" cy="8.5" r="1.5" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 15l-5-5L5 21" /></svg>;
        const BarChart = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 20V10M12 20V4M6 20v-6" /></svg>;
        const Brain = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 9.75a3.75 3.75 0 015.25 5.25m1.5-8.5a3.75 3.75 0 01-4.5 6m-3.75-3.75A3.75 3.75 0 014.5 15M15 3.75c2.5 0 4.5 2 4.5 4.5s-2 4.5-4.5 4.5M9 3.75C6.5 3.75 4.5 5.75 4.5 8.25s2 4.5 4.5 4.5" /></svg>;
        const FileText = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 2v6h6M16 13H8M16 17H8M10 9H8" /></svg>;
        const Trash2 = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" /></svg>;
        const ChevronRight = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
        const HelpCircle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3M12 17h.01" /></svg>;

        // Wellness Icons
        const Flower = ({ className = "w-6 h-6" }) => <span className={`${className} flower`} style={{fontSize: '2.5em'}}>🌺</span>;
        const Butterfly = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>🦋</span>;
        const Leaf = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>🍃</span>;
        const Plant = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>🌿</span>;
        const HealthyFood = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>🥗</span>;
        const User = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>;
        const UserPlus = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" /></svg>;
        const LogOut = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>;
        const Cloud = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>;
        const Share2 = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="6" cy="12" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="18" cy="19" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98" /></svg>;

        // Initialize Firebase with your configuration
        const firebaseConfig = {
          apiKey: "AIzaSyA6k76_p6x8pBGWKd6dQe5xfDPqBR_tJjc",
          authDomain: "artist-mental-health.firebaseapp.com",
          projectId: "artist-mental-health",
          storageBucket: "artist-mental-health.firebasestorage.app",
          messagingSenderId: "66082074143",
          appId: "1:66082074143:web:7aa589564b946274ad2f2a"
        };

        // Initialize Firebase only if not already initialized
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        const MentalHealthCoachArte = () => {
          const [currentView, setCurrentView] = useState('home');
          const [moodHistory, setMoodHistory] = useState(() => {
            const saved = localStorage.getItem('moodHistory');
            return saved ? JSON.parse(saved) : [];
          });
          const [journalEntries, setJournalEntries] = useState(() => {
            const saved = localStorage.getItem('journalEntries');
            return saved ? JSON.parse(saved) : [];
          });
          const [currentMood, setCurrentMood] = useState(null);
          const [selectedMoodId, setSelectedMoodId] = useState(null);
          const [plantTarget, setPlantTarget] = useState(null);
          const [plantScared, setPlantScared] = useState(false);
          const [geminiApiKey, setGeminiApiKey] = useState(localStorage.getItem('gemini_api_key') || '');
          const [showApiSetup, setShowApiSetup] = useState(false);
          const [selectedExercise, setSelectedExercise] = useState(null);
          const [currentVariant, setCurrentVariant] = useState(null);
          const [isGenerating, setIsGenerating] = useState(false);
          const [showExamples, setShowExamples] = useState(false);

          const [timerActive, setTimerActive] = useState(false);
          const [timerSeconds, setTimerSeconds] = useState(0);
          const [timerDuration, setTimerDuration] = useState(0);
          const [uploadedImages, setUploadedImages] = useState(() => {
            const saved = localStorage.getItem('uploadedImages');
            return saved ? JSON.parse(saved) : [];
          });
          const [showInsights, setShowInsights] = useState(false);
          const [generatingReport, setGeneratingReport] = useState(false);
          const [uploadSuccess, setUploadSuccess] = useState(false);
          const [lastUploadedImage, setLastUploadedImage] = useState(null);
          const [journalSaved, setJournalSaved] = useState(false);
          const [apiKeySaved, setApiKeySaved] = useState(false);
          const [successMessage, setSuccessMessage] = useState({ show: false, message: '', type: 'success' });
          const [savedReports, setSavedReports] = useState(() => {
            const saved = localStorage.getItem('aiReports');
            return saved ? JSON.parse(saved) : [];
          });
          const [showReportModal, setShowReportModal] = useState(false);
          const [currentReport, setCurrentReport] = useState(null);
          const [showGuide, setShowGuide] = useState(false);
          const [showContactForm, setShowContactForm] = useState(false);

          // Stati profilo utente (localStorage - per guest mode)
          const [userProfile, setUserProfile] = useState(() => {
            const saved = localStorage.getItem('userProfile');
            return saved ? JSON.parse(saved) : null;
          });
          const [showProfileModal, setShowProfileModal] = useState(false);
          const [showProfileBenefits, setShowProfileBenefits] = useState(false);

          // Stati Firebase Authentication
          const [firebaseUser, setFirebaseUser] = useState(null);
          const [authLoading, setAuthLoading] = useState(true);
          const [showFirebaseAuth, setShowFirebaseAuth] = useState(false);
          const [useCloudSync, setUseCloudSync] = useState(false);

          useEffect(() => {
            localStorage.setItem('moodHistory', JSON.stringify(moodHistory));
          }, [moodHistory]);

          useEffect(() => {
            localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
          }, [journalEntries]);

          useEffect(() => {
            localStorage.setItem('uploadedImages', JSON.stringify(uploadedImages));
          }, [uploadedImages]);

          useEffect(() => {
            localStorage.setItem('aiReports', JSON.stringify(savedReports));
          }, [savedReports]);

          // Salva profilo utente locale
          useEffect(() => {
            if (userProfile) {
              localStorage.setItem('userProfile', JSON.stringify(userProfile));
            }
          }, [userProfile]);

          // Monitor autenticazione Firebase
          useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(async (user) => {
              console.log('🔥 Firebase Auth State:', user ? user.email : 'No user');
              setFirebaseUser(user);
              setAuthLoading(false);

              // If user is logged in, load data from Firestore
              if (user) {
                setUseCloudSync(true);
                try {
                  const userDoc = await db.collection('users').doc(user.uid).get();
                  if (userDoc.exists) {
                    const data = userDoc.data();
                    console.log('📥 Loaded data from cloud:', data);
                    if (data.moodHistory) setMoodHistory(data.moodHistory);
                    if (data.journalEntries) setJournalEntries(data.journalEntries);
                    if (data.uploadedImages) setUploadedImages(data.uploadedImages);
                    if (data.savedReports) setSavedReports(data.savedReports);
                  }
                } catch (err) {
                  console.error('Error loading data:', err);
                }
              }
            });
            return () => unsubscribe();
          }, []);

          // Synchronize moodHistory to Firestore when user is logged in
          useEffect(() => {
            if (firebaseUser && useCloudSync && moodHistory.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                moodHistory: moodHistory
              }, { merge: true })
              .then(() => console.log('💾 moodHistory synchronized'))
              .catch(err => console.error('Error syncing moodHistory:', err));
            }
          }, [moodHistory, firebaseUser, useCloudSync]);

          // Synchronize journalEntries to Firestore
          useEffect(() => {
            if (firebaseUser && useCloudSync && journalEntries.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                journalEntries: journalEntries
              }, { merge: true })
              .then(() => console.log('💾 journalEntries synchronized'))
              .catch(err => console.error('Error syncing journalEntries:', err));
            }
          }, [journalEntries, firebaseUser, useCloudSync]);

          // Synchronize uploadedImages to Firestore
          useEffect(() => {
            if (firebaseUser && useCloudSync && uploadedImages.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                uploadedImages: uploadedImages
              }, { merge: true })
              .then(() => console.log('💾 uploadedImages synchronized'))
              .catch(err => console.error('Error syncing uploadedImages:', err));
            }
          }, [uploadedImages, firebaseUser, useCloudSync]);

          // Synchronize savedReports to Firestore
          useEffect(() => {
            if (firebaseUser && useCloudSync && savedReports.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                savedReports: savedReports
              }, { merge: true })
              .then(() => console.log('💾 savedReports synchronized'))
              .catch(err => console.error('Error syncing savedReports:', err));
            }
          }, [savedReports, firebaseUser, useCloudSync]);

          useEffect(() => {
            console.log('geminiApiKey changed:', geminiApiKey ? 'PRESENT (' + geminiApiKey.substring(0, 10) + '...)' : 'ABSENT');
          }, [geminiApiKey]);

          useEffect(() => {
            let interval;
            if (timerActive && timerSeconds > 0) {
              interval = setInterval(() => {
                setTimerSeconds(prev => {
                  if (prev <= 1) {
                    setTimerActive(false);
                    playSound();
                    showNotification('Timer completed!', 'Your exercise time is up.');
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [timerActive, timerSeconds]);

          const playSound = () => {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
          };

          const showNotification = (title, body) => {
            if ('Notification' in window && Notification.permission === 'granted') {
              new Notification(title, { body, icon: '🎨' });
            } else if ('Notification' in window && Notification.permission !== 'denied') {
              Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                  new Notification(title, { body, icon: '🎨' });
                }
              });
            }
          };

          const showSuccessMessage = (message, duration = 2000) => {
            setSuccessMessage({ show: true, message, type: 'success' });
            setTimeout(() => setSuccessMessage({ show: false, message: '', type: 'success' }), duration);
          };

          const parseDuration = (durationStr) => {
            const match = durationStr.match(/(\d+)\s*(min|sec|h)/i);
            if (!match) return 300;
            const value = parseInt(match[1]);
            const unit = match[2].toLowerCase();
            if (unit === 'sec') return value;
            if (unit === 'min') return value * 60;
            if (unit === 'h') return value * 3600;
            return 300;
          };

          const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          const startTimer = (duration) => {
            const seconds = parseDuration(duration);
            setTimerDuration(seconds);
            setTimerSeconds(seconds);
            setTimerActive(true);
            showNotification('Timer started!', `Timer set for ${duration}`);
          };

          const pauseTimer = () => {
            setTimerActive(false);
          };

          const resumeTimer = () => {
            setTimerActive(true);
          };

          const resetTimer = () => {
            setTimerActive(false);
            setTimerSeconds(0);
            setTimerDuration(0);
          };

          const resizeImage = (file, maxWidth = 300, maxHeight = 300) => {
            console.log('resizeImage called for file:', file.name, 'type:', file.type, 'size:', file.size, 'bytes');

            return new Promise((resolve, reject) => {
              const reader = new FileReader();

              reader.onload = (e) => {
                console.log('FileReader completato');
                const dataUrl = e.target.result;

                const img = new window.Image();

                img.onload = () => {
                  try {
                    console.log('Image loaded, original dimensions:', img.width, 'x', img.height);

                    if (img.width <= maxWidth && img.height <= maxHeight) {
                      console.log('Image already small enough, using original');
                      resolve(dataUrl);
                      return;
                    }

                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width = Math.floor(width * ratio);
                    height = Math.floor(height * ratio);

                    console.log('Ridimensiono a:', width, 'x', height);

                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d', { alpha: false });
                    if (!ctx) {
                      console.error('Impossibile ottenere context 2d');
                      resolve(dataUrl);
                      return;
                    }

                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, width, height);
                    ctx.drawImage(img, 0, 0, width, height);

                    console.log('Converting to JPEG...');
                    const resizedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    console.log('OK! Final size:', resizedDataUrl.length, 'characters');
                    resolve(resizedDataUrl);

                  } catch (err) {
                    console.error('Error during resize:', err);
                    console.log('Using original image as fallback');
                    resolve(dataUrl);
                  }
                };

                img.onerror = () => {
                  console.error('Error loading image, using original dataUrl');
                  resolve(dataUrl);
                };

                img.src = dataUrl;
              };

              reader.onerror = (err) => {
                console.error('Error reading file:', err);
                reject(new Error('Unable to read file'));
              };

              reader.readAsDataURL(file);
            });
          };

          const handleImageUpload = async (file) => {
            console.log('handleImageUpload called, geminiApiKey:', geminiApiKey ? 'PRESENT' : 'ABSENT');

            if (!geminiApiKey || geminiApiKey.trim() === '') {
              console.log('API key missing, opening configuration modal');
              alert('⚠️ API Key required! Please configure your API key first to upload images.');
              setShowApiSetup(true);
              return;
            }

            const validTypes = ['image/', '.heic', '.heif'];
            const isValid = validTypes.some(type =>
              file.type.startsWith(type) || file.name.toLowerCase().endsWith(type)
            );

            if (!file || !isValid) {
              alert('⚠️ Please upload a valid image file (jpg, png, heic, etc.)');
              return;
            }

            try {
              console.log('Starting image upload and resize...');
              setIsGenerating(true);

              const resizedDataUrl = await resizeImage(file);
              console.log('Image resized, starting AI analysis...');

              const imageData = {
                id: Date.now(),
                dataUrl: resizedDataUrl,
                uploadDate: new Date().toISOString(),
                exerciseId: selectedExercise,
                exerciseTitle: currentVariant?.title || 'Exercise',
                aiComment: null
              };

              try {
                console.log('Calling generateImageComment...');
                const comment = await generateImageComment(resizedDataUrl);
                console.log('Comment received:', comment ? 'YES' : 'NO');
                imageData.aiComment = comment;
              } catch (error) {
                console.error('Error generating comment:', error);
                imageData.aiComment = 'Error: ' + error.message;
              }

              setUploadedImages(prev => [imageData, ...prev]);
              setLastUploadedImage(imageData);
              setUploadSuccess(true);
              setTimeout(() => {
                setUploadSuccess(false);
                setLastUploadedImage(null);
              }, 10000);
              console.log('Upload completed successfully!');
            } catch (error) {
              console.error('Image upload error:', error);
              alert('❌ Error during image upload: ' + error.message);
            } finally {
              setIsGenerating(false);
            }
          };

          const generateImageComment = async (imageDataUrl) => {
            console.log('generateImageComment called');

            if (!geminiApiKey) {
              console.log('No API key, returning null');
              return null;
            }

            try {
              const base64Image = imageDataUrl.split(',')[1];
              console.log('Base64 estratto, lunghezza:', base64Image.length);

              const controller = new AbortController();
              const timeoutId = setTimeout(() => controller.abort(), 15000);

              console.log('Invio richiesta a Gemini API...');
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiApiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  signal: controller.signal,
                  body: JSON.stringify({
                    contents: [{
                      parts: [
                        {
                          text: "You are an empathetic and encouraging art critic for students and artists. Analyze this artwork in a natural and conversational way. Start by commenting on what works well in the piece in a specific way. Then offer a practical suggestion for improvement. Conclude with an encouraging note. Write in a fluid and direct manner, without labeling sections (DON'T write 'Positive comment:', 'Suggestion:', etc.). Be brief (max 4 sentences) but specific and sincere. Start directly with the content, without meta-textual introductions."
                        },
                        {
                          inline_data: {
                            mime_type: "image/jpeg",
                            data: base64Image
                          }
                        }
                      ]
                    }],
                    generationConfig: {
                      temperature: 0.7,
                      maxOutputTokens: 500,
                    }
                  })
                }
              );

              clearTimeout(timeoutId);
              console.log('Response received, status:', response.status);

              if (!response.ok) {
                const errorText = await response.text();
                console.error('API Error:', response.status, errorText);
                throw new Error(`API Error: ${response.status} - ${errorText}`);
              }

              const data = await response.json();
              console.log('Dati parsati:', data);
              const comment = data.candidates[0].content.parts[0].text;
              console.log('Commento estratto:', comment);
              return comment;
            } catch (error) {
              console.error('Error generating image comment:', error);
              if (error.name === 'AbortError') {
                return 'Timeout: comment generation took too long. Image saved anyway! 🎨';
              }
              return 'Analysis error: ' + error.message;
            }
          };

          const deleteImage = (imageId) => {
            if (confirm('Are you sure you want to delete this image?')) {
              setUploadedImages(prev => prev.filter(img => img.id !== imageId));
            }
          };

          const calculateMoodStats = () => {
            if (moodHistory.length === 0) return null;

            const moodCounts = moodHistory.reduce((acc, entry) => {
              acc[entry.mood] = (acc[entry.mood] || 0) + 1;
              return acc;
            }, {});

            const totalMoods = moodHistory.length;
            const avgMood = moodHistory.reduce((sum, entry) => sum + entry.mood, 0) / totalMoods;

            const now = new Date();
            const sevenDaysAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
            const fourteenDaysAgo = new Date(now - 14 * 24 * 60 * 60 * 1000);

            const recentMoods = moodHistory.filter(e => new Date(e.date) >= sevenDaysAgo);
            const previousMoods = moodHistory.filter(e => {
              const d = new Date(e.date);
              return d >= fourteenDaysAgo && d < sevenDaysAgo;
            });

            const recentAvg = recentMoods.length > 0
              ? recentMoods.reduce((sum, e) => sum + e.mood, 0) / recentMoods.length
              : avgMood;
            const previousAvg = previousMoods.length > 0
              ? previousMoods.reduce((sum, e) => sum + e.mood, 0) / previousMoods.length
              : avgMood;

            const trend = recentAvg - previousAvg;

            return { moodCounts, avgMood, trend, recentMoods, totalMoods };
          };

          const findMoodPatterns = () => {
            const stats = calculateMoodStats();
            if (!stats) return [];

            const patterns = [];

            const dayOfWeekMoods = {};
            moodHistory.forEach(entry => {
              const day = new Date(entry.date).getDay();
              if (!dayOfWeekMoods[day]) dayOfWeekMoods[day] = [];
              dayOfWeekMoods[day].push(entry.mood);
            });

            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayAverages = Object.entries(dayOfWeekMoods).map(([day, moods]) => ({
              day: dayNames[day],
              avg: moods.reduce((a, b) => a + b, 0) / moods.length
            })).sort((a, b) => a.avg - b.avg);

            if (dayAverages.length > 0) {
              const worstDay = dayAverages[0];
              const bestDay = dayAverages[dayAverages.length - 1];
              if (worstDay.avg < 3) {
                patterns.push({
                  type: 'warning',
                  title: `${worstDay.day} is your most difficult day`,
                  description: `Average mood: ${worstDay.avg.toFixed(1)}/5`
                });
              }
              if (bestDay.avg > 3.5) {
                patterns.push({
                  type: 'positive',
                  title: `${bestDay.day} is your best day`,
                  description: `Average mood: ${bestDay.avg.toFixed(1)}/5`
                });
              }
            }

            let currentStreak = 0;
            let maxStreak = 0;
            moodHistory.slice().reverse().forEach(entry => {
              if (entry.mood >= 3) {
                currentStreak++;
                maxStreak = Math.max(maxStreak, currentStreak);
              } else {
                currentStreak = 0;
              }
            });

            if (maxStreak >= 3) {
              patterns.push({
                type: 'positive',
                title: `Streak of ${maxStreak} positive days!`,
                description: 'You are maintaining a high mood'
              });
            }

            return patterns;
          };

          const generateAIReport = async () => {
            if (!geminiApiKey) {
              setShowApiSetup(true);
              return null;
            }

            const stats = calculateMoodStats();
            if (!stats) {
              alert('⚠️ Track at least one mood to generate a report');
              return null;
            }

            setGeneratingReport(true);

            try {
              const patterns = findMoodPatterns();

              const prompt = `You are a psychologist specialized in support for Students and Artists. Analyze this data and write an empathetic and motivating report:

Data:
- ${stats.totalMoods} mood recordings in recent days
- Average mood: ${stats.avgMood.toFixed(1)}/5
- Trend: ${stats.trend > 0 ? 'improving' : stats.trend < 0 ? 'declining' : 'stable'}
- Identified patterns: ${patterns.map(p => p.title).join(', ') || 'none'}
- Number of uploaded images: ${uploadedImages.length}
- Journal entries: ${journalEntries.length}

Write a fluid and natural report that includes:
- An observation on your general emotional state
- What is going well in your journey
- Aspects to keep an eye on
- Practical and personalized advice for improvement

IMPORTANT: Write in a conversational and direct way. DO NOT use labels like "Summary:", "Strengths:", "Areas to monitor:", "Recommendations:". Write the text fluidly as if you were speaking directly to the person. Don't start with meta-textual phrases like "Here's an analysis" or "Based on the data". Start directly with the content. Be empathetic, positive but realistic. Max 300 words.`;

              console.log('🔄 Generazione report AI...');
              console.log('📊 Stats:', stats);
              console.log('📈 Patterns:', patterns);

              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiApiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                      temperature: 0.8,
                      maxOutputTokens: 1000,
                    }
                  })
                }
              );

              console.log('📍 Response status:', response.status);

              if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                console.error('❌ API Error:', errorData);
                throw new Error(`API Error: ${response.status}`);
              }

              const data = await response.json();
              console.log('✅ Dati ricevuti:', data);

              const report = data.candidates[0].content.parts[0].text;
              console.log('✅ Report generated successfully');

              setGeneratingReport(false);
              return report;
            } catch (error) {
              console.error('💥 Report generation error:', error);
              alert(`⚠️ Error generating report:\n\n${error.message}\n\nCheck the console (F12) for details.`);
              setGeneratingReport(false);
              return null;
            }
          };

          const moods = [
            { id: 1, name: 'Inspired', emoji: '🎨', color: 'bg-green-400' },
            { id: 2, name: 'Creative', emoji: '✨', color: 'bg-blue-400' },
            { id: 3, name: 'Happy', emoji: '😊', color: 'bg-green-400' },
            { id: 4, name: 'Energetic', emoji: '⚡', color: 'bg-yellow-400' },
            { id: 5, name: 'Spectral', emoji: '🌺', color: 'bg-teal-500' },
            { id: 6, name: 'Calm', emoji: '😌', color: 'bg-teal-400' },
            { id: 7, name: 'Neutral', emoji: '😐', color: 'bg-gray-400' },
            { id: 8, name: 'Anxious', emoji: '😰', color: 'bg-yellow-300' },
            { id: 9, name: 'Sad', emoji: '😢', color: 'bg-blue-300' },
            { id: 10, name: 'Blocked', emoji: '😟', color: 'bg-teal-300' },
            { id: 11, name: 'Frustrated', emoji: '😤', color: 'bg-rose-400' },
            { id: 12, name: 'Exhausted', emoji: '😫', color: 'bg-rose-300' },
            { id: 13, name: 'Melancholic', emoji: '😔', color: 'bg-indigo-300' },
            { id: 14, name: 'Motivated', emoji: '🔥', color: 'bg-teal-600' },
            { id: 15, name: 'Scared', emoji: '🌸', color: 'bg-green-500' }
          ];

          const exerciseVariants = {
            'esercizi-spettrali': [
              {
                title: "🌙 Candlelight Drawing",
                description: "Create in darkness to free your creative unconscious",
                prompt: "Turn off all lights. Use only a candle. Draw what the shadows suggest to you for 20 minutes.",
                duration: "20 min",
                examples: [
                  "🕯️ Example 1: Observe shadows on the wall and draw them without thinking, let your hand follow instinct",
                  "👤 Example 2: Self-portrait looking only at your projected shadow, not your real face",
                  "🌑 Example 3: Draw a recent dream or nightmare in the flickering candlelight"
                ]
              },
              {
                title: "🌸 Spectral Automatic Writing",
                description: "Let the unconscious write through you",
                prompt: "Write for 10 minutes without stopping, without thinking, without rereading. The pen should never leave the paper.",
                duration: "10 min",
                examples: [
                  "✍️ Example 1: Start with 'In the darkest night...' and continue without censorship",
                  "📝 Example 2: Write a letter to your deepest fear, let everything emerge",
                  "🌙 Example 3: Describe an unsettling imaginary place where you'd like to create art"
                ]
              },
              {
                title: "🩸 Art with Unusual Materials",
                description: "Use natural elements to create mysterious works",
                prompt: "Create a work using only found natural elements (dry leaves, earth, twigs, water).",
                duration: "30 min",
                examples: [
                  "🍂 Example 1: Mandala with autumn leaves, wilted petals and earth on the floor",
                  "🌿 Example 2: Paint with dark fruit juices (blueberries, blackberries) on brown paper",
                  "🪨 Example 3: Ephemeral sculpture with stones, twigs and shadows in nature"
                ]
              },
              {
                title: "🦋 Total Inversion",
                description: "Do everything backwards to surprise the mind",
                prompt: "Work in reverse: paint from right to left, write from end to beginning, sculpt from bottom to top.",
                duration: "15 min",
                examples: [
                  "⬅️ Example 1: Paint a landscape starting with sky at bottom and ground at top",
                  "🔄 Example 2: Write a story starting from the conclusion, working back to the beginning",
                  "🎨 Example 3: Draw with your non-dominant hand while looking in mirror"
                ]
              },
              {
                title: "🍃 Creative Memento Mori",
                description: "Reflect on mortality to appreciate creative life",
                prompt: "Create a work representing passing time, fragility, transformation. 25 minutes of deep reflection.",
                duration: "25 min",
                examples: [
                  "⏳ Example 1: Time-lapse photo of a flower wilting over 24 hours",
                  "🍂 Example 2: Collage with old objects, faded photos, worn fabrics",
                  "🕰️ Example 3: Series of progressive self-portraits showing aging (imagined or real)"
                ]
              },
              {
                title: "🌿 Spider's Web: Hidden Connections",
                description: "Discover secret links between seemingly distant ideas",
                prompt: "Choose 5 random words. Create a work that connects them all in a surreal and unexpected way.",
                duration: "20 min",
                examples: [
                  "🎭 Example 1: Words: moon, scissors, memory, salt, mirror → Abstract narrative collage",
                  "🖼️ Example 2: Words: blood, feathers, book, stairs, glass → Mysterious illustration",
                  "📖 Example 3: Words: shadow, key, ocean, smoke, rose → Illustrated micro-story"
                ]
              },
              {
                title: "🌺 Dark Transformation",
                description: "Take something familiar and make it unsettling",
                prompt: "Choose an innocent everyday object. Draw/paint it to make it mysterious, disturbing but fascinating.",
                duration: "30 min",
                examples: [
                  "🧸 Example 1: A teddy bear with empty eyes surrounded by deep shadows",
                  "🏠 Example 2: A dollhouse with windows lit by unnatural lights",
                  "🎪 Example 3: Childhood toys arranged in a surreal and symbolic composition"
                ]
              },
              {
                title: "🌑 Portrait of the Inner Shadow",
                description: "Explore the dark side of creative personality",
                prompt: "Draw/paint your 'shadow side' - the part of you that you hide. Be honest and courageous.",
                duration: "25 min",
                examples: [
                  "😈 Example 1: Split self-portrait: half 'social', half 'true hidden identity'",
                  "🎭 Example 2: Mask representing how you present yourself vs. figure behind showing who you are",
                  "👥 Example 3: Two figures facing each other: your public self and private self"
                ]
              },
              {
                title: "🕯️ Nocturnal Creative Ritual",
                description: "Create a small artistic ritual to honor creativity",
                prompt: "Create a sacred space for your art: candles, meaningful objects, music. Work in this 'personal temple'.",
                duration: "40 min",
                examples: [
                  "🔮 Example 1: Artistic altar with tools, past works, personal symbols - create in this space",
                  "🌙 Example 2: 5 min meditation + 35 min intuitive sketches in a space prepared with intention",
                  "✨ Example 3: Light candles for each completed project, create something new by their light"
                ]
              },
              {
                title: "🦴 Archaeology of the Soul",
                description: "Dig into buried memories and emotions",
                prompt: "Find an old photo of yourself as a child. Create a work that dialogues with that child, with their forgotten dreams.",
                duration: "30 min",
                examples: [
                  "👶 Example 1: Redraw the photo adding symbolic elements representing lost dreams",
                  "💭 Example 2: Illustrated letter to your child self: what would you tell them now?",
                  "🎨 Example 3: Create what that child would have wanted to create but couldn't"
                ]
              }
            ],
            'blocco-creativo': [
              {
                title: "5-Minute Ugly Sketch",
                description: "Draw intentionally ugly to free yourself from perfectionism",
                prompt: "Create a deliberately ugly sketch. The goal is to mess up on purpose.",
                duration: "5 min",
                examples: [
                  "🎭 Example 1: Portrait using only non-dominant hand, without looking at paper",
                  "🌳 Example 2: Landscape with eyes closed, let your hand go where it wants",
                  "👤 Example 3: Self-portrait looking only at mirror, NEVER at paper while drawing"
                ]
              },
              {
                title: "Wrong Medium Challenge",
                description: "Use the 'wrong' material for your usual style",
                prompt: "If you paint, use only charcoal. If you sculpt, try watercolor. Exit your comfort zone.",
                duration: "20 min",
                examples: [
                  "🖌️ Example 1: Painter → Use clay or wire to 'draw' in space",
                  "🗿 Example 2: Sculptor → Create work only with newspaper collage",
                  "📸 Example 3: Photographer → Draw with pencil what you'd photograph, without camera"
                ]
              },
              {
                title: "Public Art Session",
                description: "Create art in a public place without hiding",
                prompt: "Go to a cafe, park, or square. Work for 30 minutes. Accept curious looks.",
                duration: "30 min",
                examples: [
                  "☕ Example 1: Sketch cafe patrons, show your work if they ask",
                  "🌳 Example 2: Paint en plein air in a crowded park",
                  "🚉 Example 3: Urban sketching in a station, leave sketchbook visible"
                ]
              },
              {
                title: "Collaboration Chaos",
                description: "Start a work and let others 'ruin' it",
                prompt: "Create a base. Ask 3 people (even non-artists) to add elements. Accept everything.",
                duration: "45 min",
                examples: [
                  "👥 Example 1: Canvas with base shapes → Everyone adds random colors",
                  "✏️ Example 2: Outline drawing → Others fill with patterns of their choice",
                  "🎭 Example 3: Initial sculpture → Others attach found objects"
                ]
              },
              {
                title: "Speed Creation 30 Seconds",
                description: "No time to judge",
                prompt: "30 second timer. Create something complete. Stop when it rings.",
                duration: "30 sec",
                examples: [
                  "⚡ Example 1: Expressive portrait in 30 seconds, only essential lines",
                  "🎨 Example 2: Abstract composition, throw colors quickly",
                  "✂️ Example 3: Super fast collage, cut and paste without thinking"
                ]
              },
              {
                title: "Childhood Art Recreation",
                description: "Draw like when you were 5 years old",
                prompt: "Only basic shapes: circles, lines, squares. Color outside the lines. Zero perspective.",
                duration: "15 min",
                examples: [
                  "👨‍👩‍👧 Example 1: Draw your family like a child (stylized figures, sun with face)",
                  "🏠 Example 2: House with tree and clouds, all flat and colored",
                  "🐶 Example 3: Your favorite animal, child version (disproportionate and funny)"
                ]
              },
              {
                title: "No Eraser Challenge",
                description: "Every mark stays, every 'mistake' becomes part of the work",
                prompt: "Use only pen. Draw something complex. No erasures. Errors are features.",
                duration: "20 min",
                examples: [
                  "🏛️ Example 1: Complex architecture in pen, if you mess up integrate the error",
                  "👤 Example 2: Portrait from life, double lines become shading",
                  "🌆 Example 3: Cityscape, wrong perspectives create surreal style"
                ]
              },
              {
                title: "Backwards Process",
                description: "Reverse your usual creative process",
                prompt: "If you start with sketches → Start with color. If you plan → Improvise totally.",
                duration: "30 min",
                examples: [
                  "🎨 Example 1: Spread random colors first, THEN find shapes within them",
                  "✏️ Example 2: Paint without preparatory drawing, let it emerge",
                  "🗿 Example 3: Model clay without a plan, discover what it becomes as you work"
                ]
              },
              {
                title: "Anonymous Gallery Drop",
                description: "Create and abandon a work in public, unsigned",
                prompt: "Leave a finished work in a public place. No signature. Observe reactions from afar.",
                duration: "1 hour",
                examples: [
                  "🎭 Example 1: Mini-canvas on a park bench",
                  "📝 Example 2: Drawing at bus stop with note 'Take me home'",
                  "🎨 Example 3: Papier-mâché sculpture in a public library"
                ]
              },
              {
                title: "Criticism to Art",
                description: "Transform received criticism into creative work",
                prompt: "Remember a harsh criticism. Create a work that reinterprets it, challenges it, or celebrates it ironically.",
                duration: "40 min",
                examples: [
                  "💬 Example 1: 'Too dark' → Intentionally pitch-black work with only one point of light",
                  "🎨 Example 2: 'Not technical' → Collage of 'wrong' techniques that work together",
                  "📐 Example 3: 'Off perspective' → Work celebrating impossible perspectives à la Escher"
                ]
              },
              {
                title: "Stream of Consciousness Painting",
                description: "Paint/draw while thinking out loud",
                prompt: "Record audio while working. Talk about everything that crosses your mind. Don't stop thinking or talking.",
                duration: "20 min",
                examples: [
                  "🎤 Example 1: Abstract watercolor + monologue about your day",
                  "🗣️ Example 2: Automatic drawing while talking about your artistic doubts",
                  "💭 Example 3: Sculpture + stream-of-consciousness narration of your childhood"
                ]
              },
              {
                title: "Opposite Style Day",
                description: "Do the exact opposite of your style",
                prompt: "Minimalist? Today go baroque. Realist? Today totally abstract. Warm colors? Only cold ones.",
                duration: "1 hour",
                examples: [
                  "🔄 Example 1: Abstract artist → Hyperrealistic portrait from photo",
                  "🎭 Example 2: Figurative → Totally non-objective composition",
                  "🌈 Example 3: Monochromatic → Explosion of all possible colors"
                ]
              },
              {
                title: "Found Objects Sculpture",
                description: "Create only with randomly found objects",
                prompt: "30 minutes to collect random objects. 30 minutes to assemble them into a work. No purchases.",
                duration: "1 hour",
                examples: [
                  "🗑️ Example 1: Sculpture from trash found on street",
                  "🍂 Example 2: Installation with only natural elements (leaves, branches, stones)",
                  "📦 Example 3: Assembly of discarded objects from home (old keys, buttons, caps)"
                ]
              },
              {
                title: "Time Limit Escalation",
                description: "Same work in progressively tighter times",
                prompt: "Version 1: 30 min. Version 2: 10 min. Version 3: 2 min. Compare results.",
                duration: "42 min total",
                examples: [
                  "⏱️ Example 1: Self-portrait in 3 different time versions",
                  "🍎 Example 2: Still life, becomes increasingly essential",
                  "🏙️ Example 3: Urban landscape, discover what's truly essential"
                ]
              },
              {
                title: "Blindfold Challenge",
                description: "Create with eyes closed or blindfolded",
                prompt: "Blindfold for entire duration. Trust touch and instinct.",
                duration: "15 min",
                examples: [
                  "👁️ Example 1: Clay sculpture blindfolded, let hands guide",
                  "🎨 Example 2: Finger painting without seeing, only tactile sensations",
                  "✏️ Example 3: Charcoal drawing blindfolded, feel the paper texture"
                ]
              },
              {
                title: "Social Media Live Creation",
                description: "Create live on social media",
                prompt: "Instagram/TikTok Live or record video. Show errors, hesitations, entire raw process.",
                duration: "30 min",
                examples: [
                  "📱 Example 1: Time-lapse of a drawing, show ALL failed attempts",
                  "🎥 Example 2: Live painting with real-time commentary on your doubts",
                  "📸 Example 3: Progressive Stories of a work, even the 'mistakes'"
                ]
              },
              {
                title: "Extreme Constraint Box",
                description: "Absurd rules that drastically limit",
                prompt: "Only 1 color, 3 lines maximum, absurd materials. Creativity comes from extreme constraints.",
                duration: "25 min",
                examples: [
                  "📏 Example 1: Portrait with ONLY 10 straight lines",
                  "🎨 Example 2: Landscape using ONLY dots (extreme pointillism)",
                  "✂️ Example 3: Composition with ONLY circular shapes, nothing else"
                ]
              },
              {
                title: "Audience Choice Creation",
                description: "The audience decides what you create",
                prompt: "Ask 5 random people: subject, dominant color, technique. You must use ALL suggestions.",
                duration: "40 min",
                examples: [
                  "👥 Example 1: Instagram poll to choose theme + palette + style",
                  "🎲 Example 2: Dice with random words, roll 3 times, incorporate everything",
                  "📱 Example 3: Ask passersby what to draw, take first 3 suggestions"
                ]
              },
              {
                title: "Destruction as Creation",
                description: "Create by destroying previous works",
                prompt: "Take 3 old 'failed' works. Cut them, tear them, reassemble into something new.",
                duration: "35 min",
                examples: [
                  "✂️ Example 1: Collage from rejected drawings, overlap fragments",
                  "🔥 Example 2: Paint over an old painting, let the underneath show through",
                  "🎭 Example 3: Sculpture assembling broken pieces of previous sculptures"
                ]
              },
              {
                title: "Impossible Replica",
                description: "Try to remake exactly the same work 5 times",
                prompt: "Create something. Now remake it identically 4 more times. Observe how each attempt is different.",
                duration: "50 min",
                examples: [
                  "🔁 Example 1: Same portrait 5 times, note involuntary variations",
                  "🎨 Example 2: Same abstract composition, diverges more and more",
                  "✏️ Example 3: Same quick sketch, celebrate the differences"
                ]
              }
            ],
            'mancanza-ispirazione': [
              {
                title: "Random Art Prompts Generator",
                description: "Three random words become a concept",
                prompt: "Generate 3 completely random words. Create a work that includes all of them.",
                duration: "15 min",
                examples: [
                  "🎲 Example 1: 'Melancholy + Geometry + Blue' → Cold geometric work with sad mood",
                  "✨ Example 2: 'Chaos + Nature + Recycled materials' → Chaotic organic installation",
                  "🌙 Example 3: 'Memory + Texture + Monochrome' → Tactile work about memories"
                ]
              },
              {
                title: "Art History Mashup",
                description: "Combine two opposite artistic movements",
                prompt: "Renaissance + Street Art, or Impressionism + Futurism. Create the impossible fusion.",
                duration: "45 min",
                examples: [
                  "🏛️ Example 1: Botticelli's Venus in metropolitan graffiti style",
                  "🎨 Example 2: Impressionist landscape with cyberpunk elements",
                  "🗿 Example 3: Classical sculpture assembled with industrial materials"
                ]
              },
              {
                title: "Environment Inspiration Hunt",
                description: "Find inspiration in the most mundane objects",
                prompt: "Photograph 10 ignored details in your room. Use those patterns/shapes/colors for a work.",
                duration: "30 min",
                examples: [
                  "🔍 Example 1: Cracked wall texture → Abstract painting with same texture",
                  "💡 Example 2: Plant shadows on window → Silhouettes for a work",
                  "📚 Example 3: Random colors of book spines → Palette for composition"
                ]
              },
              {
                title: "Music to Visual",
                description: "Translate a song into visual art",
                prompt: "Choose a track. Listen 3 times. Create what you 'see' while listening.",
                duration: "25 min",
                examples: [
                  "🎵 Example 1: Jazz → Fluid improvised lines, visual rhythm",
                  "🎸 Example 2: Rock → Energetic composition with aggressive colors",
                  "🎻 Example 3: Classical → Harmonious and balanced forms"
                ]
              },
              {
                title: "Opposite Thinking Exercise",
                description: "Completely flip your initial idea",
                prompt: "Think of a project you want to do. Now do the EXACT OPPOSITE of every choice you would have made.",
                duration: "20 min",
                examples: [
                  "↔️ Example 1: Wanted to paint small? Make giant mural",
                  "🔄 Example 2: Wanted serious subject? Make it ironic and pop",
                  "⚡ Example 3: Wanted slow process? Complete it in 5 minutes"
                ]
              },
              {
                title: "Constraint Creativity Box",
                description: "Extreme limits force creative solutions",
                prompt: "Choose 3 absurd limits: only 2 colors, only triangular shapes, only recycled materials, etc.",
                duration: "30 min",
                examples: [
                  "📐 Example 1: Only black and white + only circles → Geometric op art",
                  "♻️ Example 2: Only newspaper + only primary colors",
                  "✂️ Example 3: Only magazine cutouts + no human figures"
                ]
              },
              {
                title: "Dream Journal Art",
                description: "Transform recent dreams into visual works",
                prompt: "Remember a dream from recent days. Recreate it visually, even if absurd or fragmented.",
                duration: "35 min",
                examples: [
                  "💤 Example 1: Surreal dream → Collage of disconnected but emotionally coherent elements",
                  "🌙 Example 2: Nightmare → Dark work capturing the atmosphere",
                  "✨ Example 3: Lucid dream → Hyper-colored and impossible composition"
                ]
              },
              {
                title: "Childhood Nostalgia Mining",
                description: "Return to what fascinated you as a child",
                prompt: "3 things you loved at age 8. Incorporate them into a mature adult project.",
                duration: "40 min",
                examples: [
                  "🦖 Example 1: Loved dinosaurs → Art series on extinction and fossils",
                  "🚀 Example 2: Loved space → Installation about exploration and solitude",
                  "🎮 Example 3: Loved video games → Conceptual pixel art about virtual reality"
                ]
              },
              {
                title: "Cultural Fusion Project",
                description: "Mix elements from different cultures",
                prompt: "Choose 2 distant cultures. Unite symbols, patterns, artistic styles in a hybrid work.",
                duration: "50 min",
                examples: [
                  "🗾 Example 1: Japanese Ukiyo-e + European Art Nouveau",
                  "🌍 Example 2: African tribal art + Scandinavian minimalism",
                  "🎭 Example 3: Hindu mandalas + Latin American street art"
                ]
              },
              {
                title: "Synesthesia Experiment",
                description: "Visualize one sense with another",
                prompt: "What does the sound of rain look like? What color is Monday? What shape is happiness?",
                duration: "20 min",
                examples: [
                  "👃 Example 1: Paint the smell of morning coffee",
                  "👂 Example 2: Draw the sound of city traffic",
                  "👅 Example 3: Sculpture representing the taste of lemon"
                ]
              },
              {
                title: "Time Traveler Artist",
                description: "What would your art be like in another era?",
                prompt: "Imagine your style in 1920, or 2120. Recreate with techniques/materials from that era.",
                duration: "45 min",
                examples: [
                  "⏰ Example 1: Your style but with Renaissance techniques",
                  "🚀 Example 2: Your subject but in futuristic cyberpunk aesthetic",
                  "📜 Example 3: Your vision but as medieval illuminated manuscript"
                ]
              },
              {
                title: "Emotion Color Mapping",
                description: "Emotional palette becomes concept",
                prompt: "Choose a complex emotion. Create palette of 5 colors representing it. Work based only on that palette.",
                duration: "30 min",
                examples: [
                  "😌 Example 1: 'Nostalgia' → Sepia, ochre, dusty blue palette",
                  "😰 Example 2: 'Anxiety' → Acid yellow, gray, electric green",
                  "🥰 Example 3: 'Tenderness' → Pale pink, beige, lavender"
                ]
              },
              {
                title: "Fictional Collaboration",
                description: "Work 'with' an artist you admire",
                prompt: "If you collaborated with Frida Kahlo / Basquiat / Banksy, what would you create? Start their half.",
                duration: "40 min",
                examples: [
                  "🎨 Example 1: Half work in Van Gogh's style, half in yours",
                  "✍️ Example 2: Start as cubist Picasso, finish with your approach",
                  "🖼️ Example 3: Composition merging Klimt and your aesthetic"
                ]
              },
              {
                title: "Problem Solving Art",
                description: "Solve a real problem with creativity",
                prompt: "Daily problem (traffic, waste, loneliness). 10 creative solutions visualized.",
                duration: "35 min",
                examples: [
                  "🚗 Example 1: Traffic → Installation about alternative mobility",
                  "🌱 Example 2: Plastic → Sculptures entirely from plastic waste",
                  "💔 Example 3: Isolation → Participatory work connecting people"
                ]
              },
              {
                title: "ABC Rapid Ideas",
                description: "One idea for every letter of alphabet",
                prompt: "A = Cyberpunk art, B = Children as theme, etc. Until Z. Complete list in 15 minutes.",
                duration: "15 min",
                examples: [
                  "📝 Example 1: Mini-sketches for each letter, develop 3 favorites",
                  "💡 Example 2: Only titles, then choose which to realize",
                  "🎨 Example 3: Different color palette for each letter"
                ]
              },
              {
                title: "Scale Extremes",
                description: "Same work, extreme dimensions",
                prompt: "Version 1: as big as a fingernail. Version 2: as big as a wall. Compare.",
                duration: "1 hour",
                examples: [
                  "🔬 Example 1: Highly detailed miniature vs essential mural",
                  "📏 Example 2: Pocket sculpture vs environmental installation",
                  "🎨 Example 3: 5x5cm watercolor vs 2x2m acrylic"
                ]
              },
              {
                title: "Remix Your Favorite Artwork",
                description: "Reinterpret a masterpiece in your style",
                prompt: "Famous work you love. Recreate it completely in your artistic language.",
                duration: "50 min",
                examples: [
                  "🖼️ Example 1: 'Starry Night' in urban collage style",
                  "👩 Example 2: 'Mona Lisa' in abstract expressionist version",
                  "🍎 Example 3: Baroque still life in pixel art"
                ]
              },
              {
                title: "Sensory Deprivation Creation",
                description: "Remove one sense to amplify others",
                prompt: "Work blindfolded, with earplugs, or in total silence. Intensify other senses.",
                duration: "25 min",
                examples: [
                  "🙈 Example 1: Sculpture with eyes closed, only touch guides",
                  "🙉 Example 2: Painting in absolute silence, total concentration",
                  "🎨 Example 3: Drawing in the dark, surprise when you turn on light"
                ]
              },
              {
                title: "Weather as Co-Creator",
                description: "Natural elements participate in creation",
                prompt: "Let rain, wind, sun modify the work while you create it outdoors.",
                duration: "1 hour",
                examples: [
                  "🌧️ Example 1: Watercolor under light rain, random effects",
                  "💨 Example 2: Sand sculpture, wind as collaborator",
                  "☀️ Example 3: Painting in sun, observe how light changes perception"
                ]
              },
              {
                title: "Future Archaeologist",
                description: "Create 'artifacts' of a future civilization",
                prompt: "Year 3000. Archaeologists find your work. What does it tell about our era?",
                duration: "45 min",
                examples: [
                  "🏺 Example 1: 'Ancient vase' from 2024 with digital symbols",
                  "📱 Example 2: Fossilized smartphone as artifact",
                  "🗿 Example 3: Totem representing social media society"
                ]
              }
            ],
            'burnout-accademico': [
              {
                title: "5-Minute Brain Dump",
                description: "Unload all worries onto paper",
                prompt: "5 minute timer. Write EVERYTHING that stresses you at Academy, exams, projects. Then tear it up.",
                duration: "5 min",
                examples: [
                  "📝 Example 1: Stream of consciousness about deadlines, then burn it",
                  "✏️ Example 2: List fears/anxieties, then draw relaxing patterns over them",
                  "🗑️ Example 3: Letter to anxiety, read it aloud, then throw away"
                ]
              },
              {
                title: "Single Task Promise",
                description: "Today do ONLY one thing, but do it well",
                prompt: "List of 10 things to do. Choose ONE. Do only that today. Ignore the rest.",
                duration: "Variable",
                examples: [
                  "✅ Example 1: Only preparatory sketches, nothing else",
                  "🎨 Example 2: Only base color application, stop",
                  "📚 Example 3: Only reference research, no production"
                ]
              },
              {
                title: "Digital Detox Studio Time",
                description: "2 hours of completely offline work",
                prompt: "Turn off phone and PC. Work only with hands and physical materials for 2 hours.",
                duration: "2 hours",
                examples: [
                  "📵 Example 1: Only pencils and paper, no digital",
                  "🚫 Example 2: Clay modeling, zero tech distractions",
                  "🎨 Example 3: Traditional painting, no online tutorials"
                ]
              },
              {
                title: "Energy Audit Worksheet",
                description: "Map what drains and what recharges you",
                prompt: "Divide sheet: left = energy vampires, right = energy boosters. Reorganize priorities.",
                duration: "15 min",
                examples: [
                  "🔋 Example 1: Avoid draining projects, focus on energizing ones",
                  "💡 Example 2: Identify toxic people/situations, reduce exposure",
                  "⚡ Example 3: Schedule restorative activities between demanding ones"
                ]
              },
              {
                title: "Micro-Break Protocol",
                description: "3-minute breaks every hour of work",
                prompt: "Timer every 60 minutes. Stop 3 minutes: stretching, breathing, or look outside. No screens.",
                duration: "3 min x N",
                examples: [
                  "🧘 Example 1: Neck and shoulder stretching, release tension",
                  "🌬️ Example 2: 10 deep breaths at window",
                  "👀 Example 3: Palming (hands over closed eyes) to relax vision"
                ]
              },
              {
                title: "Permission to Be Mediocre",
                description: "Today 60% effort is enough",
                prompt: "Choose a task. Do it with 60% of usual effort. It's enough. Really.",
                duration: "Variable",
                examples: [
                  "📐 Example 1: Rough sketch instead of finished",
                  "🎨 Example 2: Approximate color study, not final rendering",
                  "✏️ Example 3: Rough concept, not perfect presentation"
                ]
              },
              {
                title: "Passion Project 30 Minutes",
                description: "Work on something you LOVE, not something you must do",
                prompt: "30 minutes ONLY for personal project that excites you. Zero guilt.",
                duration: "30 min",
                examples: [
                  "💜 Example 1: Fantasy illustration you've wanted to do for months",
                  "🎨 Example 2: New technique you want to experiment with",
                  "✨ Example 3: Personal series unrelated to Academy"
                ]
              },
              {
                title: "Say No Practice",
                description: "Politely decline a request today",
                prompt: "Identify something you can say no to. Practice: 'I can't right now, thank you'.",
                duration: "5 min",
                examples: [
                  "🚫 Example 1: Non-essential collaboration that stresses you",
                  "❌ Example 2: Social request taking away creative time",
                  "🛑 Example 3: Non-fundamental extra-academic commitment"
                ]
              },
              {
                title: "Body Scan Relaxation",
                description: "Systematically relax every muscle",
                prompt: "Lie down. Start from feet, slowly go up. Consciously relax each body part.",
                duration: "15 min",
                examples: [
                  "🦶 Example 1: Feet → legs → pelvis → back → shoulders → head",
                  "💆 Example 2: Extra focus on tense areas (shoulders, jaw)",
                  "😌 Example 3: Repeat 2-3 times if particularly stressed"
                ]
              },
              {
                title: "Gratitude Art Journal",
                description: "Draw 5 things you're grateful for today",
                prompt: "Sketchbook: 5 mini-drawings of today's positive things, even tiny ones.",
                duration: "10 min",
                examples: [
                  "☕ Example 1: Good coffee, beautiful light, friend who texted",
                  "🌞 Example 2: Successful project, pleasant break, nice sunset",
                  "💛 Example 3: Illustrate gratitude for tools, studio space, health"
                ]
              },
              {
                title: "Movement Snack",
                description: "5 minutes of energizing movement",
                prompt: "Put on music. Move freely for 5 minutes: dance, jump, dynamic stretching.",
                duration: "5 min",
                examples: [
                  "💃 Example 1: Dance to a song you love, let loose",
                  "🤸 Example 2: Jumping jacks, stretching, wide movements",
                  "🧘 Example 3: Quick yoga flow to reactivate body"
                ]
              },
              {
                title: "Sleep Hygiene Setup",
                description: "Create evening ritual for better sleep",
                prompt: "30 min pre-sleep: no screens, herbal tea, reading or stretching. Repeat every night.",
                duration: "30 min",
                examples: [
                  "📚 Example 1: Reading + chamomile + soft lights",
                  "🧘 Example 2: Guided meditation + journal + breathing",
                  "🎨 Example 3: Relaxing sketchbook + calm music + routine"
                ]
              },
              {
                title: "Workload Triage",
                description: "Reorganize priorities realistically",
                prompt: "List everything. Categories: Urgent, Important, Can wait, Delegable. Recalculate deadlines.",
                duration: "20 min",
                examples: [
                  "📋 Example 1: Exam next week = Urgent, online tutorial = Wait",
                  "✅ Example 2: Portfolio = Important, studio cleaning = Delegate",
                  "🎯 Example 3: Final project = Urgent+Important, side project = Wait"
                ]
              },
              {
                title: "Forest Bathing (Shinrin-yoku)",
                description: "Mindful immersion in nature",
                prompt: "40 minutes in park/nature. Walk slowly. Observe, smell, touch. Zero phone.",
                duration: "40 min",
                examples: [
                  "🌳 Example 1: City park, observe trees and birds",
                  "🌿 Example 2: Forest walk, collect interesting leaves",
                  "🏞️ Example 3: Lake or river, listen to water sounds"
                ]
              },
              {
                title: "Worry Time Container",
                description: "15 minutes dedicated ONLY to worrying",
                prompt: "Choose a time. 15 min for anxieties. Outside that window, postpone worries.",
                duration: "15 min",
                examples: [
                  "⏰ Example 1: 6:00 PM = worry time, rest of day = worry-free zone",
                  "📝 Example 2: Write anxieties during worry time, then close notebook",
                  "🚫 Example 3: When worries emerge outside time: 'I'll think about it at 6'"
                ]
              },
              {
                title: "Perfection Release Exercise",
                description: "Complete something at 70% and consider it done",
                prompt: "Project you're procrastinating due to perfectionism? Take it to 70% and STOP. It's enough.",
                duration: "Variable",
                examples: [
                  "✅ Example 1: Portfolio 'good enough' publish it",
                  "🎨 Example 2: Work '70% done' = Done. Start new one",
                  "📱 Example 3: 'Decent' social post publish it, not perfect"
                ]
              },
              {
                title: "Social Battery Check",
                description: "Assess if you need people or solitude",
                prompt: "Ask yourself: social energy high or low? Honor answer. Ok to say no to outings, ok to ask for company.",
                duration: "5 min",
                examples: [
                  "👥 Example 1: Battery low → Decline invites, recharge alone",
                  "🤗 Example 2: Battery high → Call friend, study with company",
                  "⚖️ Example 3: Alternate social days and solitary days"
                ]
              },
              {
                title: "Breathing Reset 4-7-8",
                description: "Breathing technique to calm nervous system",
                prompt: "Inhale 4 seconds, hold 7, exhale 8. Repeat 4 cycles. Resets acute anxiety.",
                duration: "2 min",
                examples: [
                  "🌬️ Example 1: Before presentations or exams",
                  "😰 Example 2: When you feel anxiety rising suddenly",
                  "🧘 Example 3: In morning to start day calm"
                ]
              },
              {
                title: "Studio Environment Reset",
                description: "Reorganize workspace for fresh energy",
                prompt: "20 minutes: clean, tidy, change arrangement. New space = new energy.",
                duration: "20 min",
                examples: [
                  "🧹 Example 1: Remove old projects, clean space",
                  "💡 Example 2: Change lighting, add plant",
                  "🎨 Example 3: Organize materials for accessibility"
                ]
              },
              {
                title: "Self-Compassion Letter",
                description: "Write to yourself as you would to a friend",
                prompt: "What are you blaming yourself for? Write what you'd tell a friend in same situation.",
                duration: "10 min",
                examples: [
                  "💌 Example 1: 'I'm behind' → 'You're doing your best'",
                  "💙 Example 2: 'I made mistakes' → 'Mistakes are learning'",
                  "🤗 Example 3: 'I'm not enough' → 'You're growing, it takes time'"
                ]
              }
            ],
            'ansia-critica': [
              {
                title: "Small Wins Inventory",
                description: "Celebrate even tiny successes",
                prompt: "5 small things you did today, even just getting up or having breakfast. They are victories.",
                duration: "5 min",
                examples: [
                  "✨ Example 1: I got up → I did stretching → I opened sketchbook",
                  "🎨 Example 2: I mixed colors → I made a mark → I continued",
                  "💪 Example 3: I went to Academy → I talked with prof → I started project"
                ]
              },
              {
                title: "Pre-Critique Ritual",
                description: "Calming routine before reviews/exams",
                prompt: "3 repetitive actions you always do before critiques. Becomes safety anchor.",
                duration: "10 min",
                examples: [
                  "🧘 Example 1: 4-7-8 breathing + Mantra + Positive visualization",
                  "🎵 Example 2: Specific song + Stretching + Affirmations",
                  "☕ Example 3: Ritual coffee + Review key points + Touch talisman"
                ]
              },
              {
                title: "Expectation vs Reality",
                description: "Compare fears with real probabilities",
                prompt: "Column 1: What you fear will happen. Column 2: What will probably actually happen.",
                duration: "10 min",
                examples: [
                  "😰 Example 1: Fear: 'They'll say I suck' → Reality: 'They'll give constructive feedback'",
                  "🎓 Example 2: Fear: 'I'll fail exam' → Reality: 'I studied, likely to pass'",
                  "🎨 Example 3: Fear: 'They'll laugh at my work' → Reality: 'Technical critiques, not personal'"
                ]
              },
              {
                title: "Past Success Recall",
                description: "Remember when you already did well",
                prompt: "3 similar past situations where you succeeded. What helped you then?",
                duration: "8 min",
                examples: [
                  "🏆 Example 1: Exam last year → Preparation + Breathing → Passed with 27",
                  "✅ Example 2: Project presentation → Rehearsals + Friends' support → Good feedback",
                  "🎨 Example 3: Group show → Authentic work + Confidence → Appreciation"
                ]
              },
              {
                title: "Lower the Bar Day",
                description: "Redefine success in achievable way",
                prompt: "Instead of 'I must be perfect', define success as 'I'll do my best today'.",
                duration: "5 min",
                examples: [
                  "📊 Example 1: Success = Complete project, not make it perfect",
                  "🎯 Example 2: Success = Present, not get standing ovation",
                  "✅ Example 3: Success = Improve by 1%, not be the best"
                ]
              },
              {
                title: "Body Anchoring Technique",
                description: "Physical gesture that brings you back to calm",
                prompt: "Choose gesture (touch thumb-index, hand on heart). Use it when anxious.",
                duration: "3 min",
                examples: [
                  "🤲 Example 1: Thumb-index = calm anchor, practice it in serene moments",
                  "💓 Example 2: Hand on heart + deep breath = self-comfort",
                  "✊ Example 3: Gentle fist = signal to yourself 'You can do it'"
                ]
              },
              {
                title: "Visualization Practice",
                description: "Imagine successful performance",
                prompt: "Close eyes. Visualize yourself presenting/exhibiting with calm and competence. Sensory details.",
                duration: "10 min",
                examples: [
                  "🎬 Example 1: See yourself speaking clearly, profs nodding, you feel confident",
                  "🖼️ Example 2: Imagine work displayed, people interested, positive feedback",
                  "🎓 Example 3: Exam: you answer calmly, show work, it goes well"
                ]
              },
              {
                title: "Worst Case Scenario Acceptance",
                description: "Face worst fear, then resize it",
                prompt: "Worst possible scenario. Then: How would you survive anyway? Resize fear.",
                duration: "12 min",
                examples: [
                  "💭 Example 1: Worst: 'Failed' → Survival: 'Retake exam, learn, pass'",
                  "😰 Example 2: Worst: 'Devastating critique' → 'I'll use feedback, improve'",
                  "🎨 Example 3: Worst: 'Work not appreciated' → 'I'll make other, grow'"
                ]
              },
              {
                title: "Affirmation Recording",
                description: "Your voice encouraging you",
                prompt: "Record 5 positive affirmations. Listen to them on loop before stressful events.",
                duration: "10 min",
                examples: [
                  "🎤 Example 1: 'I'm capable' / 'I worked hard' / 'I deserve success'",
                  "💪 Example 2: 'I have talent' / 'I can handle critiques' / 'I'm growing'",
                  "✨ Example 3: 'I'm a valid artist' / 'My work has value' / 'I'll make it'"
                ]
              },
              {
                title: "Progress Not Perfection",
                description: "Celebrate improvement, not just result",
                prompt: "3 ways you've improved in last month, even small progress.",
                duration: "7 min",
                examples: [
                  "📈 Example 1: I draw perspective better than before, even if not perfect",
                  "🎨 Example 2: I handle critiques more serenely than at year start",
                  "💪 Example 3: I finish projects faster, even if not at 100%"
                ]
              },
              {
                title: "Comparison Detox",
                description: "Challenge harmful comparisons with others",
                prompt: "Who are you comparing yourself to? Write 3 reasons why comparison isn't valid/useful.",
                duration: "8 min",
                examples: [
                  "👥 Example 1: 'They have different background/time/resources'",
                  "🎯 Example 2: 'I only see their result, not their process/difficulties'",
                  "✨ Example 3: 'My path is unique, not measurable with others' metrics'"
                ]
              },
              {
                title: "Feedback Filter Practice",
                description: "Distinguish constructive critique from projection",
                prompt: "Last feedback received. Which parts useful? Which personal projections of the critic?",
                duration: "10 min",
                examples: [
                  "💬 Example 1: Useful: 'Proportions to improve' / Projection: 'Too bold'",
                  "🎨 Example 2: Useful: 'Technique X to study' / Projection: 'Not my style'",
                  "✅ Example 3: Take technical critiques, ignore personal taste judgments"
                ]
              },
              {
                title: "Grounding 5-4-3-2-1",
                description: "Sensory technique for acute pre-critique anxiety",
                prompt: "5 things you see, 4 you touch, 3 you hear, 2 you smell, 1 you taste. Brings back to present.",
                duration: "4 min",
                examples: [
                  "👀 Example 1: Before entering critique room, do exercise outside door",
                  "🧠 Example 2: During exam break, reset with 5-4-3-2-1",
                  "✋ Example 3: While waiting for results, anchor to present with exercise"
                ]
              },
              {
                title: "Process vs Outcome Focus",
                description: "Control the controllable, let go of rest",
                prompt: "You control: effort, preparation, presence. You don't control: grade, prof's reaction, comparison with others.",
                duration: "10 min",
                examples: [
                  "✅ Example 1: Focus on: 'I gave my best in research and execution'",
                  "🎯 Example 2: Focus on: 'I present clearly what I did'",
                  "💪 Example 3: Let go: 'If they'll like it', 'If I'll get high grade'"
                ]
              },
              {
                title: "Support Network Activation",
                description: "Who can support you before/during/after critiques",
                prompt: "3 people you can contact when anxious. Save them as 'Exam Support'.",
                duration: "5 min",
                examples: [
                  "👥 Example 1: Friend X for pep talk, Friend Y for post-exam distraction",
                  "💙 Example 2: Course mate to study together, Mentor for doubts",
                  "🤗 Example 3: Family member for emotional support, Colleague for technical feedback"
                ]
              },
              {
                title: "Post-Critique Debrief",
                description: "Objectively analyze after critiques/exams",
                prompt: "What went well? 1 thing to improve? 1 lesson learned? No catastrophizing.",
                duration: "15 min",
                examples: [
                  "📝 Example 1: Good: clear presentation / Improve: time management / Lesson: prepare outline",
                  "✅ Example 2: Good: strong concept / Improve: color technique / Lesson: more color tests",
                  "🎯 Example 3: Focus on objective data, not on moment's emotions"
                ]
              },
              {
                title: "Identity Decoupling",
                description: "Separate your worth from your result",
                prompt: "Complete: 'My worth as person does NOT depend on [grade/critique/performance]'.",
                duration: "5 min",
                examples: [
                  "💎 Example 1: 'I'm worthy as person regardless of today's grade'",
                  "✨ Example 2: 'A failed project doesn't make me a failure'",
                  "🌟 Example 3: 'My artistic worth isn't measured by an exam'"
                ]
              },
              {
                title: "Energy Management Pre-Critique",
                description: "Optimize physical energy before performance",
                prompt: "Plan day before: what to eat, when to sleep, how to move for optimal energy.",
                duration: "20 min",
                examples: [
                  "🥗 Example 1: Light dinner night before, protein breakfast, hydration",
                  "😴 Example 2: Bed early, 8 hours sleep, wake with time",
                  "🏃 Example 3: Morning walk, stretching, avoid excessive caffeine"
                ]
              },
              {
                title: "Reframe Anxiety as Excitement",
                description: "Transform nervousness into positive energy",
                prompt: "When you feel anxiety, say out loud: 'I'm excited for this opportunity'. Body doesn't know difference.",
                duration: "2 min",
                examples: [
                  "🎉 Example 1: Fast heartbeat? 'I'm pumped to show my work!'",
                  "⚡ Example 2: Sweaty hands? 'I'm enthusiastic about this presentation!'",
                  "✨ Example 3: Short breath? 'I'm energized for this challenge!'"
                ]
              },
              {
                title: "Mentor Visualization",
                description: "Imagine your mentor encouraging you",
                prompt: "Close eyes. Imagine artist/prof/person you admire telling you words of support.",
                duration: "7 min",
                examples: [
                  "👨‍🎨 Example 1: Van Gogh tells you: 'Express your vision, don't seek approval'",
                  "👩‍🏫 Example 2: Favorite prof: 'You worked well, show with confidence'",
                  "🎨 Example 3: Admired artist: 'I also had critiques, it's part of the journey'"
                ]
              }
            ]
          };

          const exerciseCategories = [
            {
              id: 'esercizi-spettrali',
              title: '🌺 Spectral Exercises!',
              description: 'Mysterious practices to unleash dark creativity',
              icon: Flower,
              color: 'from-teal-300 via-teal-400 to-teal-500'
            },
            {
              id: 'blocco-creativo',
              title: 'Creative Block',
              description: 'Overcome perfectionism and fear of the blank page',
              icon: Palette,
              color: 'from-teal-300 via-teal-400 to-teal-500'
            },
            {
              id: 'mancanza-ispirazione',
              title: 'Lack of Inspiration',
              description: 'Rediscover fresh ideas and new perspectives',
              icon: Lightbulb,
              color: 'from-teal-300 via-teal-400 to-teal-500'
            },
            {
              id: 'burnout-accademico',
              title: 'Academic Burnout',
              description: 'Manage stress from projects and deadlines',
              icon: Zap,
              color: 'from-teal-300 via-teal-400 to-teal-500'
            },
            {
              id: 'ansia-critica',
              title: 'Exam Anxiety',
              description: 'Face reviews and exams with serenity',
              icon: Award,
              color: 'from-teal-300 via-teal-400 to-teal-500'
            }
          ];

          const getRandomVariant = (category) => {
            const variants = exerciseVariants[category];
            return variants[Math.floor(Math.random() * variants.length)];
          };

          const generateWithGemini = async (category) => {
            if (!geminiApiKey) {
              alert('⚠️ First configure your Gemini API key in settings!');
              setShowApiSetup(true);
              return null;
            }

            const prompts = {
              'esercizi-spettrali': 'You are a creative coach with knowledge of mysterious artistic practices and Jungian psychology. Generate a spectral/dark exercise for artists that frees the creative unconscious. Must be provocative but safe, explore inner shadows, use dark symbolism, creative rituals or unusual materials. Wellness edition: mysterious but therapeutic atmosphere. Include 3 concrete examples. Respond ONLY with JSON: {"title": "Name with spectral emoji", "description": "Description", "prompt": "Instructions", "duration": "Time", "examples": ["Example 1: ...", "Example 2: ...", "Example 3: ..."]}',
              'blocco-creativo': 'You are a coach for Students and Artists. Generate a creative exercise to overcome creative block and perfectionism. Must be practical (5-30 min), provocative but safe, focused on concrete artistic action. Include 3 different examples. Respond ONLY with JSON: {"title": "Name", "description": "Description", "prompt": "Instructions", "duration": "Time", "examples": ["Example 1: ...", "Example 2: ...", "Example 3: ..."]}',
              'mancanza-ispirazione': 'You are a creative coach for artists. Generate exercise to unlock inspiration. Must stimulate divergent thinking, be fun, generate fresh ideas. Include 3 practical examples. Respond ONLY with JSON: {"title": "Name", "description": "Description", "prompt": "Instructions", "duration": "Time", "examples": ["Example 1: ...", "Example 2: ...", "Example 3: ..."]}',
              'burnout-accademico': 'You are a wellness specialist for Students and Artists. Generate practical exercise to manage academic stress and burnout. Must be relaxing, doable even with low energy, provide concrete relief. Include 3 variants. Respond ONLY with JSON: {"title": "Name", "description": "Description", "prompt": "Instructions", "duration": "Time", "examples": ["Example 1: ...", "Example 2: ...", "Example 3: ..."]}',
              'ansia-critica': 'You are a coach for managing artistic performance anxiety. Generate exercise to face critiques, reviews, exams with calm. Must reduce anxiety, increase confidence, separate personal worth from judgment. Include 3 different applications. Respond ONLY with JSON: {"title": "Name", "description": "Description", "prompt": "Instructions", "duration": "Time", "examples": ["Example 1: ...", "Example 2: ...", "Example 3: ..."]}'
            };

            setIsGenerating(true);
            
            try {
              console.log('🔄 Calling Gemini API...');
              console.log('📍 API Key present:', geminiApiKey ? 'Yes' : 'No');
              console.log('📍 API Key length:', geminiApiKey?.length);

              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiApiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{
                      parts: [{
                        text: prompts[category]
                      }]
                    }],
                    generationConfig: {
                      temperature: 0.9,
                      topK: 40,
                      topP: 0.95,
                      maxOutputTokens: 2048,
                    }
                  })
                }
              );

              console.log('📍 Response status:', response.status);
              console.log('📍 Response ok:', response.ok);

              if (!response.ok) {
                const errorData = await response.json().catch(() => ({ error: 'Cannot read response' }));
                console.error('❌ Full API error:', JSON.stringify(errorData, null, 2));

                let errorMessage = 'Unknown error';
                if (errorData.error) {
                  if (errorData.error.code === 400) {
                    errorMessage = 'Invalid API Key or wrong request format';
                  } else if (errorData.error.code === 403) {
                    errorMessage = 'Unauthorized API Key. Verify that Gemini API is enabled in your Google Cloud project';
                  } else if (errorData.error.code === 429) {
                    errorMessage = 'Rate limit reached. Try again in a few minutes';
                  } else {
                    errorMessage = errorData.error.message || `Error ${errorData.error.code}`;
                  }
                }

                throw new Error(errorMessage);
              }

              const data = await response.json();
              console.log('📍 API response received:', data);

              if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                console.error('❌ Invalid response structure:', data);
                throw new Error('Invalid API response: missing structure');
              }

              const generatedText = data.candidates[0].content.parts[0].text;
              console.log('📍 Generated text:', generatedText.substring(0, 200) + '...');

              const jsonMatch = generatedText.match(/\{[\s\S]*?\}/);

              if (jsonMatch) {
                const exercise = JSON.parse(jsonMatch[0]);
                setIsGenerating(false);
                console.log('✅ Exercise generated successfully');
                return exercise;
              } else {
                setIsGenerating(false);
                console.log('⚠️ JSON format not found, using raw text');
                return {
                  title: "AI Generated Exercise",
                  description: "Personalized exercise",
                  prompt: generatedText,
                  duration: "15 min",
                  examples: []
                };
              }
            } catch (error) {
              console.error('💥 Full error:', error);
              console.error('💥 Stack trace:', error.stack);
              alert(`⚠️ Generation error:\n\n${error.message}\n\nCheck browser console (F12) for more details.`);
              setIsGenerating(false);
              return null;
            }
          };

          const saveApiKey = () => {
            localStorage.setItem('gemini_api_key', geminiApiKey);
            setShowApiSetup(false);
            setApiKeySaved(true);
            setTimeout(() => setApiKeySaved(false), 2000);
          };

          const HomeView = () => (
            <div className="space-y-6">
              <div className="text-center py-8 bg-gradient-to-r from-teal-400/20 via-green-300/20 to-white/30 rounded-2xl border-2 border-teal-400/40 shadow-lg calm-glow">
                <h1 className="text-4xl font-bold text-wellness-primary mb-2">
                  🌺 Artist Mental Health Coach 🌺
                </h1>
                <p className="text-wellness-accent text-lg font-semibold">🌸 Wellness Edition 🌸</p>
                <p className="text-teal-600 text-sm mt-2">Your wellness support for creative wellbeing</p>
              </div>
              
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button
                  onClick={() => setCurrentView('mood')}
                  className="card-hover p-6 bg-gradient-to-br from-teal-400 to-teal-600 rounded-2xl text-gray-800 shadow-lg border-2 border-teal-400/50"
                >
                  <Flower className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Track Your Mood</h3>
                  <p className="text-teal-800">How do you feel today?</p>
                </button>

                <button
                  onClick={() => setCurrentView('journal')}
                  className="card-hover p-6 bg-gradient-to-br from-green-300 to-green-500 rounded-2xl text-gray-800 shadow-lg border-2 border-green-400/50"
                >
                  <Leaf className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Creative Journal</h3>
                  <p className="text-green-800">Write thoughts and reflections</p>
                </button>

                <button
                  onClick={() => setCurrentView('exercises')}
                  className="card-hover p-6 bg-gradient-to-br from-blue-300 to-blue-400 rounded-2xl text-gray-800 shadow-lg border-2 border-blue-400/50"
                >
                  <Plant className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Guided Exercises</h3>
                  <p className="text-blue-800">Hundreds of wellness practices</p>
                </button>

                <button
                  onClick={() => setCurrentView('progress')}
                  className="card-hover p-6 bg-gradient-to-br from-teal-400 to-teal-500 rounded-2xl text-gray-800 shadow-lg border-2 border-teal-300/50"
                >
                  <Butterfly className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Your Progress</h3>
                  <p className="text-teal-800">Visualize your journey</p>
                </button>

                <button
                  onClick={() => setCurrentView('insights')}
                  className="card-hover p-6 bg-gradient-to-br from-green-400 to-green-500 rounded-2xl text-gray-800 shadow-lg border-2 border-green-400/50"
                >
                  <Flower className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Analysis & Insights</h3>
                  <p className="text-pink-100">Discover patterns and receive feedback</p>
                </button>
              </div>

              <div className="text-center">
                <a
                  href="../assets/Guide_Artist_Mental_Health_Coach_ENG.pdf"
                  download="Guide_Artist_Mental_Health_Coach_ENG.pdf"
                  className="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-green-600 to-green-800 text-gray-800 rounded-xl hover:opacity-90 transition-opacity shadow-lg border-2 border-green-500/50 font-semibold text-lg"
                >
                  📥 Download Guide (PDF)
                </a>
              </div>

              <div className="bg-gradient-to-r from-teal-100/40 via-green-100/40 to-white/60 p-6 rounded-xl border-2 border-teal-400/50 backdrop-blur-sm">
                <h3 className="font-bold text-lg mb-3 flex items-center gap-2 text-wellness-accent">
                  <HealthyFood className="w-6 h-6" />
                  Designed for Artists and Students
                </h3>
                <p className="text-teal-700 mb-2">
                  Specific exercises for Students and Artists: manage creative block, project burnout,
                  exam anxiety and rediscover inspiration... even in the darkest nights! 🌙
                </p>
                <p className="text-teal-600 text-sm">
                  🌺 hundreds of exercises with 3 examples each | 📓 Journal | 🌸 Results analysis
                </p>
              </div>
            </div>
          );

          const MoodView = () => {
            const handleMoodClick = (mood, event) => {
              // Save the mood
              setCurrentMood(mood);
              setMoodHistory([...moodHistory, { ...mood, date: new Date().toISOString() }]);
              setSelectedMoodId(mood.id);

              // Get position of clicked button
              const rect = event.currentTarget.getBoundingClientRect();
              const targetX = (rect.left / window.innerWidth) * 100;
              const targetY = (rect.top / window.innerHeight) * 100;

              // Make the spider run toward the mood
              setPlantTarget({ x: targetX, y: targetY });

              // After animation, return to home automatically
              setTimeout(() => {
                setSelectedMoodId(null);
                setPlantTarget(null);
                setCurrentView('home');
              }, 1500);
            };

            return (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-wellness-primary">How do you feel today?</h2>
                <p className="text-teal-600">Track your daily emotional state</p>

                <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                  {moods.map(mood => (
                    <button
                      key={mood.id}
                      onClick={(e) => handleMoodClick(mood, e)}
                      className={`${mood.color} p-6 rounded-xl hover:scale-105 transition-transform shadow-md ${selectedMoodId === mood.id ? 'mood-selected' : ''}`}
                    >
                      <div className="text-5xl mb-2">{mood.emoji}</div>
                      <p className="text-teal-800 font-semibold">{mood.name}</p>
                    </button>
                  ))}
                </div>

              {currentMood && (
                <div className="bg-gradient-to-r from-teal-100/40 to-white/60 p-6 rounded-xl border-2 border-teal-400 shadow-lg animate-fadeIn backdrop-blur-sm">
                  <h3 className="text-xl font-semibold mb-2 flex items-center gap-2 text-teal-500">
                    <CheckCircle className="w-6 h-6 text-teal-500" />
                    Recorded!
                  </h3>
                  <p className="text-teal-700">
                    You recorded: <span className="font-bold text-lg text-wellness-primary">{currentMood.name}</span> {currentMood.emoji}
                  </p>
                </div>
              )}

                <button
                  onClick={() => setCurrentView('home')}
                  className="px-6 py-3 bg-gradient-to-r from-teal-400 to-teal-600 text-gray-800 rounded-lg hover:opacity-90 transition-opacity border border-teal-400"
                >
                  ← Back Home
                </button>
              </div>
            );
          };

          const JournalView = () => {
            const [entry, setEntry] = useState('');
            
            const saveEntry = () => {
              if (entry.trim()) {
                setJournalEntries([...journalEntries, { text: entry, date: new Date().toISOString() }]);
                setEntry('');
                setJournalSaved(true);
                setTimeout(() => setJournalSaved(false), 2000);
              }
            };

            return (
              <div className="space-y-6 relative">
                {journalSaved && (
                  <div className="absolute top-0 right-0 bg-green-500 text-gray-800 px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 animate-fadeIn z-10">
                    <CheckCircle className="w-5 h-5" />
                    Journal saved!
                  </div>
                )}

                <h2 className="text-3xl font-bold text-wellness-primary">Your Creative Journal</h2>
                <p className="text-teal-600">Write thoughts, reflections, inspirations</p>

                <textarea
                  value={entry}
                  onChange={(e) => setEntry(e.target.value)}
                  placeholder="Write freely here... Thoughts on projects, inspirations, doubts, successes..."
                  className="w-full h-64 p-4 border-2 border-teal-300 bg-gray-50/50 text-teal-800 rounded-xl focus:border-teal-400 focus:outline-none resize-none placeholder-teal-400/50"
                />

                <button
                  onClick={saveEntry}
                  className="px-6 py-3 bg-gradient-to-r from-teal-400 to-teal-600 text-gray-800 rounded-lg hover:opacity-90 transition-opacity border border-teal-400"
                >
                  💾 Save Entry
                </button>

                <div className="space-y-4">
                  <h3 className="text-xl font-semibold text-wellness-accent">Previous Entries:</h3>
                  {journalEntries.length === 0 ? (
                    <p className="text-teal-500 italic">No entries yet. Start writing!</p>
                  ) : (
                    <div className="space-y-3">
                      {journalEntries.slice().reverse().map((e, i) => (
                        <div key={i} className="bg-gradient-to-r from-teal-100/40 to-white/60 p-4 rounded-lg border border-teal-300/50 shadow-sm backdrop-blur-sm">
                          <p className="text-teal-500 text-sm mb-2 font-semibold">
                            📅 {new Date(e.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                          </p>
                          <p className="text-teal-800 whitespace-pre-wrap">{e.text}</p>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                <button
                  onClick={() => setCurrentView('home')}
                  className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  ← Back Home
                </button>
              </div>
            );
          };

          const ExercisesView = () => (
            <div className="space-y-6">
              <div className="flex justify-between items-center flex-wrap gap-4">
                <div>
                  <h2 className="text-3xl font-bold text-wellness-primary">Exercises for Artists</h2>
                  <p className="text-teal-600 mt-1">Choose a category to begin</p>
                </div>
                <button
                  onClick={() => setShowApiSetup(true)}
                  className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-teal-400 to-teal-500 text-gray-800 rounded-lg hover:opacity-90 transition-opacity border-2 border-teal-400/40"
                >
                  <Settings className="w-5 h-5" />
                  API Settings 🔮
                </button>
              </div>

              <div className="bg-gradient-to-r from-teal-100/40 to-white/60 border-l-4 border-teal-400 p-4 rounded-lg backdrop-blur-sm">
                <div className="flex items-start gap-3">
                  <Info className="w-5 h-5 text-teal-500 mt-0.5 flex-shrink-0" />
                  <div>
                    <p className="text-teal-600 font-semibold mb-1">💡 How it works</p>
                    <p className="text-teal-700 text-sm">
                      Each exercise includes <strong>3 practical examples</strong>.
                      Click <Shuffle className="w-4 h-4 inline" /> to change exercise,
                      or activate <Bot className="w-4 h-4 inline" /> API mode for infinite content!
                    </p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-4">
                {exerciseCategories.map(category => (
                  <button
                    key={category.id}
                    onClick={() => {
                      setSelectedExercise(category.id);
                      setCurrentVariant(getRandomVariant(category.id));
                      setCurrentView('exercise-detail');
                    }}
                    className={`card-hover p-6 bg-gradient-to-br from-sky-300 to-blue-300 rounded-2xl text-gray-800 shadow-lg relative transform transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:border-4 hover:border-teal-400`}
                  >
                    <category.icon className="w-16 h-16 mb-3 transform hover:scale-110 transition-transform" />
                    <h3 className="text-2xl font-bold mb-2">{category.title}</h3>
                    <p className="text-gray-800/90 text-lg">{category.description}</p>
                  </button>
                ))}
              </div>

              <button
                onClick={() => setCurrentView('home')}
                className="px-6 py-3 bg-gradient-to-r from-teal-400 to-teal-600 text-gray-800 rounded-lg hover:opacity-90 transition-opacity border border-teal-400"
              >
                ← Back Home
              </button>
            </div>
          );

          const ExerciseDetailView = () => {
            if (!currentVariant) return null;
            
            const categoryData = exerciseCategories.find(c => c.id === selectedExercise);
            
            const loadNewVariant = async () => {
              if (geminiApiKey && geminiApiKey.trim() !== '') {
                const generated = await generateWithGemini(selectedExercise);
                if (generated) setCurrentVariant(generated);
              } else {
                setCurrentVariant(getRandomVariant(selectedExercise));
              }
            };

            return (
              <div className="space-y-6">
                <div className="flex justify-between items-start flex-wrap gap-4">
                  <div>
                    <h2 className="text-4xl font-bold text-wellness-primary">{categoryData.title}</h2>
                    <p className="text-teal-600 mt-1 text-lg">{categoryData.description}</p>
                  </div>
                </div>

                <div className={`bg-gradient-to-br from-sky-300 to-blue-300 p-8 rounded-2xl text-gray-800 relative shadow-2xl border-4 border-teal-400/50`}>
                  
                  <div className="flex items-start justify-between mb-4 flex-wrap gap-3">
                    <div className="flex-1 min-w-[200px]">
                      <h3 className="text-2xl font-bold mb-2">{currentVariant.title}</h3>
                      <p className="text-gray-800/90 text-lg">{currentVariant.description}</p>
                    </div>
                    <div className="flex items-center gap-2 bg-gradient-to-r from-teal-400 to-teal-500 border-2 border-teal-400 backdrop-blur px-4 py-2 rounded-full flex-shrink-0 shadow-lg">
                      <Clock className="w-5 h-5" />
                      <span className="font-semibold text-lg">{currentVariant.duration}</span>
                    </div>
                  </div>

                  <div className="bg-gradient-to-r from-teal-200/60 to-teal-300/80 border-2 border-teal-400 backdrop-blur p-6 rounded-xl mb-4 shadow-inner">
                    <p className="text-xl leading-relaxed font-medium">{currentVariant.prompt}</p>
                  </div>

                  <div className="bg-gradient-to-r from-teal-200/60 to-teal-300/80 border-2 border-teal-400 backdrop-blur p-6 rounded-xl mb-4 shadow-inner">
                    <div className="flex items-center justify-between flex-wrap gap-4">
                      <div className="flex items-center gap-3">
                        <Timer className="w-6 h-6" />
                        <span className="text-xl font-bold">
                          {timerSeconds > 0 ? formatTime(timerSeconds) : currentVariant.duration}
                        </span>
                        {timerActive && timerDuration > 0 && (
                          <div className="text-sm opacity-80">
                            ({Math.round((timerSeconds / timerDuration) * 100)}% remaining)
                          </div>
                        )}
                      </div>
                      <div className="flex gap-2">
                        {timerSeconds === 0 ? (
                          <button
                            onClick={() => startTimer(currentVariant.duration)}
                            className="flex items-center gap-2 bg-gradient-to-r from-teal-400 to-teal-600 border-2 border-teal-400 hover:from-teal-500 hover:to-teal-700 px-5 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold"
                          >
                            <Play className="w-5 h-5" />
                            Start Timer
                          </button>
                        ) : (
                          <>
                            <button
                              onClick={timerActive ? pauseTimer : resumeTimer}
                              className="flex items-center gap-2 bg-gradient-to-r from-teal-400 to-teal-600 border-2 border-teal-400 hover:from-teal-500 hover:to-teal-700 px-5 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold"
                            >
                              {timerActive ? (
                                <>
                                  <Pause className="w-5 h-5" />
                                  Pause
                                </>
                              ) : (
                                <>
                                  <Play className="w-5 h-5" />
                                  Resume
                                </>
                              )}
                            </button>
                            <button
                              onClick={resetTimer}
                              className="flex items-center gap-2 bg-gradient-to-r from-pink-300 to-pink-400 border-2 border-pink-300 hover:from-pink-400 hover:to-pink-500 px-5 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold"
                            >
                              <RotateCcw className="w-5 h-5" />
                              Reset
                            </button>
                          </>
                        )}
                      </div>
                    </div>
                    {timerActive && timerDuration > 0 && (
                      <div className="mt-3 bg-gray-50/60 border-2 border-teal-400 rounded-full h-3 overflow-hidden shadow-inner">
                        <div
                          className="bg-gradient-to-r from-teal-400 via-teal-500 to-teal-600 h-full transition-all duration-1000 shadow-lg"
                          style={{ width: `${(timerSeconds / timerDuration) * 100}%` }}
                        />
                      </div>
                    )}
                  </div>

                  {currentVariant.examples && currentVariant.examples.length > 0 && (
                    <div className="bg-gradient-to-r from-teal-800/60 to-black/80 border-2 border-teal-400 backdrop-blur p-6 rounded-xl shadow-inner">
                      <button
                        onClick={() => setShowExamples(!showExamples)}
                        className="flex items-center gap-2 font-bold text-xl mb-3 hover:text-teal-600 transition-colors"
                      >
                        <Lightbulb className="w-6 h-6" />
                        {showExamples ? 'Hide' : 'Show'} 3 Practical Examples
                        <span className="text-lg ml-2">({showExamples ? '▼' : '▶'})</span>
                      </button>

                      {showExamples && (
                        <div className="space-y-3 mt-4 animate-fadeIn">
                          {currentVariant.examples.map((example, idx) => (
                            <div key={idx} className="bg-gradient-to-r from-teal-100/60 to-teal-200/80 border-2 border-teal-400 p-4 rounded-lg shadow-md">
                              <p className="leading-relaxed text-lg">{example}</p>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}

                  <div className="flex gap-3 mt-6 flex-wrap">
                    <button
                      onClick={loadNewVariant}
                      disabled={isGenerating}
                      className="flex-1 min-w-[200px] flex items-center justify-center gap-2 bg-gradient-to-r from-teal-400 to-teal-500 border-2 border-teal-400 hover:from-teal-500 hover:to-teal-600 px-6 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {isGenerating ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          Generating...
                        </>
                      ) : (
                        <>
                          <Shuffle className="w-5 h-5" />
                          {geminiApiKey ? 'Generate Exercise' : 'New Exercise'}
                        </>
                      )}
                    </button>

                    <button className="flex items-center justify-center gap-2 bg-gradient-to-r from-teal-100/50 to-teal-200/70 border border-teal-300/40 text-gray-800 hover:bg-teal-200/50 px-6 py-3 rounded-xl font-semibold transition-all">
                      <CheckCircle className="w-5 h-5" />
                      Completed
                    </button>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-teal-50 via-teal-100/50 to-teal-200 p-6 rounded-2xl shadow-lg relative border-2 border-teal-300/40">
                  {uploadSuccess && lastUploadedImage && (
                    <div className="absolute top-4 right-4 bg-gradient-to-r from-green-600 to-green-700 text-gray-800 p-4 rounded-xl shadow-2xl animate-fadeIn z-10 max-w-md">
                      <div className="flex items-start gap-3 mb-3">
                        <CheckCircle className="w-6 h-6 flex-shrink-0 mt-1" />
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-1">Photo uploaded!</h4>
                          <p className="text-sm text-green-100">AI analyzed your work</p>
                        </div>
                      </div>
                      {lastUploadedImage.aiComment && (
                        <>
                          <div className="bg-white/20 rounded-lg p-3 mb-3 text-sm">
                            <p className="text-gray-800 leading-relaxed">{lastUploadedImage.aiComment}</p>
                          </div>
                          <button
                            onClick={() => {
                              const text = `🎨 *${lastUploadedImage.exerciseTitle}*\n\n${lastUploadedImage.aiComment}\n\n_Analysis generated by Artist Mental Health Coach_`;
                              const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
                              window.open(whatsappUrl, '_blank');
                            }}
                            className="w-full bg-white text-green-700 px-4 py-2 rounded-lg font-semibold hover:bg-green-50 transition-colors flex items-center justify-center gap-2"
                          >
                            <Share2 className="w-4 h-4" />
                            Share on WhatsApp
                          </button>
                        </>
                      )}
                    </div>
                  )}

                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <Camera className="w-6 h-6" />
                    Upload Your Work
                  </h3>
                  <p className="text-teal-600 mb-4">
                    Share an image of your exercise and receive feedback
                  </p>

                  {!geminiApiKey || geminiApiKey.trim() === '' ? (
                    <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
                      <div className="flex items-start gap-3">
                        <AlertCircle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                        <div>
                          <p className="font-semibold text-yellow-800 mb-2">API Key required</p>
                          <p className="text-sm text-yellow-700 mb-3">
                            To upload images and receive feedback, you must configure your Google Gemini API key.
                          </p>
                          <button
                            onClick={() => setShowApiSetup(true)}
                            className="px-4 py-2 bg-yellow-600 text-gray-800 rounded-lg hover:bg-yellow-700 transition-colors text-sm font-semibold"
                          >
                            Configure API Key
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <>
                      {isGenerating ? (
                        <div className="flex items-center justify-center gap-3 px-6 py-4 bg-gray-300 rounded-xl cursor-not-allowed">
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          <span className="font-semibold text-gray-700">Uploading...</span>
                        </div>
                      ) : (
                        <label className="flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 rounded-xl cursor-pointer hover:from-purple-600 hover:to-pink-600 transition-all">
                          <Upload className="w-5 h-5" />
                          <span className="font-semibold">Select Image</span>
                          <input
                            type="file"
                            accept="image/*,.heic,.heif"
                            className="hidden"
                            onChange={(e) => {
                              if (e.target.files[0]) {
                                handleImageUpload(e.target.files[0]);
                                e.target.value = '';
                              }
                            }}
                          />
                        </label>
                      )}
                    </>
                  )}

                  {uploadedImages.filter(img => img.exerciseId === selectedExercise).length > 0 && (
                    <div className="mt-6">
                      <h4 className="text-lg font-semibold text-gray-800 mb-3">Your images for this exercise:</h4>
                      <div className="grid md:grid-cols-2 gap-4">
                        {uploadedImages
                          .filter(img => img.exerciseId === selectedExercise)
                          .map(img => (
                            <div key={img.id} className="bg-gray-50/40 border border-teal-700/30 rounded-lg overflow-hidden shadow">
                              <img src={img.dataUrl} alt="Artistic work" className="w-full h-48 object-cover" />
                              <div className="p-4">
                                <div className="flex justify-between items-start mb-2">
                                  <span className="text-sm text-gray-500">
                                    {new Date(img.uploadDate).toLocaleDateString('en-US')}
                                  </span>
                                  <button
                                    onClick={() => deleteImage(img.id)}
                                    className="text-rose-500 hover:text-rose-700"
                                    title="Delete"
                                  >
                                    <X className="w-5 h-5" />
                                  </button>
                                </div>
                                {img.aiComment && (
                                  <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 p-3 rounded-lg text-sm text-gray-700 border-l-4 border-green-500">
                                    <div className="flex items-start gap-2">
                                      <Bot className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                                      <p>{img.aiComment}</p>
                                    </div>
                                  </div>
                                )}
                              </div>
                            </div>
                          ))}
                      </div>
                    </div>
                  )}
                </div>

                <button
                  onClick={() => setCurrentView('exercises')}
                  className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  ← Back to Exercises
                </button>
              </div>
            );
          };

          const ProgressView = () => (
            <div className="space-y-6">
              <h2 className="text-3xl font-bold text-gray-800">Your Progress</h2>

              <div className="grid md:grid-cols-3 gap-4">
                <div className="bg-blue-100 p-6 rounded-xl shadow-md">
                  <Calendar className="w-10 h-10 text-blue-600 mb-3" />
                  <h3 className="text-3xl font-bold text-gray-800">{moodHistory.length}</h3>
                  <p className="text-teal-600">Mood Trackings</p>
                </div>

                <div className="bg-green-100 p-6 rounded-xl shadow-md">
                  <BookOpen className="w-10 h-10 text-green-600 mb-3" />
                  <h3 className="text-3xl font-bold text-gray-800">{journalEntries.length}</h3>
                  <p className="text-teal-600">Journal Entries</p>
                </div>

                <div className="bg-green-100 p-6 rounded-xl shadow-md">
                  <TrendingUp className="w-10 h-10 text-green-600 mb-3" />
                  <h3 className="text-3xl font-bold text-gray-800">{Math.max(1, moodHistory.length + journalEntries.length)}</h3>
                  <p className="text-teal-600">Active Days</p>
                </div>
              </div>

              <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 p-6 rounded-xl border border-teal-600/40 shadow-md">
                <h3 className="text-xl font-semibold mb-4">Recent Mood History</h3>
                {moodHistory.length === 0 ? (
                  <p className="text-teal-500 italic">Start tracking your mood to see progress!</p>
                ) : (
                  <div className="space-y-2">
                    {moodHistory.slice(-10).reverse().map((mood, i) => (
                      <div key={i} className="flex items-center gap-3 p-3 bg-gray-50/40 border border-teal-700/30 rounded-lg hover:bg-teal-900/50 transition-colors">
                        <span className="text-3xl">{mood.emoji}</span>
                        <div className="flex-1">
                          <p className="font-semibold">{mood.name}</p>
                          <p className="text-sm text-gray-500">
                            {new Date(mood.date).toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long' })}
                          </p>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <button
                onClick={() => setCurrentView('home')}
                className="px-6 py-3 bg-gradient-to-r from-teal-400 to-teal-600 text-gray-800 rounded-lg hover:opacity-90 transition-opacity border border-teal-400"
              >
                ← Back Home
              </button>
            </div>
          );

          const InsightsView = () => {
            const [aiReport, setAiReport] = React.useState(null);
            const stats = calculateMoodStats();
            const patterns = findMoodPatterns();

            const handleGenerateReport = async () => {
              console.log('🔘 Click su Genera Report');

              const report = await generateAIReport();
              console.log('📄 Report ricevuto:', !!report);

              if (report) {
                const reportData = {
                  id: Date.now(),
                  content: report,
                  date: new Date().toISOString(),
                  stats: {
                    totalMoods: stats?.totalMoods || 0,
                    avgMood: stats?.avgMood || 0,
                    trend: stats?.trend || 0
                  }
                };

                setSavedReports(prev => [reportData, ...prev]);

                setCurrentReport(reportData);
                setShowReportModal(true);

                const wordCount = report.split(/\s+/).length;
                const duration = (wordCount / 2) * 1000;
                console.log(`📊 ${wordCount} parole, durata: ${duration}ms (${duration/1000}s)`);

                setTimeout(() => {
                  setShowReportModal(false);
                }, duration);

                console.log('✅ Report saved and displayed');
              } else {
                console.log('⚠️ No report generated');
              }
            };

            console.log('🎨 Render InsightsView - aiReport:', !!aiReport, aiReport ? `(${aiReport.length} characters)` : 'null');

            return (
              <div className="space-y-6">
                <h2 className="text-4xl font-bold text-wellness-primary flex items-center gap-3">
                  <Brain className="w-10 h-10 text-teal-500" />
                  Analisi & Insights
                </h2>

                <div className="grid md:grid-cols-4 gap-4">
                  <div className="bg-gradient-to-br from-teal-600 to-pink-700 p-6 rounded-xl shadow-lg text-gray-800 border-2 border-teal-400">
                    <Calendar className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">{stats?.totalMoods || 0}</h3>
                    <p className="text-teal-800">Tracked moods</p>
                  </div>

                  <div className="bg-gradient-to-br from-purple-600 to-teal-700 p-6 rounded-xl shadow-lg text-gray-800 border-2 border-teal-400">
                    <Heart className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">{stats?.avgMood.toFixed(1) || '0'}/5</h3>
                    <p className="text-teal-800">Average mood</p>
                  </div>

                  <div className="bg-gradient-to-br from-pink-600 to-teal-600 p-6 rounded-xl shadow-lg text-gray-800 border-2 border-teal-400">
                    <Flower className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">{uploadedImages.length}</h3>
                    <p className="text-teal-800">Uploaded images</p>
                  </div>

                  <div className="bg-gradient-to-br from-teal-500 to-yellow-600 p-6 rounded-xl shadow-lg text-gray-800 border-2 border-teal-400">
                    <TrendingUp className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">
                      {stats?.trend > 0 ? '📈' : stats?.trend < 0 ? '📉' : '➡️'}
                    </h3>
                    <p className="text-teal-800">
                      {stats?.trend > 0 ? 'Improving' : stats?.trend < 0 ? 'To monitor' : 'Stable'}
                    </p>
                  </div>
                </div>

                {patterns.length > 0 && (
                  <div className="bg-gradient-to-r from-teal-900/40 to-black/70 border-2 border-teal-400 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-2xl font-bold text-wellness-primary mb-4 flex items-center gap-2">
                      <Sparkles className="w-6 h-6 text-teal-500" />
                      Identified Patterns
                    </h3>
                    <div className="grid md:grid-cols-2 gap-4">
                      {patterns.map((pattern, idx) => (
                        <div
                          key={idx}
                          className={`p-4 rounded-lg border-2 ${
                            pattern.type === 'positive'
                              ? 'bg-gradient-to-r from-green-900/40 to-teal-900/40 border-green-500'
                              : 'bg-gradient-to-r from-teal-900/40 to-pink-900/40 border-teal-400'
                          }`}
                        >
                          <h4 className="font-bold text-teal-700 mb-1 text-lg">{pattern.title}</h4>
                          <p className="text-sm text-teal-600">{pattern.description}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {stats && stats.recentMoods.length > 0 && (
                  <div className="bg-gradient-to-r from-teal-900/40 to-black/70 border-2 border-teal-400 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-2xl font-bold text-wellness-primary mb-4 flex items-center gap-2">
                      <BarChart className="w-6 h-6 text-teal-500" />
                      Mood Last 7 Days
                    </h3>
                    <div className="space-y-3">
                      {stats.recentMoods.slice(-7).reverse().map((entry, idx) => (
                        <div key={idx} className="flex items-center gap-3">
                          <div className="w-32 text-sm text-teal-600 font-semibold">
                            {new Date(entry.date).toLocaleDateString('en-US', { weekday: 'short', day: 'numeric', month: 'short' })}
                          </div>
                          <div className="flex-1 bg-gray-50/60 border-2 border-teal-600 rounded-full h-10 overflow-hidden">
                            <div
                              className={`h-full flex items-center px-3 text-gray-800 font-semibold ${
                                entry.mood >= 4 ? 'bg-gradient-to-r from-green-600 to-teal-500' :
                                entry.mood === 3 ? 'bg-gradient-to-r from-yellow-600 to-teal-600' :
                                'bg-gradient-to-r from-pink-600 to-teal-600'
                              }`}
                              style={{ width: `${(entry.mood / 5) * 100}%` }}
                            >
                              {entry.emoji} {entry.name}
                            </div>
                          </div>
                          <div className="w-12 text-right font-bold text-teal-700 text-lg">
                            {entry.mood}/5
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div className="bg-gradient-to-br from-teal-100/40 to-white/60 p-6 rounded-2xl border-2 border-teal-400 shadow-lg">
                  <h3 className="text-2xl font-bold text-wellness-primary mb-4 flex items-center gap-2">
                    <Flower className="w-8 h-8" />
                    Generate New Report
                  </h3>

                  <div className="text-center py-6">
                    <p className="text-teal-700 mb-4 text-lg">
                      Generate a personalized report based on your data
                    </p>
                    <button
                      onClick={handleGenerateReport}
                      disabled={generatingReport}
                      className="flex items-center justify-center gap-2 mx-auto px-8 py-4 bg-gradient-to-r from-teal-600 to-pink-700 border-2 border-teal-400 text-gray-800 rounded-xl font-bold text-lg hover:from-teal-500 hover:to-pink-600 transition-all transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {generatingReport ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          Generating...
                        </>
                      ) : (
                        <>
                          <Sparkles className="w-5 h-5" />
                          Generate Report
                        </>
                      )}
                    </button>
                  </div>
                </div>

                {uploadedImages.length > 0 && (
                  <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <Camera className="w-6 h-6" />
                      Work Gallery ({uploadedImages.length})
                    </h3>
                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {uploadedImages.map(img => (
                        <div key={img.id} className="bg-gray-50/40 border border-teal-700/30 rounded-lg overflow-hidden shadow hover:shadow-lg transition-shadow">
                          <img src={img.dataUrl} alt="Work" className="w-full h-48 object-cover" />
                          <div className="p-4 space-y-3">
                            <div>
                              <p className="text-sm font-semibold text-teal-600">{img.exerciseTitle}</p>
                              <p className="text-xs text-teal-500/70">{new Date(img.uploadDate).toLocaleDateString('en-US')}</p>
                            </div>

                            {img.aiComment && (
                              <div className="bg-green-900/30 border border-green-600/30 rounded-lg p-3">
                                <p className="text-xs text-teal-700 leading-relaxed">{img.aiComment}</p>
                              </div>
                            )}

                            <div className="flex gap-2">
                              <button
                                onClick={() => {
                                  const text = `🎨 *${img.exerciseTitle}*\n\n${img.aiComment || 'No comment available'}\n\n_Created with Artist Mental Health Coach_`;
                                  const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
                                  window.open(whatsappUrl, '_blank');
                                }}
                                className="flex-1 bg-green-600 hover:bg-green-700 text-gray-800 px-3 py-2 rounded-lg text-xs font-semibold transition-colors flex items-center justify-center gap-2"
                                title="Share on WhatsApp"
                              >
                                <Share2 className="w-4 h-4" />
                                WhatsApp
                              </button>
                              <button
                                onClick={() => deleteImage(img.id)}
                                className="bg-rose-900/50 hover:bg-rose-900/70 text-rose-300 px-3 py-2 rounded-lg transition-colors"
                                title="Delete image"
                              >
                                <Trash2 className="w-4 h-4" />
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {savedReports.length > 0 && (
                  <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <FileText className="w-6 h-6 text-green-600" />
                      Historical Reports ({savedReports.length})
                    </h3>
                    <div className="space-y-4">
                      {savedReports.map(report => (
                        <div
                          key={report.id}
                          className="bg-gradient-to-br from-teal-100/40 to-white/60 p-4 rounded-xl border-2 border-green-200 hover:shadow-md transition-shadow cursor-pointer"
                          onClick={() => {
                            setCurrentReport(report);
                            setShowReportModal(true);
                          }}
                        >
                          <div className="flex justify-between items-start mb-3">
                            <div className="flex items-center gap-2">
                              <Bot className="w-5 h-5 text-green-600" />
                              <span className="font-semibold text-gray-800">
                                {new Date(report.date).toLocaleDateString('en-US', {
                                  day: 'numeric',
                                  month: 'short',
                                  year: 'numeric',
                                  hour: '2-digit',
                                  minute: '2-digit'
                                })}
                              </span>
                            </div>
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                const updatedReports = savedReports.filter(r => r.id !== report.id);
                                setSavedReports(updatedReports);
                                localStorage.setItem('aiReports', JSON.stringify(updatedReports));
                              }}
                              className="p-1 hover:bg-rose-100 rounded-lg transition-colors"
                              title="Delete report"
                            >
                              <Trash2 className="w-4 h-4 text-rose-500" />
                            </button>
                          </div>

                          <div className="grid grid-cols-3 gap-3 mb-3 text-sm">
                            <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40/60 rounded-lg p-2 text-center">
                              <div className="font-bold text-green-600">{report.stats.totalMoods}</div>
                              <div className="text-xs text-gray-600">Mood</div>
                            </div>
                            <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40/60 rounded-lg p-2 text-center">
                              <div className="font-bold text-pink-600">{report.stats.avgMood.toFixed(1)}/5</div>
                              <div className="text-xs text-gray-600">Average</div>
                            </div>
                            <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40/60 rounded-lg p-2 text-center">
                              <div className={`font-bold ${report.stats.trend > 0 ? 'text-green-600' : report.stats.trend < 0 ? 'text-teal-600' : 'text-gray-600'}`}>
                                {report.stats.trend > 0 ? '+' : ''}{report.stats.trend.toFixed(1)}%
                              </div>
                              <div className="text-xs text-gray-600">Trend</div>
                            </div>
                          </div>

                          <p className="text-sm text-gray-600 line-clamp-2">
                            {report.content.substring(0, 150)}...
                          </p>

                          <div className="mt-3 text-sm text-green-600 font-semibold flex items-center gap-1">
                            Read full report
                            <ChevronRight className="w-4 h-4" />
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <button
                  onClick={() => setCurrentView('home')}
                  className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  ← Back Home
                </button>
              </div>
            );
          };

          const ReportModal = () => {
            if (!showReportModal || !currentReport) return null;

            return (
              <div className="fixed inset-0 bg-gray-50/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 rounded-2xl max-w-3xl w-full max-h-[85vh] overflow-y-auto shadow-2xl animate-slideIn">
                  <div className="sticky top-0 bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 p-6 rounded-t-2xl flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <Brain className="w-8 h-8" />
                      <div>
                        <h2 className="text-2xl font-bold">Generated Report</h2>
                        <p className="text-sm text-gray-800/80">
                          {new Date(currentReport.date).toLocaleDateString('en-US', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                          })}
                        </p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowReportModal(false)}
                      className="p-2 hover:bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <div className="p-8">
                    <div className="prose prose-sm max-w-none text-gray-700 whitespace-pre-line leading-relaxed">
                      {currentReport.content}
                    </div>

                    <div className="mt-6 pt-6 border-t border-teal-600/40 grid grid-cols-3 gap-4">
                      <div className="text-center">
                        <div className="text-2xl font-bold text-green-600">{currentReport.stats.totalMoods}</div>
                        <div className="text-sm text-gray-600">Tracked moods</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-pink-600">{currentReport.stats.avgMood.toFixed(1)}/5</div>
                        <div className="text-sm text-gray-600">Average mood</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-blue-600">
                          {currentReport.stats.trend > 0 ? '📈' : currentReport.stats.trend < 0 ? '📉' : '➡️'}
                        </div>
                        <div className="text-sm text-gray-600">Trend</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const GuideModal = () => {
            if (!showGuide) return null;

            return (
              <div className="fixed inset-0 bg-gray-50/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                  <div className="sticky top-0 bg-gradient-to-r from-blue-500 to-purple-500 text-gray-800 p-6 rounded-t-2xl flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <HelpCircle className="w-8 h-8" />
                      <div>
                        <h2 className="text-2xl font-bold">Guide and Instructions</h2>
                        <p className="text-sm text-gray-800/80">How to use Artist Mental Health Coach</p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowGuide(false)}
                      className="p-2 hover:bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <div className="p-8 space-y-8">
                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Heart className="w-7 h-7 text-rose-500" />
                        1. Track Your Mood
                      </h3>
                      <div className="bg-rose-50 p-5 rounded-xl space-y-3">
                        <p className="text-teal-700"><strong>What it does:</strong> Track how you feel every day using 5 emojis (from terrible to excellent).</p>
                        <p className="text-teal-700"><strong>How to use it:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Click "Track Mood" from home</li>
                          <li>Select the emoji that represents your mood</li>
                          <li>Add an optional note to remember why you feel this way</li>
                          <li>Your moods are saved automatically</li>
                        </ul>
                        <p className="text-teal-700"><strong>Why it's useful:</strong> Tracking your mood helps identify patterns and understand what influences your wellbeing.</p>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <BookOpen className="w-7 h-7 text-blue-500" />
                        2. Personal Journal
                      </h3>
                      <div className="bg-blue-50 p-5 rounded-xl space-y-3">
                        <p className="text-teal-700"><strong>What it does:</strong> Write thoughts, reflections, and daily experiences.</p>
                        <p className="text-teal-700"><strong>How to use it:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Click "Journal" from home</li>
                          <li>Write freely in the text field</li>
                          <li>Press "Save Journal" to preserve your reflection</li>
                          <li>View your previous entries by scrolling down</li>
                        </ul>
                        <p className="text-teal-700"><strong>Why it's useful:</strong> Therapeutic writing helps process emotions and reduce stress.</p>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Palette className="w-7 h-7 text-green-500" />
                        3. Creative Exercises
                      </h3>
                      <div className="bg-green-50 p-5 rounded-xl space-y-3">
                        <p className="text-teal-700"><strong>What it does:</strong> Hundreds of creative exercises specifically for Students and Artists.</p>
                        <p className="text-teal-700"><strong>How to use it:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Click "Exercises" from home</li>
                          <li>Choose a category (Drawing, Painting, Sculpture, etc.)</li>
                          <li>Each exercise has 3 variants with examples</li>
                          <li>Click "Generate New" to get fresh ideas (requires API)</li>
                        </ul>
                        <p className="text-teal-700"><strong>Extra features:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li><strong>Timer:</strong> Set durations (e.g., "5m", "30m", "1h") for timed exercises</li>
                          <li><strong>Photo Upload:</strong> Upload images of your work and receive feedback</li>
                        </ul>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <BarChart className="w-7 h-7 text-green-500" />
                        4. Analysis and Insights
                      </h3>
                      <div className="bg-green-50 p-5 rounded-xl space-y-3">
                        <p className="text-teal-700"><strong>What it does:</strong> Analyzes your data and identifies patterns in your wellbeing.</p>
                        <p className="text-teal-700"><strong>What you'll find:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li><strong>Statistics:</strong> Total moods tracked, average, increasing/decreasing trends</li>
                          <li><strong>Patterns:</strong> Best/worst days of the week, positive streaks</li>
                          <li><strong>Chart:</strong> Visualization of last 7 days</li>
                          <li><strong>Report:</strong> Personalized analysis with recommendations (requires API)</li>
                          <li><strong>Historical Reports:</strong> All reports generated in the past</li>
                          <li><strong>Gallery:</strong> All your uploaded images</li>
                        </ul>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Key className="w-7 h-7 text-yellow-500" />
                        5. API Configuration (Optional)
                      </h3>
                      <div className="bg-yellow-50 p-5 rounded-xl space-y-3">
                        <p className="text-teal-700"><strong>What it does:</strong> Enables advanced features using Google Gemini.</p>
                        <p className="text-teal-700"><strong>How to configure:</strong></p>
                        <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                          <li>Go to <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener" className="text-blue-600 underline">Google AI Studio</a></li>
                          <li>Log in with your Google account</li>
                          <li>Click "Create API Key"</li>
                          <li>Copy the generated key</li>
                          <li>Return to the app and click "Configure API Key", then paste the key</li>
                        </ol>
                        <p className="text-teal-700"><strong>Features unlocked with API:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Infinite generation of new creative exercises</li>
                          <li>Feedback on your uploaded artwork</li>
                          <li>Personalized reports based on your data</li>
                        </ul>
                        <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 p-4 rounded-lg border-l-4 border-yellow-500 mt-3">
                          <p className="text-sm text-gray-700"><strong>🔒 Privacy:</strong> Your API key is saved only on your device (localStorage). It's never sent to external servers except directly to Google Gemini.</p>
                          <p className="text-sm text-gray-700 mt-2"><strong>💰 Cost:</strong> Google Gemini has a generous free tier. Perfect for personal use!</p>
                        </div>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Camera className="w-7 h-7 text-indigo-500" />
                        6. Photo Upload (iPhone Compatible)
                      </h3>
                      <div className="bg-indigo-50 p-5 rounded-xl space-y-3">
                        <p className="text-teal-700"><strong>What it does:</strong> Upload photos of your artwork and receive feedback.</p>
                        <p className="text-teal-700"><strong>How to use it:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Go to a specific exercise</li>
                          <li>Click "Select Image"</li>
                          <li>Choose a photo from gallery or take a new one</li>
                          <li>The image is automatically resized (optimized for iPhone)</li>
                          <li>If API is active, receive personalized feedback</li>
                        </ul>
                        <p className="text-teal-700"><strong>Supported formats:</strong> JPG, PNG, HEIC (native iPhone photos)</p>
                      </div>
                    </section>

                    <section className="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-xl">
                      <h3 className="text-xl font-bold text-gray-800 mb-3">💡 Useful Tips</h3>
                      <ul className="space-y-2 text-gray-700">
                        <li>✅ Track your mood every day for accurate analysis</li>
                        <li>✅ Write in your journal when feeling overwhelmed - it helps!</li>
                        <li>✅ Try different creative exercises to find what relaxes you</li>
                        <li>✅ Use the timer for focused work sessions</li>
                        <li>✅ Upload photos of your work to track progress</li>
                        <li>✅ Generate reports weekly to see your progress</li>
                      </ul>
                    </section>

                    <section className="text-center pt-4 border-t border-teal-600/40">
                      <p className="text-teal-600">
                        Developed with ❤️ for Students and Artists
                      </p>
                      <p className="text-sm text-teal-500 mt-2">
                        Have questions or suggestions? <button onClick={() => { setShowGuide(false); setShowContactForm(true); }} className="text-green-400 hover:text-green-300 underline font-semibold">Contact Me</button>
                      </p>
                    </section>
                  </div>
                </div>
              </div>
            );
          };

          const ContactFormModal = () => {
            const [formData, setFormData] = useState({
              name: userProfile?.name || '',
              email: userProfile?.email || '',
              message: ''
            });
            const [sending, setSending] = useState(false);
            const [sent, setSent] = useState(false);
            const [error, setError] = useState('');

            if (!showContactForm) return null;

            const handleSubmit = async (e) => {
              e.preventDefault();
              setSending(true);
              setError('');

              try {
                // Usa Web3Forms per inviare email direttamente
                const response = await fetch('https://api.web3forms.com/submit', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    access_key: 'c99e581c-6e45-4d7a-b889-abeb30f38fb1',
                    name: formData.name,
                    email: formData.email,
                    message: formData.message,
                    subject: '🎨 Nuovo messaggio da Artist Mental Health Coach',
                  })
                });

                const result = await response.json();

                if (result.success) {
                  setSent(true);
                  setTimeout(() => {
                    setShowContactForm(false);
                    setSent(false);
                    setFormData({
                      name: userProfile?.name || '',
                      email: userProfile?.email || '',
                      message: ''
                    });
                  }, 3000);
                } else {
                  setError('Error sending. Try again later.');
                }
              } catch (err) {
                setError('Connection error. Check your network.');
              } finally {
                setSending(false);
              }
            };

            return (
              <div className="fixed inset-0 bg-gray-50/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 rounded-2xl max-w-lg w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 p-6 rounded-t-2xl flex justify-between items-center">
                    <div>
                      <h2 className="text-2xl font-bold">📬 Contact Me</h2>
                      <p className="text-sm text-gray-800/80">Send a message or suggestion</p>
                    </div>
                    <button
                      onClick={() => setShowContactForm(false)}
                      className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <div className="p-6">
                    {sent ? (
                      <div className="text-center py-8">
                        <CheckCircle className="w-16 h-16 text-green-400 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-green-300 mb-2">Message inviato!</h3>
                        <p className="text-teal-600">I'll reply as soon as possible. Thank you! 🎨</p>
                      </div>
                    ) : (
                      <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                          <label className="block text-teal-600 font-semibold mb-2">Name</label>
                          <input
                            type="text"
                            required
                            value={formData.name}
                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                            className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                            placeholder="Your name"
                          />
                        </div>

                        <div>
                          <label className="block text-teal-600 font-semibold mb-2">Email</label>
                          <input
                            type="email"
                            required
                            value={formData.email}
                            onChange={(e) => setFormData({...formData, email: e.target.value})}
                            className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                            placeholder="your@email.com"
                          />
                        </div>

                        <div>
                          <label className="block text-teal-600 font-semibold mb-2">Message</label>
                          <textarea
                            required
                            value={formData.message}
                            onChange={(e) => setFormData({...formData, message: e.target.value})}
                            rows="5"
                            className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none resize-none placeholder-teal-400/50"
                            placeholder="Write your message, suggestion or question..."
                          />
                        </div>

                        {error && (
                          <div className="bg-rose-900/30 border border-rose-500 text-rose-300 p-3 rounded-lg text-sm">
                            {error}
                          </div>
                        )}

                        <button
                          type="submit"
                          disabled={sending}
                          className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                          {sending ? (
                            <>
                              <RefreshCw className="w-5 h-5 animate-spin" />
                              Sending...
                            </>
                          ) : (
                            <>
                              📤 Invia Message
                            </>
                          )}
                        </button>
                      </form>
                    )}
                  </div>
                </div>
              </div>
            );
          };

          const ProfileBenefitsModal = () => {
            if (!showProfileBenefits) return null;

            return (
              <div className="fixed inset-0 bg-gray-50/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-purple-900/30 to-black/70 border border-green-600/40 rounded-2xl max-w-lg w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 p-6 rounded-t-2xl">
                    <h2 className="text-2xl font-bold flex items-center gap-2">
                      <Sparkles className="w-8 h-8" />
                      Why create a Profile?
                    </h2>
                    <p className="text-sm text-gray-800/80 mt-1">Discover the benefits of having a personalized profile</p>
                  </div>

                  <div className="p-6 space-y-4">
                    <div className="space-y-3">
                      <div className="flex items-start gap-3 bg-green-900/20 p-4 rounded-lg border border-green-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-teal-600">Personalized greeting</h3>
                          <p className="text-sm text-teal-700">We'll greet you by name every time</p>
                        </div>
                      </div>

                      <div className="flex items-start gap-3 bg-green-900/20 p-4 rounded-lg border border-green-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-teal-600">Quick contact form</h3>
                          <p className="text-sm text-teal-700">Pre-filled email when you contact me</p>
                        </div>
                      </div>

                      <div className="flex items-start gap-3 bg-green-900/20 p-4 rounded-lg border border-green-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-teal-600">Registered User Badge</h3>
                          <p className="text-sm text-teal-700">Show your special status in the app</p>
                        </div>
                      </div>

                      <div className="flex items-start gap-3 bg-green-900/20 p-4 rounded-lg border border-green-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-teal-600">Data always yours</h3>
                          <p className="text-sm text-teal-700">Everything saved locally on your device</p>
                        </div>
                      </div>
                    </div>

                    <div className="bg-yellow-900/30 border-l-4 border-yellow-500 p-4 rounded">
                      <p className="text-sm text-yellow-200">
                        <strong>100% Free</strong> • No spam emails • Privacy guaranteed
                      </p>
                    </div>

                    <div className="flex gap-3">
                      <button
                        onClick={() => {
                          setShowProfileBenefits(false);
                          setShowProfileModal(true);
                        }}
                        className="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                      >
                        ✨ Create my Profile
                      </button>
                      <button
                        onClick={() => setShowProfileBenefits(false)}
                        className="px-6 py-3 bg-teal-900/50 text-teal-700 rounded-lg hover:bg-teal-900/70 transition-colors border border-teal-600"
                      >
                        Maybe later
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const ProfileModal = () => {
            const [formData, setFormData] = useState({ name: '', email: '' });
            const [error, setError] = useState('');

            if (!showProfileModal) return null;

            const handleSubmit = (e) => {
              e.preventDefault();
              if (!formData.name.trim() || !formData.email.trim()) {
                setError('Compila tutti i campi');
                return;
              }

              setUserProfile({
                name: formData.name,
                email: formData.email,
                createdAt: new Date().toISOString()
              });

              setShowProfileModal(false);
            };

            return (
              <div className="fixed inset-0 bg-gray-50/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 rounded-2xl max-w-md w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 p-6 rounded-t-2xl flex justify-between items-center">
                    <div>
                      <h2 className="text-2xl font-bold">🎨 Create your Profile</h2>
                      <p className="text-sm text-gray-800/80">Only 2 pieces of information needed</p>
                    </div>
                    <button
                      onClick={() => setShowProfileModal(false)}
                      className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <form onSubmit={handleSubmit} className="p-6 space-y-4">
                    <div>
                      <label className="block text-teal-600 font-semibold mb-2">What's your name?</label>
                      <input
                        type="text"
                        required
                        value={formData.name}
                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                        placeholder="Your name"
                      />
                    </div>

                    <div>
                      <label className="block text-teal-600 font-semibold mb-2">Email</label>
                      <input
                        type="email"
                        required
                        value={formData.email}
                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                        placeholder="your@email.com"
                      />
                      <p className="text-xs text-teal-500 mt-1">
                        🔒 Saved only on your device
                      </p>
                    </div>

                    {error && (
                      <div className="bg-rose-900/30 border border-rose-500 text-rose-300 p-3 rounded-lg text-sm">
                        {error}
                      </div>
                    )}

                    <button
                      type="submit"
                      className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                    >
                      ✨ Create Profile
                    </button>
                  </form>
                </div>
              </div>
            );
          };

          const FirebaseAuthModal = () => {
            const [isLogin, setIsLogin] = useState(true);
            const [formData, setFormData] = useState({ email: '', password: '', name: '' });
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            if (!showFirebaseAuth) return null;

            const handleSubmit = async (e) => {
              e.preventDefault();
              setError('');
              setLoading(true);

              try {
                if (isLogin) {
                  // Login
                  await auth.signInWithEmailAndPassword(formData.email, formData.password);
                  setShowFirebaseAuth(false);
                } else {
                  // Registrazione
                  const userCredential = await auth.createUserWithEmailAndPassword(formData.email, formData.password);
                  // Aggiorna il profilo con il nome
                  await userCredential.user.updateProfile({
                    displayName: formData.name
                  });
                  setShowFirebaseAuth(false);
                }
              } catch (err) {
                console.error('Auth error:', err);
                if (err.code === 'auth/email-already-in-use') {
                  setError('Email already registered. Try logging in.');
                } else if (err.code === 'auth/weak-password') {
                  setError('Password too weak. Use at least 6 characters.');
                } else if (err.code === 'auth/invalid-email') {
                  setError('Invalid email.');
                } else if (err.code === 'auth/user-not-found' || err.code === 'auth/wrong-password') {
                  setError('Incorrect email or password.');
                } else {
                  setError('Authentication error. Try again.');
                }
              } finally {
                setLoading(false);
              }
            };

            return (
              <div className="fixed inset-0 bg-gray-50/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-purple-900/30 to-black/70 border border-green-600/40 rounded-2xl max-w-md w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-blue-500 to-purple-600 text-gray-800 p-6 rounded-t-2xl flex justify-between items-center">
                    <div>
                      <h2 className="text-2xl font-bold flex items-center gap-2">
                        <Cloud className="w-7 h-7" />
                        {isLogin ? 'Login' : 'Register'}
                      </h2>
                      <p className="text-sm text-gray-800/80">Sync your data to cloud</p>
                    </div>
                    <button
                      onClick={() => setShowFirebaseAuth(false)}
                      className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <form onSubmit={handleSubmit} className="p-6 space-y-4">
                    {!isLogin && (
                      <div>
                        <label className="block text-teal-600 font-semibold mb-2">Name</label>
                        <input
                          type="text"
                          required
                          value={formData.name}
                          onChange={(e) => setFormData({...formData, name: e.target.value})}
                          className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                          placeholder="Your name"
                        />
                      </div>
                    )}

                    <div>
                      <label className="block text-teal-600 font-semibold mb-2">Email</label>
                      <input
                        type="email"
                        required
                        value={formData.email}
                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                        placeholder="your@email.com"
                      />
                    </div>

                    <div>
                      <label className="block text-teal-600 font-semibold mb-2">Password</label>
                      <input
                        type="password"
                        required
                        value={formData.password}
                        onChange={(e) => setFormData({...formData, password: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-teal-600 bg-gray-50/50 text-teal-800 rounded-lg focus:border-green-500 focus:outline-none placeholder-teal-400/50"
                        placeholder="Minimum 6 characters"
                        minLength="6"
                      />
                    </div>

                    {error && (
                      <div className="bg-rose-900/30 border border-rose-500 text-rose-300 p-3 rounded-lg text-sm">
                        {error}
                      </div>
                    )}

                    <button
                      type="submit"
                      disabled={loading}
                      className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-gray-800 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      {loading ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          {isLogin ? 'Logging in...' : 'Registering...'}
                        </>
                      ) : (
                        <>
                          <Cloud className="w-5 h-5" />
                          {isLogin ? 'Login' : 'Register'}
                        </>
                      )}
                    </button>

                    <div className="text-center">
                      <button
                        type="button"
                        onClick={() => {
                          setIsLogin(!isLogin);
                          setError('');
                          setFormData({ email: '', password: '', name: '' });
                        }}
                        className="text-teal-600 hover:text-teal-700 text-sm underline"
                      >
                        {isLogin ? "Don't have an account? Register" : 'Already have an account? Login'}
                      </button>
                    </div>

                    <div className="bg-blue-900/30 border-l-4 border-blue-500 p-3 rounded">
                      <p className="text-xs text-blue-200">
                        <strong>🔒 Safe and private</strong> • Your data is synchronized on Firebase Cloud • Accessible from any device
                      </p>
                    </div>
                  </form>
                </div>
              </div>
            );
          };

          const ApiSetupModal = () => (
            <div className="fixed inset-0 bg-gray-50/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
              <div className="bg-gradient-to-r from-teal-900/30 to-black/70 border border-teal-600/40 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 shadow-2xl">
                <div className="flex justify-between items-start mb-6">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">🤖 Gemini API Configuration</h2>
                    <p className="text-teal-600">Activate API for infinite personalized exercises</p>
                  </div>
                  <button 
                    onClick={() => setShowApiSetup(false)} 
                    className="p-2 hover:bg-teal-900/50 rounded-lg transition-colors"
                  >
                    <X className="w-6 h-6" />
                  </button>
                </div>

                <div className="space-y-6">
                  <div className="bg-gradient-to-br from-teal-100/40 to-white/60 p-6 rounded-xl border-2 border-green-200">
                    <h3 className="font-bold text-lg mb-3 flex items-center gap-2">
                      <Sparkles className="w-5 h-5 text-green-600" />
                      API Mode Benefits
                    </h3>
                    <ul className="space-y-2 text-gray-700">
                      <li className="flex items-start gap-2">
                        <CheckCircle className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                        <span><strong>Infinite exercises:</strong> Always new and different content</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <CheckCircle className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                        <span><strong>Personalized:</strong> Exercises specific to your artistic context</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <CheckCircle className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                        <span><strong>Free:</strong> Google Gemini API ha un tier gratuito generoso (60 richieste/minuto)</span>
                      </li>
                    </ul>
                  </div>

                  <div className="space-y-4">
                    <h3 className="font-bold text-lg">📋 Setup Veloce (5 minuti)</h3>
                    <div className="space-y-3">
                      {[
                        { 
                          n: 1, 
                          title: "Vai su Google AI Studio", 
                          content: <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline text-sm flex items-center gap-1">https://aistudio.google.com/app/apikey <span className="text-xs">🔗</span></a> 
                        },
                        { n: 2, title: "Login with Google", content: "Use any personal Gmail account" },
                        { n: 3, title: 'Click "Create API Key"', content: "Choose existing project or create new one" },
                        { n: 4, title: "Copy your API Key", content: "String like: AIzaSy..." },
                        { n: 5, title: "Paste below", content: "Saved only on your device, 100% private" }
                      ].map(step => (
                        <div key={step.n} className="flex gap-3">
                          <div className="flex-shrink-0 w-8 h-8 bg-green-500 text-gray-800 rounded-full flex items-center justify-center font-bold text-sm">
                            {step.n}
                          </div>
                          <div className="flex-1">
                            <p className="font-semibold mb-1">{step.title}</p>
                            <div className="text-sm text-gray-600">{step.content}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block font-semibold mb-2 flex items-center gap-2">
                      <Key className="w-5 h-5" />
                      Enter your API Key
                    </label>
                    <input
                      type="password"
                      value={geminiApiKey}
                      onChange={(e) => setGeminiApiKey(e.target.value)}
                      placeholder="AIzaSy..."
                      className="w-full px-4 py-3 border-2 border-teal-600 rounded-lg focus:border-green-500 focus:outline-none font-mono text-sm"
                    />
                    <p className="text-xs text-gray-500 mt-2 flex items-center gap-1">
                      🔒 Salvata solo localmente nel browser, mai inviata a server esterni
                    </p>
                  </div>

                  <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    <div className="flex gap-3">
                      <AlertCircle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                      <div className="text-sm text-yellow-800">
                        <p className="font-semibold mb-1">⚠️ Security</p>
                        <p>Never share your API key. Gemini's free tier has limits that protect from accidental abuse.</p>
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-3 flex-wrap">
                    <button
                      onClick={saveApiKey}
                      disabled={!geminiApiKey.trim()}
                      className="flex-1 min-w-[150px] bg-gradient-to-r from-purple-500 to-pink-500 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      💾 Save API Key
                    </button>
                    <button
                      onClick={() => setShowApiSetup(false)}
                      className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                    >
                      Close
                    </button>
                  </div>

                  {geminiApiKey && (
                    <div className="bg-green-50 border-l-4 border-green-400 p-4 rounded animate-fadeIn">
                      <div className="flex items-center gap-2 text-green-800">
                        <CheckCircle className="w-5 h-5" />
                        <span className="font-semibold">API Key configured!</span>
                      </div>
                      <p className="text-sm text-green-700 mt-1">
                        Now you can enable API mode in exercises to generate infinite content
                      </p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );

          return (
            <div className="min-h-screen bg-gray-50 p-4">
              {/* Bottoni Profilo e Firebase Fissi */}
              <div className="fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-[200px]">
                {/* Change Version Button */}
                <a
                  href="../index.html"
                  className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all border-2 border-purple-400 flex items-center gap-2 justify-center text-sm font-semibold"
                  title="Change language or theme"
                >
                  <span>🌍</span>
                  <span>Change Version</span>
                </a>
                {firebaseUser ? (
                  <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-gray-800 px-4 py-2 rounded-full shadow-lg border-2 border-blue-400 flex items-center gap-2">
                    <Cloud className="w-5 h-5" />
                    <span className="font-semibold">{firebaseUser.displayName || firebaseUser.email}</span>
                    <button
                      onClick={() => auth.signOut()}
                      className="ml-2 p-1 hover:bg-white/20 rounded-full transition-colors"
                      title="Logout"
                    >
                      <LogOut className="w-4 h-4" />
                    </button>
                  </div>
                ) : userProfile ? (
                  <>
                    <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-gray-800 px-4 py-2 rounded-full shadow-lg border-2 border-green-400 flex items-center gap-2">
                      <User className="w-5 h-5" />
                      <span className="font-semibold">Ciao, {userProfile.name}!</span>
                    </div>
                    <button
                      onClick={() => setShowFirebaseAuth(true)}
                      className="bg-gradient-to-r from-blue-500 to-blue-700 text-gray-800 px-4 py-2 rounded-full shadow-lg hover:shadow-xl transition-all border-2 border-blue-400 flex items-center gap-2"
                      title="Sync to Cloud"
                    >
                      <Cloud className="w-5 h-5" />
                      <span className="font-semibold text-sm">Sync Cloud</span>
                    </button>
                  </>
                ) : (
                  <>
                    <button
                      onClick={() => setShowFirebaseAuth(true)}
                      className="bg-gradient-to-r from-teal-500/90 via-teal-600/90 to-teal-700/90 md:from-teal-500 md:via-teal-600 md:to-teal-700 text-gray-800 px-4 py-2 md:px-6 md:py-3 rounded-xl shadow-2xl hover:shadow-3xl hover:scale-105 transition-all border-2 border-teal-300/50 backdrop-blur-sm calm-glow animate-pulse"
                    >
                      <div className="flex items-center gap-2 font-bold">
                        <span className="text-xl md:text-2xl">🌺</span>
                        <div className="text-left">
                          <div className="text-xs md:text-sm leading-tight">Register GRATIS</div>
                          <div className="text-[10px] md:text-xs font-normal opacity-90">Get the treats</div>
                        </div>
                      </div>
                    </button>
                    <button
                      onClick={() => setShowProfileBenefits(true)}
                      className="bg-gray-700/60 md:bg-gray-700/80 hover:bg-gray-600/80 text-gray-300 px-3 py-1.5 md:px-4 md:py-2 rounded-lg shadow-md hover:shadow-lg transition-all border border-gray-600/50 backdrop-blur-sm flex items-center gap-2 text-xs md:text-sm"
                    >
                      <span>👤</span>
                      <span className="font-medium">Just Visiting <span className="text-[10px] md:text-xs opacity-70">(no candies)</span></span>
                    </button>
                  </>
                )}
              </div>

              {/* Ragno animato controllato */}
              <div
                className={`butterfly-float ${plantScared ? 'plant-scared' : plantTarget ? 'plant-run-to-target' : ''}`}
                onClick={(e) => {
                  e.stopPropagation();
                  // Calculate random far position to run away
                  const randomX = Math.random() * 100;
                  const randomY = Math.random() * 100;
                  setPlantScared({ x: randomX, y: randomY });
                  setPlantTarget(null);

                  // Return to normal after it finishes running away
                  setTimeout(() => {
                    setPlantScared(false);
                  }, 3000);
                }}
                style={{
                  ...(plantTarget || plantScared) ? {
                    top: `${(plantTarget || plantScared)?.y || 0}%`,
                    left: `${(plantTarget || plantScared)?.x || 0}%`
                  } : {},
                  cursor: 'pointer',
                  pointerEvents: 'auto'
                }}
              >
                🌿
              </div>

              <div className="max-w-5xl mx-auto py-6">
                <div className="bg-gradient-to-br from-white via-teal-50 to-green-50 rounded-3xl shadow-2xl p-6 md:p-8 border-2 border-teal-400/30">
                  {currentView === 'home' && <HomeView />}
                  {currentView === 'mood' && <MoodView />}
                  {currentView === 'journal' && <JournalView />}
                  {currentView === 'exercises' && <ExercisesView />}
                  {currentView === 'exercise-detail' && <ExerciseDetailView />}
                  {currentView === 'progress' && <ProgressView />}
                  {currentView === 'insights' && <InsightsView />}
                </div>

                <div className="text-center mt-6 text-teal-600 text-sm space-y-4">
                  <p className="text-wellness-primary font-bold">🌺 Artist Mental Health Coach v2.0 - Wellness Edition 🌺</p>
                  <p className="mt-1 text-wellness-accent">Made with 🧡 for artists • hundreds of spectral exercises</p>

                  {/* Bottoni Condivisione e Donazione */}
                  <div className="flex justify-center gap-3 flex-wrap mt-4">
                    <button
                      onClick={() => {
                        const text = `🌺 *Artist Mental Health Coach* 🎨\n\nA free mental wellbeing app dedicated to students and artists!\n\n✨ Track your mood\n📝 Personal journal\n🖼️ AI analysis of your artwork\n🧘 Hundreds of creative exercises\n\nTry it now: ${window.location.href}`;
                        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
                        window.open(whatsappUrl, '_blank');
                      }}
                      className="bg-green-600 hover:bg-green-700 text-gray-800 px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 shadow-lg"
                    >
                      <Share2 className="w-4 h-4" />
                      WhatsApp
                    </button>

                    <button
                      onClick={() => {
                        const shareUrl = window.location.href;
                        const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
                        window.open(facebookUrl, '_blank');
                      }}
                      className="bg-blue-600 hover:bg-blue-700 text-gray-800 px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 shadow-lg"
                    >
                      <Share2 className="w-4 h-4" />
                      Facebook
                    </button>

                    <button
                      onClick={() => {
                        alert('To share on Instagram:\n\n1. Take a screenshot of the app\n2. Open Instagram\n3. Create a new Story\n4. Upload the screenshot\n5. Add the link: ' + window.location.href);
                      }}
                      className="bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-gray-800 px-4 py-2 rounded-lg font-semibold transition-opacity flex items-center gap-2 shadow-lg"
                    >
                      <Share2 className="w-4 h-4" />
                      Instagram
                    </button>

                    <button
                      onClick={() => {
                        window.open('https://paypal.me/FrancescoMarianoIT', '_blank');
                      }}
                      className="bg-gradient-to-r from-teal-600 to-pink-600 hover:opacity-90 text-gray-800 px-4 py-2 rounded-lg font-semibold transition-opacity flex items-center gap-2 shadow-lg"
                    >
                      ❤️ Support the project
                    </button>
                  </div>

                  <div className="mt-4 pt-4 border-t border-teal-400/30">
                    <p className="text-teal-700 font-medium">Designed and developed by: Francesco Mariano</p>
                    <p className="text-teal-500 text-xs mt-1">2023 • Wellness Edition: October 31, 2025</p>
                    <p className="text-teal-600 mt-2">
                      <button
                        onClick={() => setShowContactForm(true)}
                        className="text-wellness-primary hover:text-wellness-accent underline font-semibold"
                      >
                        📬 Send feedback or suggestions
                      </button>
                    </p>
                  </div>
                </div>
              </div>

              {showApiSetup && <ApiSetupModal />}
              <ReportModal />
              <GuideModal />
              <ContactFormModal />
              <ProfileBenefitsModal />
              <ProfileModal />
              <FirebaseAuthModal />

              <button
                onClick={() => setShowGuide(true)}
                className="fixed bottom-24 right-6 bg-gradient-to-r from-teal-600 to-purple-700 text-gray-800 p-4 rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 z-40 flex items-center gap-2 group calm-glow border-2 border-teal-400/50"
                title="Guide and Instructions"
              >
                <Flower className="w-6 h-6" />
                <span className="hidden group-hover:inline-block font-semibold pr-2 whitespace-nowrap">
                  Guide
                </span>
              </button>

              {apiKeySaved && (
                <div className="fixed top-4 right-4 bg-green-500 text-gray-800 px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-fadeIn z-50">
                  <CheckCircle className="w-5 h-5" />
                  API Key saved successfully!
                </div>
              )}
            </div>
          );
        };

        ReactDOM.render(<MentalHealthCoachArte />, document.getElementById('root'));
    </script>
</body>
</html>