
<!DOCTYPE html>
<html lang="it">
<!--
  Artist Mental Health Coach 
  Ideato e sviluppato da: Francesco Mariano
  2023
  Contatti: francescomariano@gmail.com
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Mental Health Coach</title>

    <meta name="description" content="Un coach per il benessere mentale dedicato a Studenti e Artisti. Traccia il tuo mood, pratica esercizi creativi e ricevi supporto personalizzato.">
    <meta name="author" content="Francesco Mariano">

    <meta property="og:title" content="Artist Mental Health Coach">
    <meta property="og:description" content="Un coach per il benessere mentale dedicato a Studenti e Artisti. Traccia il tuo mood, pratica esercizi creativi e ricevi supporto personalizzato.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://francmo.github.io/artist-mental-health-coach-4-lang/assets/og-image.png">
    <meta property="og:url" content="https://tuodominio.com">
    <meta property="og:site_name" content="Artist Mental Health Coach">
    <meta property="og:locale" content="it_IT">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Artist Mental Health Coach">
    <meta name="twitter:description" content="Un coach per il benessere mentale dedicato a Studenti e Artisti. Traccia il tuo mood, pratica esercizi creativi e ricevi supporto personalizzato.">
    <meta name="twitter:image" content="https://i.imgur.com/placeholder.png">

    <meta name="theme-color" content="#ff6b35">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK (versione 10.x compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #1a0b2e;
            overflow-x: hidden;
        }

        /* Halloween Gradient Background */
        .gradient-art {
            background: linear-gradient(135deg, #ff6b35 0%, #9b4dca 50%, #1a0b2e 100%);
            position: relative;
            overflow: hidden;
        }

        /* Spooky fog effect */
        .gradient-art::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse at 50% 100%, rgba(155, 77, 202, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 50%, rgba(255, 107, 53, 0.2) 0%, transparent 50%),
                radial-gradient(ellipse at 100% 50%, rgba(255, 107, 53, 0.2) 0%, transparent 50%);
            animation: fogMove 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes fogMove {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 0.6; transform: translateY(-20px); }
        }

        /* Floating bats */
        @keyframes batFly {
            0% { transform: translateX(-100px) translateY(0) scale(1); }
            25% { transform: translateX(25vw) translateY(-30px) scale(0.8); }
            50% { transform: translateX(50vw) translateY(20px) scale(1.1); }
            75% { transform: translateX(75vw) translateY(-10px) scale(0.9); }
            100% { transform: translateX(calc(100vw + 100px)) translateY(0) scale(1); }
        }

        .bat {
            position: fixed;
            font-size: 24px;
            animation: batFly 15s linear infinite;
            z-index: 1000;
            pointer-events: none;
            opacity: 0.7;
        }

        .bat:nth-child(2) { animation-delay: 5s; top: 20%; }
        .bat:nth-child(3) { animation-delay: 10s; top: 60%; animation-duration: 18s; }

        /* Floating ghosts */
        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0.6; }
            25% { transform: translateY(-20px) translateX(10px); opacity: 0.8; }
            50% { transform: translateY(-10px) translateX(-10px); opacity: 0.6; }
            75% { transform: translateY(-30px) translateX(5px); opacity: 0.7; }
        }

        .ghost {
            position: fixed;
            font-size: 32px;
            animation: ghostFloat 6s ease-in-out infinite;
            z-index: 999;
            pointer-events: none;
        }

        .ghost:nth-child(2) { animation-delay: 2s; right: 10%; top: 20%; animation-duration: 8s; }
        .ghost:nth-child(3) { animation-delay: 4s; left: 15%; bottom: 20%; animation-duration: 7s; }

        /* Pumpkin pulse */
        @keyframes pumpkinPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3); }
        }

        .pumpkin {
            display: inline-block;
            animation: pumpkinPulse 2s ease-in-out infinite;
        }

        /* Blood drops animation */
        @keyframes bloodDrip {
            0% {
                transform: translateY(-20px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0.8;
            }
        }

        .blood-drop {
            position: fixed;
            width: 12px;
            height: 12px;
            background: #8b0000;
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            animation: bloodDrip linear infinite;
            z-index: 9999;
            pointer-events: none;
            filter: drop-shadow(0 0 5px #ff0000) drop-shadow(0 0 10px #ff0000);
        }

        .blood-drop::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ff0000, #8b0000);
            border-radius: 50%;
            top: -50%;
            left: 0;
        }

        .blood-drop:nth-child(1) { left: 10%; animation-duration: 3s; animation-delay: 0s; }
        .blood-drop:nth-child(2) { left: 25%; animation-duration: 3.5s; animation-delay: 1s; }
        .blood-drop:nth-child(3) { left: 40%; animation-duration: 2.8s; animation-delay: 0.5s; }
        .blood-drop:nth-child(4) { left: 55%; animation-duration: 3.2s; animation-delay: 1.5s; }
        .blood-drop:nth-child(5) { left: 70%; animation-duration: 3.3s; animation-delay: 0.8s; }
        .blood-drop:nth-child(6) { left: 85%; animation-duration: 2.9s; animation-delay: 2s; }
        .blood-drop:nth-child(7) { left: 15%; animation-duration: 3.1s; animation-delay: 1.2s; }
        .blood-drop:nth-child(8) { left: 60%; animation-duration: 3.4s; animation-delay: 0.3s; }

        /* Spider web corners */
        .web-corner {
            position: fixed;
            width: 150px;
            height: 150px;
            opacity: 0.3;
            pointer-events: none;
            z-index: 999;
        }

        .web-corner.top-left {
            top: 0;
            left: 0;
            background:
                linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.3) 40.5%, transparent 41%),
                linear-gradient(135deg, transparent 50%, rgba(255,255,255,0.3) 50.5%, transparent 51%),
                linear-gradient(135deg, transparent 60%, rgba(255,255,255,0.3) 60.5%, transparent 61%);
        }

        .web-corner.top-right {
            top: 0;
            right: 0;
            background:
                linear-gradient(225deg, transparent 40%, rgba(255,255,255,0.3) 40.5%, transparent 41%),
                linear-gradient(225deg, transparent 50%, rgba(255,255,255,0.3) 50.5%, transparent 51%),
                linear-gradient(225deg, transparent 60%, rgba(255,255,255,0.3) 60.5%, transparent 61%);
        }

        /* Card hover with spooky effect */
        .card-hover {
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid rgba(255, 107, 53, 0.3);
            background: rgba(26, 11, 46, 0.7) !important;
            backdrop-filter: blur(10px);
        }

        .card-hover:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow:
                0 20px 40px -5px rgba(255, 107, 53, 0.5),
                0 0 20px rgba(155, 77, 202, 0.3),
                inset 0 0 20px rgba(255, 107, 53, 0.1);
            border-color: rgba(255, 107, 53, 0.6);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spookyGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 107, 53, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 107, 53, 0.8), 0 0 50px rgba(155, 77, 202, 0.6); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }

        .animate-slideIn {
            animation: slideIn 0.3s ease-out;
        }

        .spooky-glow {
            animation: spookyGlow 2s ease-in-out infinite;
        }

        /* Ragno animato */
        .spider-crawl {
            position: fixed;
            font-size: 4.5em;
            z-index: 9999;
            animation: crawlAround 25s linear infinite, spiderBounce 0.4s ease-in-out infinite, spiderShake 0.1s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(139, 0, 139, 0.9));
        }

        @keyframes crawlAround {
            0% { top: -5%; left: 0%; }
            10% { top: 10%; left: 15%; }
            20% { top: 25%; left: 30%; }
            30% { top: 15%; left: 50%; }
            40% { top: 40%; left: 70%; }
            50% { top: 60%; left: 85%; }
            60% { top: 75%; left: 65%; }
            70% { top: 80%; left: 40%; }
            80% { top: 55%; left: 20%; }
            90% { top: 30%; left: 5%; }
            100% { top: -5%; left: 0%; }
        }

        @keyframes spiderBounce {
            0%, 100% { transform: translateY(0) rotate(var(--spider-angle, 0deg)); }
            50% { transform: translateY(-8px) rotate(var(--spider-angle, 0deg)); }
        }

        @keyframes spiderShake {
            0%, 100% { transform: translateX(0) translateY(var(--bounce-y, 0)) rotate(var(--spider-angle, 0deg)); }
            25% { transform: translateX(-2px) translateY(var(--bounce-y, 0)) rotate(var(--spider-angle, 0deg)); }
            75% { transform: translateX(2px) translateY(var(--bounce-y, 0)) rotate(var(--spider-angle, 0deg)); }
        }

        /* Animazioni mood selezionato */
        @keyframes moodSelect {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.3) rotate(-10deg); }
            50% { transform: scale(1.4) rotate(10deg); }
            75% { transform: scale(1.3) rotate(-5deg); }
            100% { transform: scale(1.2) rotate(0deg); }
        }

        @keyframes moodPulse {
            0%, 100% { transform: scale(1.2); box-shadow: 0 0 20px rgba(255, 107, 53, 0.8); }
            50% { transform: scale(1.25); box-shadow: 0 0 40px rgba(255, 107, 53, 1); }
        }

        .mood-selected {
            animation: moodSelect 0.6s ease-out, moodPulse 1.5s ease-in-out infinite;
            border: 3px solid #ff6b35 !important;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.3), rgba(155, 77, 202, 0.3)) !important;
        }

        /* Ragno che corre verso target con accelerazione progressiva */
        .spider-run-to-target {
            animation: spiderBounce 0.3s ease-in-out infinite, spiderShake 0.08s ease-in-out infinite !important;
            transition: top 1.5s cubic-bezier(0.1, 0.3, 0.4, 1),
                        left 1.5s cubic-bezier(0.1, 0.3, 0.4, 1),
                        transform 0.1s ease-in-out !important;
        }

        /* Ragno spaventato scappa velocemente ma fluido */
        .spider-scared {
            animation: spiderBounce 0.2s ease-in-out infinite, spiderShake 0.08s ease-in-out infinite !important;
            transition: top 1.2s cubic-bezier(0.4, 0.1, 0.3, 1),
                        left 1.2s cubic-bezier(0.4, 0.1, 0.3, 1) !important;
            filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.8)) !important;
        }

        /* Halloween text colors */
        .text-halloween-primary { color: #ff6b35; }
        .text-halloween-secondary { color: #9b4dca; }
        .text-halloween-accent { color: #ffa500; }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1a0b2e;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ff6b35, #9b4dca);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #ffa500, #ff6b35);
        }
    </style>
</head>
<body>
    <!-- Halloween Decorations -->
    <div class="bat" style="top: 10%;">ü¶á</div>
    <div class="bat" style="top: 30%;">ü¶á</div>
    <div class="bat" style="top: 70%;">ü¶á</div>

    <div class="ghost" style="right: 20%; top: 15%;">üëª</div>
    <div class="ghost" style="left: 25%; top: 40%;">üëª</div>
    <div class="ghost" style="right: 15%; bottom: 30%;">üëª</div>

    <div class="web-corner top-left"></div>
    <div class="web-corner top-right"></div>

    <!-- Blood Drops -->
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>
    <div class="blood-drop"></div>

    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Heart = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>;
        const BookOpen = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const Wind = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg>;
        const TrendingUp = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>;
        const Palette = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>;
        const Sparkles = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>;
        const Zap = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>;
        const Award = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="8" r="7" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.21 13.89L7 23l5-3 5 3-1.21-9.12" /></svg>;
        const Clock = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6l4 2" /></svg>;
        const Settings = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><circle cx="12" cy="12" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/></svg>;
        const Shuffle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 3h5m0 0v5m0-5l-6 6M9 9L4 4m11 11l6 6m-6 0v-5m0 5h5" /></svg>;
        const Bot = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="10" x="3" y="11" rx="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="12" cy="5" r="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 7v4M8 16h.01M16 16h.01" /></svg>;
        const RefreshCw = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M1 4v6h6M23 20v-6h-6" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15" /></svg>;
        const CheckCircle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const X = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
        const Info = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 16v-4M12 8h.01" /></svg>;
        const Key = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>;
        const AlertCircle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4M12 16h.01" /></svg>;
        const Calendar = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="4" rx="2" ry="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 2v4M8 2v4M3 10h18" /></svg>;
        const Lightbulb = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>;
        const Volume2 = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5L6 9H2v6h4l5 4V5zM19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07" /></svg>;
        const Timer = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="13" r="9" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v5l3 3M9 2h6" /></svg>;
        const Play = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3l14 9-14 9V3z" /></svg>;
        const Pause = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 4h4v16H6zM14 4h4v16h-4z" /></svg>;
        const RotateCcw = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M1 4v6h6M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></svg>;
        const Camera = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z" /><circle cx="12" cy="13" r="4" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/></svg>;
        const Upload = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" /></svg>;
        const ImageIcon = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="8.5" cy="8.5" r="1.5" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 15l-5-5L5 21" /></svg>;
        const BarChart = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 20V10M12 20V4M6 20v-6" /></svg>;
        const Brain = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 9.75a3.75 3.75 0 015.25 5.25m1.5-8.5a3.75 3.75 0 01-4.5 6m-3.75-3.75A3.75 3.75 0 014.5 15M15 3.75c2.5 0 4.5 2 4.5 4.5s-2 4.5-4.5 4.5M9 3.75C6.5 3.75 4.5 5.75 4.5 8.25s2 4.5 4.5 4.5" /></svg>;
        const FileText = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 2v6h6M16 13H8M16 17H8M10 9H8" /></svg>;
        const Trash2 = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" /></svg>;
        const ChevronRight = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
        const HelpCircle = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3M12 17h.01" /></svg>;

        // Halloween Icons
        const Pumpkin = ({ className = "w-6 h-6" }) => <span className={`${className} pumpkin`} style={{fontSize: '2.5em'}}>üéÉ</span>;
        const Ghost = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>üëª</span>;
        const Bat = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>ü¶á</span>;
        const Skull = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>üíÄ</span>;
        const Spider = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>üï∑Ô∏è</span>;
        const Candy = ({ className = "w-6 h-6" }) => <span className={`${className}`} style={{fontSize: '1.5em'}}>üç¨</span>;
        const User = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>;
        const UserPlus = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" /></svg>;
        const LogOut = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>;
        const Cloud = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>;
        const Share2 = ({ className = "w-6 h-6" }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="6" cy="12" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><circle cx="18" cy="19" r="3" strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98" /></svg>;

        // Inizializza Firebase con la tua configurazione
        const firebaseConfig = {
          apiKey: "AIzaSyA6k76_p6x8pBGWKd6dQe5xfDPqBR_tJjc",
          authDomain: "artist-mental-health.firebaseapp.com",
          projectId: "artist-mental-health",
          storageBucket: "artist-mental-health.firebasestorage.app",
          messagingSenderId: "66082074143",
          appId: "1:66082074143:web:7aa589564b946274ad2f2a"
        };

        // Inizializza Firebase solo se non gi√† inizializzato
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        const MentalHealthCoachArte = () => {
          const [currentView, setCurrentView] = useState('home');
          const [moodHistory, setMoodHistory] = useState(() => {
            const saved = localStorage.getItem('moodHistory');
            return saved ? JSON.parse(saved) : [];
          });
          const [journalEntries, setJournalEntries] = useState(() => {
            const saved = localStorage.getItem('journalEntries');
            return saved ? JSON.parse(saved) : [];
          });
          const [currentMood, setCurrentMood] = useState(null);
          const [selectedMoodId, setSelectedMoodId] = useState(null);
          const [spiderTarget, setSpiderTarget] = useState(null);
          const [spiderScared, setSpiderScared] = useState(false);
          const [geminiApiKey, setGeminiApiKey] = useState(localStorage.getItem('gemini_api_key') || '');
          const [showApiSetup, setShowApiSetup] = useState(false);
          const [selectedExercise, setSelectedExercise] = useState(null);
          const [currentVariant, setCurrentVariant] = useState(null);
          const [isGenerating, setIsGenerating] = useState(false);
          const [showExamples, setShowExamples] = useState(false);

          const [timerActive, setTimerActive] = useState(false);
          const [timerSeconds, setTimerSeconds] = useState(0);
          const [timerDuration, setTimerDuration] = useState(0);
          const [uploadedImages, setUploadedImages] = useState(() => {
            const saved = localStorage.getItem('uploadedImages');
            return saved ? JSON.parse(saved) : [];
          });
          const [showInsights, setShowInsights] = useState(false);
          const [generatingReport, setGeneratingReport] = useState(false);
          const [uploadSuccess, setUploadSuccess] = useState(false);
          const [lastUploadedImage, setLastUploadedImage] = useState(null);
          const [journalSaved, setJournalSaved] = useState(false);
          const [apiKeySaved, setApiKeySaved] = useState(false);
          const [successMessage, setSuccessMessage] = useState({ show: false, message: '', type: 'success' });
          const [savedReports, setSavedReports] = useState(() => {
            const saved = localStorage.getItem('aiReports');
            return saved ? JSON.parse(saved) : [];
          });
          const [showReportModal, setShowReportModal] = useState(false);
          const [currentReport, setCurrentReport] = useState(null);
          const [showGuide, setShowGuide] = useState(false);
          const [showContactForm, setShowContactForm] = useState(false);

          // Stati profilo utente (localStorage - per guest mode)
          const [userProfile, setUserProfile] = useState(() => {
            const saved = localStorage.getItem('userProfile');
            return saved ? JSON.parse(saved) : null;
          });
          const [showProfileModal, setShowProfileModal] = useState(false);
          const [showProfileBenefits, setShowProfileBenefits] = useState(false);

          // Stati Firebase Authentication
          const [firebaseUser, setFirebaseUser] = useState(null);
          const [authLoading, setAuthLoading] = useState(true);
          const [showFirebaseAuth, setShowFirebaseAuth] = useState(false);
          const [useCloudSync, setUseCloudSync] = useState(false);

          useEffect(() => {
            localStorage.setItem('moodHistory', JSON.stringify(moodHistory));
          }, [moodHistory]);

          useEffect(() => {
            localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
          }, [journalEntries]);

          useEffect(() => {
            localStorage.setItem('uploadedImages', JSON.stringify(uploadedImages));
          }, [uploadedImages]);

          useEffect(() => {
            localStorage.setItem('aiReports', JSON.stringify(savedReports));
          }, [savedReports]);

          // Salva profilo utente locale
          useEffect(() => {
            if (userProfile) {
              localStorage.setItem('userProfile', JSON.stringify(userProfile));
            }
          }, [userProfile]);

          // Monitor autenticazione Firebase
          useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(async (user) => {
              console.log('üî• Firebase Auth State:', user ? user.email : 'No user');
              setFirebaseUser(user);
              setAuthLoading(false);

              // Se utente √® loggato, carica dati da Firestore
              if (user) {
                setUseCloudSync(true);
                try {
                  const userDoc = await db.collection('users').doc(user.uid).get();
                  if (userDoc.exists) {
                    const data = userDoc.data();
                    console.log('üì• Caricati dati da cloud:', data);
                    if (data.moodHistory) setMoodHistory(data.moodHistory);
                    if (data.journalEntries) setJournalEntries(data.journalEntries);
                    if (data.uploadedImages) setUploadedImages(data.uploadedImages);
                    if (data.savedReports) setSavedReports(data.savedReports);
                  }
                } catch (err) {
                  console.error('Errore caricamento dati:', err);
                }
              }
            });
            return () => unsubscribe();
          }, []);

          // Sincronizza moodHistory su Firestore quando l'utente √® loggato
          useEffect(() => {
            if (firebaseUser && useCloudSync && moodHistory.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                moodHistory: moodHistory
              }, { merge: true })
              .then(() => console.log('üíæ moodHistory sincronizzato'))
              .catch(err => console.error('Errore sync moodHistory:', err));
            }
          }, [moodHistory, firebaseUser, useCloudSync]);

          // Sincronizza journalEntries su Firestore
          useEffect(() => {
            if (firebaseUser && useCloudSync && journalEntries.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                journalEntries: journalEntries
              }, { merge: true })
              .then(() => console.log('üíæ journalEntries sincronizzato'))
              .catch(err => console.error('Errore sync journalEntries:', err));
            }
          }, [journalEntries, firebaseUser, useCloudSync]);

          // Sincronizza uploadedImages su Firestore
          useEffect(() => {
            if (firebaseUser && useCloudSync && uploadedImages.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                uploadedImages: uploadedImages
              }, { merge: true })
              .then(() => console.log('üíæ uploadedImages sincronizzato'))
              .catch(err => console.error('Errore sync uploadedImages:', err));
            }
          }, [uploadedImages, firebaseUser, useCloudSync]);

          // Sincronizza savedReports su Firestore
          useEffect(() => {
            if (firebaseUser && useCloudSync && savedReports.length > 0) {
              db.collection('users').doc(firebaseUser.uid).set({
                savedReports: savedReports
              }, { merge: true })
              .then(() => console.log('üíæ savedReports sincronizzato'))
              .catch(err => console.error('Errore sync savedReports:', err));
            }
          }, [savedReports, firebaseUser, useCloudSync]);

          useEffect(() => {
            console.log('geminiApiKey cambiato:', geminiApiKey ? 'PRESENTE (' + geminiApiKey.substring(0, 10) + '...)' : 'ASSENTE');
          }, [geminiApiKey]);

          useEffect(() => {
            let interval;
            if (timerActive && timerSeconds > 0) {
              interval = setInterval(() => {
                setTimerSeconds(prev => {
                  if (prev <= 1) {
                    setTimerActive(false);
                    playSound();
                    showNotification('Timer completato!', 'Il tempo per il tuo esercizio √® finito.');
                    return 0;
                  }
                  return prev - 1;
                });
              }, 1000);
            }
            return () => clearInterval(interval);
          }, [timerActive, timerSeconds]);

          const playSound = () => {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
          };

          const showNotification = (title, body) => {
            if ('Notification' in window && Notification.permission === 'granted') {
              new Notification(title, { body, icon: 'üé®' });
            } else if ('Notification' in window && Notification.permission !== 'denied') {
              Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                  new Notification(title, { body, icon: 'üé®' });
                }
              });
            }
          };

          const showSuccessMessage = (message, duration = 2000) => {
            setSuccessMessage({ show: true, message, type: 'success' });
            setTimeout(() => setSuccessMessage({ show: false, message: '', type: 'success' }), duration);
          };

          const parseDuration = (durationStr) => {
            const match = durationStr.match(/(\d+)\s*(min|sec|h)/i);
            if (!match) return 300;
            const value = parseInt(match[1]);
            const unit = match[2].toLowerCase();
            if (unit === 'sec') return value;
            if (unit === 'min') return value * 60;
            if (unit === 'h') return value * 3600;
            return 300;
          };

          const formatTime = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          const startTimer = (duration) => {
            const seconds = parseDuration(duration);
            setTimerDuration(seconds);
            setTimerSeconds(seconds);
            setTimerActive(true);
            showNotification('Timer avviato!', `Timer impostato per ${duration}`);
          };

          const pauseTimer = () => {
            setTimerActive(false);
          };

          const resumeTimer = () => {
            setTimerActive(true);
          };

          const resetTimer = () => {
            setTimerActive(false);
            setTimerSeconds(0);
            setTimerDuration(0);
          };

          const resizeImage = (file, maxWidth = 300, maxHeight = 300) => {
            console.log('resizeImage chiamata per file:', file.name, 'tipo:', file.type, 'dimensione:', file.size, 'bytes');

            return new Promise((resolve, reject) => {
              const reader = new FileReader();

              reader.onload = (e) => {
                console.log('FileReader completato');
                const dataUrl = e.target.result;

                const img = new window.Image();

                img.onload = () => {
                  try {
                    console.log('Immagine caricata, dimensioni originali:', img.width, 'x', img.height);

                    if (img.width <= maxWidth && img.height <= maxHeight) {
                      console.log('Immagine gi√† abbastanza piccola, uso originale');
                      resolve(dataUrl);
                      return;
                    }

                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width = Math.floor(width * ratio);
                    height = Math.floor(height * ratio);

                    console.log('Ridimensiono a:', width, 'x', height);

                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d', { alpha: false });
                    if (!ctx) {
                      console.error('Impossibile ottenere context 2d');
                      resolve(dataUrl);
                      return;
                    }

                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, width, height);
                    ctx.drawImage(img, 0, 0, width, height);

                    console.log('Conversione a JPEG...');
                    const resizedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                    console.log('OK! Dimensione finale:', resizedDataUrl.length, 'caratteri');
                    resolve(resizedDataUrl);

                  } catch (err) {
                    console.error('Errore durante resize:', err);
                    console.log('Uso immagine originale come fallback');
                    resolve(dataUrl);
                  }
                };

                img.onerror = () => {
                  console.error('Errore caricamento immagine, uso dataUrl originale');
                  resolve(dataUrl);
                };

                img.src = dataUrl;
              };

              reader.onerror = (err) => {
                console.error('Errore lettura file:', err);
                reject(new Error('Impossibile leggere il file'));
              };

              reader.readAsDataURL(file);
            });
          };

          const handleImageUpload = async (file) => {
            console.log('handleImageUpload chiamata, geminiApiKey:', geminiApiKey ? 'PRESENTE' : 'ASSENTE');

            if (!geminiApiKey || geminiApiKey.trim() === '') {
              console.log('API key mancante, apro modal configurazione');
              alert('‚ö†Ô∏è API Key richiesta! Configura prima la Tua API key per caricare immagini.');
              setShowApiSetup(true);
              return;
            }

            const validTypes = ['image/', '.heic', '.heif'];
            const isValid = validTypes.some(type =>
              file.type.startsWith(type) || file.name.toLowerCase().endsWith(type)
            );

            if (!file || !isValid) {
              alert('‚ö†Ô∏è Per favore carica un file immagine valido (jpg, png, heic, etc.)');
              return;
            }

            try {
              console.log('Inizio upload e ridimensionamento immagine...');
              setIsGenerating(true);

              const resizedDataUrl = await resizeImage(file);
              console.log('Immagine ridimensionata, inizio analisi AI...');

              const imageData = {
                id: Date.now(),
                dataUrl: resizedDataUrl,
                uploadDate: new Date().toISOString(),
                exerciseId: selectedExercise,
                exerciseTitle: currentVariant?.title || 'Esercizio',
                aiComment: null
              };

              try {
                console.log('Chiamata generateImageComment...');
                const comment = await generateImageComment(resizedDataUrl);
                console.log('Commento ricevuto:', comment ? 'SI' : 'NO');
                imageData.aiComment = comment;
              } catch (error) {
                console.error('Errore generazione commento:', error);
                imageData.aiComment = 'Errore: ' + error.message;
              }

              setUploadedImages(prev => [imageData, ...prev]);
              setLastUploadedImage(imageData);
              setUploadSuccess(true);
              setTimeout(() => {
                setUploadSuccess(false);
                setLastUploadedImage(null);
              }, 10000);
              console.log('Upload completato con successo!');
            } catch (error) {
              console.error('Errore upload immagine:', error);
              alert('‚ùå Errore durante il caricamento dell\'immagine: ' + error.message);
            } finally {
              setIsGenerating(false);
            }
          };

          const generateImageComment = async (imageDataUrl) => {
            console.log('generateImageComment chiamata');

            if (!geminiApiKey) {
              console.log('Nessuna API key, ritorno null');
              return null;
            }

            try {
              const base64Image = imageDataUrl.split(',')[1];
              console.log('Base64 estratto, lunghezza:', base64Image.length);

              const controller = new AbortController();
              const timeoutId = setTimeout(() => controller.abort(), 15000);

              console.log('Invio richiesta a Gemini API...');
              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiApiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  signal: controller.signal,
                  body: JSON.stringify({
                    contents: [{
                      parts: [
                        {
                          text: "Sei un critico d'arte empatico e incoraggiante per studenti e artisti. Analizza quest'opera in modo naturale e conversazionale. Inizia commentando cosa funziona bene nell'opera in modo specifico. Poi offri un suggerimento pratico per migliorare. Concludi con una nota incoraggiante. Scrivi in modo fluido e diretto, senza etichettare le sezioni (NON scrivere 'Commento positivo:', 'Suggerimento:', etc.). Sii breve (max 4 frasi) ma specifico e sincero. Inizia direttamente con il contenuto, senza introduzioni meta-testuali."
                        },
                        {
                          inline_data: {
                            mime_type: "image/jpeg",
                            data: base64Image
                          }
                        }
                      ]
                    }],
                    generationConfig: {
                      temperature: 0.7,
                      maxOutputTokens: 500,
                    }
                  })
                }
              );

              clearTimeout(timeoutId);
              console.log('Risposta ricevuta, status:', response.status);

              if (!response.ok) {
                const errorText = await response.text();
                console.error('Errore API:', response.status, errorText);
                throw new Error(`API Error: ${response.status} - ${errorText}`);
              }

              const data = await response.json();
              console.log('Dati parsati:', data);
              const comment = data.candidates[0].content.parts[0].text;
              console.log('Commento estratto:', comment);
              return comment;
            } catch (error) {
              console.error('Errore generazione commento immagine:', error);
              if (error.name === 'AbortError') {
                return 'Timeout: la generazione del commento ha richiesto troppo tempo. Immagine salvata comunque! üé®';
              }
              return 'Errore nell\'analisi: ' + error.message;
            }
          };

          const deleteImage = (imageId) => {
            if (confirm('Sei sicuro di voler eliminare questa foto?')) {
              setUploadedImages(prev => prev.filter(img => img.id !== imageId));
            }
          };

          const calculateMoodStats = () => {
            if (moodHistory.length === 0) return null;

            const moodCounts = moodHistory.reduce((acc, entry) => {
              acc[entry.mood] = (acc[entry.mood] || 0) + 1;
              return acc;
            }, {});

            const totalMoods = moodHistory.length;
            const avgMood = moodHistory.reduce((sum, entry) => sum + entry.mood, 0) / totalMoods;

            const now = new Date();
            const sevenDaysAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
            const fourteenDaysAgo = new Date(now - 14 * 24 * 60 * 60 * 1000);

            const recentMoods = moodHistory.filter(e => new Date(e.date) >= sevenDaysAgo);
            const previousMoods = moodHistory.filter(e => {
              const d = new Date(e.date);
              return d >= fourteenDaysAgo && d < sevenDaysAgo;
            });

            const recentAvg = recentMoods.length > 0
              ? recentMoods.reduce((sum, e) => sum + e.mood, 0) / recentMoods.length
              : avgMood;
            const previousAvg = previousMoods.length > 0
              ? previousMoods.reduce((sum, e) => sum + e.mood, 0) / previousMoods.length
              : avgMood;

            const trend = recentAvg - previousAvg;

            return { moodCounts, avgMood, trend, recentMoods, totalMoods };
          };

          const findMoodPatterns = () => {
            const stats = calculateMoodStats();
            if (!stats) return [];

            const patterns = [];

            const dayOfWeekMoods = {};
            moodHistory.forEach(entry => {
              const day = new Date(entry.date).getDay();
              if (!dayOfWeekMoods[day]) dayOfWeekMoods[day] = [];
              dayOfWeekMoods[day].push(entry.mood);
            });

            const dayNames = ['Domenica', 'Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'];
            const dayAverages = Object.entries(dayOfWeekMoods).map(([day, moods]) => ({
              day: dayNames[day],
              avg: moods.reduce((a, b) => a + b, 0) / moods.length
            })).sort((a, b) => a.avg - b.avg);

            if (dayAverages.length > 0) {
              const worstDay = dayAverages[0];
              const bestDay = dayAverages[dayAverages.length - 1];
              if (worstDay.avg < 3) {
                patterns.push({
                  type: 'warning',
                  title: `${worstDay.day} √® il tuo giorno pi√π difficile`,
                  description: `Media mood: ${worstDay.avg.toFixed(1)}/5`
                });
              }
              if (bestDay.avg > 3.5) {
                patterns.push({
                  type: 'positive',
                  title: `${bestDay.day} √® il tuo giorno migliore`,
                  description: `Media mood: ${bestDay.avg.toFixed(1)}/5`
                });
              }
            }

            let currentStreak = 0;
            let maxStreak = 0;
            moodHistory.slice().reverse().forEach(entry => {
              if (entry.mood >= 3) {
                currentStreak++;
                maxStreak = Math.max(maxStreak, currentStreak);
              } else {
                currentStreak = 0;
              }
            });

            if (maxStreak >= 3) {
              patterns.push({
                type: 'positive',
                title: `Streak di ${maxStreak} giorni positivi!`,
                description: 'Stai mantenendo un mood elevato'
              });
            }

            return patterns;
          };

          const generateAIReport = async () => {
            if (!geminiApiKey) {
              setShowApiSetup(true);
              return null;
            }

            const stats = calculateMoodStats();
            if (!stats) {
              alert('‚ö†Ô∏è Registra almeno un mood per generare un report');
              return null;
            }

            setGeneratingReport(true);

            try {
              const patterns = findMoodPatterns();

              const prompt = `Sei uno psicologo specializzato in supporto per Studenti e Artisti. Analizza questi dati e scrivi un report empatico e motivante:

Dati:
- ${stats.totalMoods} registrazioni mood negli ultimi giorni
- Mood medio: ${stats.avgMood.toFixed(1)}/5
- Trend: ${stats.trend > 0 ? 'in miglioramento' : stats.trend < 0 ? 'in peggioramento' : 'stabile'}
- Pattern identificati: ${patterns.map(p => p.title).join(', ') || 'nessuno'}
- Numero immagini caricate: ${uploadedImages.length}
- Voci diario: ${journalEntries.length}

Scrivi un report fluido e naturale che include:
- Un'osservazione sul tuo stato emotivo generale
- Cosa sta andando bene nel tuo percorso
- Aspetti da tenere sotto controllo
- Consigli pratici e personalizzati per migliorare

IMPORTANTE: Scrivi in modo conversazionale e diretto. NON usare etichette come "Sommario:", "Punti di forza:", "Aree da monitorare:", "Raccomandazioni:". Scrivi il testo in modo fluido come se stessi parlando direttamente alla persona. Non iniziare con frasi meta-testuali come "Ecco un'analisi" o "Basandomi sui dati". Inizia direttamente con il contenuto. Sii empatico, positivo ma realistico. Max 300 parole.`;

              console.log('üîÑ Generazione report AI...');
              console.log('üìä Stats:', stats);
              console.log('üìà Patterns:', patterns);

              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiApiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                      temperature: 0.8,
                      maxOutputTokens: 1000,
                    }
                  })
                }
              );

              console.log('üìç Response status:', response.status);

              if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                console.error('‚ùå API Error:', errorData);
                throw new Error(`API Error: ${response.status}`);
              }

              const data = await response.json();
              console.log('‚úÖ Dati ricevuti:', data);

              const report = data.candidates[0].content.parts[0].text;
              console.log('‚úÖ Report generato con successo');

              setGeneratingReport(false);
              return report;
            } catch (error) {
              console.error('üí• Errore generazione report:', error);
              alert(`‚ö†Ô∏è Errore nella generazione del report:\n\n${error.message}\n\nControlla la console (F12) per dettagli.`);
              setGeneratingReport(false);
              return null;
            }
          };

          const moods = [
            { id: 1, name: 'Ispirato', emoji: 'üé®', color: 'bg-purple-400' },
            { id: 2, name: 'Creativo', emoji: '‚ú®', color: 'bg-blue-400' },
            { id: 3, name: 'Felice', emoji: 'üòä', color: 'bg-green-400' },
            { id: 4, name: 'Energico', emoji: '‚ö°', color: 'bg-yellow-400' },
            { id: 5, name: 'Spettrale', emoji: 'üéÉ', color: 'bg-orange-500' },
            { id: 6, name: 'Tranquillo', emoji: 'üòå', color: 'bg-teal-400' },
            { id: 7, name: 'Neutrale', emoji: 'üòê', color: 'bg-gray-400' },
            { id: 8, name: 'Ansioso', emoji: 'üò∞', color: 'bg-yellow-300' },
            { id: 9, name: 'Triste', emoji: 'üò¢', color: 'bg-blue-300' },
            { id: 10, name: 'Bloccato', emoji: 'üòü', color: 'bg-orange-300' },
            { id: 11, name: 'Frustrato', emoji: 'üò§', color: 'bg-red-400' },
            { id: 12, name: 'Esausto', emoji: 'üò´', color: 'bg-red-300' },
            { id: 13, name: 'Malinconico', emoji: 'üòî', color: 'bg-indigo-300' },
            { id: 14, name: 'Motivato', emoji: 'üî•', color: 'bg-orange-600' },
            { id: 15, name: 'Spaventato', emoji: 'üëª', color: 'bg-purple-500' }
          ];

          const exerciseVariants = {
            'esercizi-spettrali': [
              {
                title: "üåô Disegno alla Luce di Candela",
                description: "Crea nell'oscurit√† per liberare l'inconscio creativo",
                prompt: "Spegni tutte le luci. Usa solo una candela. Disegna ci√≤ che le ombre ti suggeriscono per 20 minuti.",
                duration: "20 min",
                examples: [
                  "üïØÔ∏è Esempio 1: Osserva le ombre sul muro e disegnale senza pensare, lascia che la mano segua l'istinto",
                  "üë§ Esempio 2: Autoritratto guardando solo la Tua ombra proiettata, non il tuo viso reale",
                  "üåë Esempio 3: Disegna un sogno o incubo recente alla luce tremolante della fiamma"
                ]
              },
              {
                title: "üëª Scrittura Automatica Spettrale",
                description: "Lascia che l'inconscio scriva attraverso di te",
                prompt: "Scrivi per 10 minuti senza fermarti, senza pensare, senza rileggere. La penna non deve mai staccarsi dal foglio.",
                duration: "10 min",
                examples: [
                  "‚úçÔ∏è Esempio 1: Inizia con 'Nella notte pi√π oscura...' e continua senza censure",
                  "üìù Esempio 2: Scrivi una lettera alla Tua paura pi√π profonda, lascia emergere tutto",
                  "üåô Esempio 3: Descrivi un luogo inquietante immaginario dove vorresti creare arte"
                ]
              },
              {
                title: "ü©∏ Arte con Materiali Insoliti",
                description: "Usa elementi naturali per creare opere misteriose",
                prompt: "Crea un'opera usando solo elementi naturali trovati (foglie secche, terra, rametti, acqua).",
                duration: "30 min",
                examples: [
                  "üçÇ Esempio 1: Mandala con foglie autunnali, petali appassiti e terra sul pavimento",
                  "üåø Esempio 2: Dipingi con succhi di frutta scura (mirtilli, more) su carta da pacco",
                  "ü™® Esempio 3: Scultura effimera con pietre, rametti e ombre nella natura"
                ]
              },
              {
                title: "ü¶á Inversione Totale",
                description: "Fai tutto al contrario per sorprendere la mente",
                prompt: "Lavora al contrario: dipingi da destra a sinistra, scrivi dalla fine all'inizio, scolpisci dal basso verso l'alto.",
                duration: "15 min",
                examples: [
                  "‚¨ÖÔ∏è Esempio 1: Dipingi un paesaggio partendo dal cielo in basso e il terreno in alto",
                  "üîÑ Esempio 2: Scrivi una storia partendo dalla conclusione, risalendo all'inizio",
                  "üé® Esempio 3: Disegna con la mano non dominante guardando allo specchio"
                ]
              },
              {
                title: "üíÄ Memento Mori Creativo",
                description: "Rifletti sulla mortalit√† per apprezzare la vita creativa",
                prompt: "Crea un'opera che rappresenta il tempo che passa, la fragilit√†, la trasformazione. 25 minuti di riflessione profonda.",
                duration: "25 min",
                examples: [
                  "‚è≥ Esempio 1: Time-lapse fotografico di un fiore che appassisce in 24 ore",
                  "üçÇ Esempio 2: Collage con oggetti vecchi, foto sbiadite, tessuti consumati",
                  "üï∞Ô∏è Esempio 3: Serie di autoritratti progressivi che mostrano l'invecchiamento (immaginato o reale)"
                ]
              },
              {
                title: "üï∑Ô∏è Tela del Ragno: Connessioni Nascoste",
                description: "Scopri legami segreti tra idee apparentemente distanti",
                prompt: "Scegli 5 parole random. Crea un'opera che le connette tutte in modo surreale e inaspettato.",
                duration: "20 min",
                examples: [
                  "üé≠ Esempio 1: Parole: luna, forbici, memoria, sale, specchio ‚Üí Collage narrativo astratto",
                  "üñºÔ∏è Esempio 2: Parole: sangue, piume, libro, scale, vetro ‚Üí Illustrazione misteriosa",
                  "üìñ Esempio 3: Parole: ombra, chiave, oceano, fumo, rosa ‚Üí Micro-racconto illustrato"
                ]
              },
              {
                title: "üéÉ Trasformazione Oscura",
                description: "Prendi qualcosa di familiare e rendilo inquietante",
                prompt: "Scegli un oggetto quotidiano innocuo. Disegnalo/dipingilo in modo da renderlo misterioso, perturbante ma affascinante.",
                duration: "30 min",
                examples: [
                  "üß∏ Esempio 1: Un orsacchiotto con occhi vuoti circondato da ombre profonde",
                  "üè† Esempio 2: Una casa di bambole con finestre illuminate da luci innaturali",
                  "üé™ Esempio 3: Giocattoli d'infanzia disposti in una composizione surreale e simbolica"
                ]
              },
              {
                title: "üåë Ritratto dell'Ombra Interiore",
                description: "Esplora il lato oscuro della personalit√† creativa",
                prompt: "Disegna/dipingi il tuo 'lato ombra' - la parte di te che nascondi. Sii onesto e coraggioso.",
                duration: "25 min",
                examples: [
                  "üòà Esempio 1: Autoritratto diviso: met√† 'sociale', met√† 'vera identit√† nascosta'",
                  "üé≠ Esempio 2: Maschera che rappresenta come ti mostri vs. figura dietro che mostra chi sei",
                  "üë• Esempio 3: Due figure che si fronteggiano: il tuo io pubblico e quello privato"
                ]
              },
              {
                title: "üïØÔ∏è Rituale Creativo Notturno",
                description: "Crea un piccolo rito artistico per onorare la creativit√†",
                prompt: "Crea uno spazio sacro per la Tua arte: candele, oggetti significativi, musica. Lavora in questo 'tempio personale'.",
                duration: "40 min",
                examples: [
                  "üîÆ Esempio 1: Altar artistico con strumenti, opere passate, simboli personali - crea in questo spazio",
                  "üåô Esempio 2: Meditazione 5 min + schizzi intuitivi 35 min in uno spazio preparato con intenzione",
                  "‚ú® Esempio 3: Accendi candele per ogni progetto completato, crea qualcosa di nuovo alla loro luce"
                ]
              },
              {
                title: "ü¶¥ Archeologia dell'Anima",
                description: "Scava nei ricordi e nelle emozioni sepolte",
                prompt: "Trova una vecchia foto di te bambino. Crea un'opera che dialoga con quel bambino, con i suoi sogni dimenticati.",
                duration: "30 min",
                examples: [
                  "üë∂ Esempio 1: Ridisegna la foto aggiungendo elementi simbolici che rappresentano i sogni persi",
                  "üí≠ Esempio 2: Lettera illustrata al te stesso bambino: cosa gli diresti ora?",
                  "üé® Esempio 3: Crea ci√≤ che quel bambino avrebbe voluto creare ma non poteva"
                ]
              }
            ],
            'blocco-creativo': [
              {
                title: "5-Minute Ugly Sketch",
                description: "Disegna intenzionalmente brutto per liberarti dal perfezionismo",
                prompt: "Crea uno schizzo volutamente brutto. L'obiettivo √® sbagliare di proposito.",
                duration: "5 min",
                examples: [
                  "üé≠ Esempio 1: Ritratto usando solo la mano non dominante, senza guardare il foglio",
                  "üå≥ Esempio 2: Paesaggio con occhi chiusi, lascia che la mano vada dove vuole",
                  "üë§ Esempio 3: Autoritratto guardando solo lo specchio, MAI il foglio mentre disegni"
                ]
              },
              {
                title: "Wrong Medium Challenge",
                description: "Usa un materiale 'sbagliato' per il tuo stile abituale",
                prompt: "Se fai pittura, usa solo carboncino. Se fai scultura, prova l'acquerello. Esci dalla comfort zone.",
                duration: "20 min",
                examples: [
                  "üñåÔ∏è Esempio 1: Pittore ‚Üí Usa argilla o fil di ferro per 'disegnare' nello spazio",
                  "üóø Esempio 2: Scultore ‚Üí Crea un'opera solo con collage di carta di giornale",
                  "üì∏ Esempio 3: Fotografo ‚Üí Disegna a matita ci√≤ che fotograferesti, senza macchina"
                ]
              },
              {
                title: "Public Art Session",
                description: "Crea arte in un luogo pubblico senza nasconderti",
                prompt: "Vai in un bar, parco o piazza. Lavora per 30 minuti. Accetta gli sguardi curiosi.",
                duration: "30 min",
                examples: [
                  "‚òï Esempio 1: Schizza avventori del bar, mostra il lavoro se chiedono",
                  "üå≥ Esempio 2: Dipingi en plein air in un parco affollato",
                  "üöâ Esempio 3: Urban sketching in una stazione, lascia il taccuino visibile"
                ]
              },
              {
                title: "Collaboration Chaos",
                description: "Inizia un'opera e lascia che altri la 'rovinino'",
                prompt: "Crea una base. Chiedi a 3 persone (anche non artisti) di aggiungere elementi. Accetta tutto.",
                duration: "45 min",
                examples: [
                  "üë• Esempio 1: Tela con forme base ‚Üí Ognuno aggiunge colori random",
                  "‚úèÔ∏è Esempio 2: Disegno outline ‚Üí Altri riempiono con pattern a loro scelta",
                  "üé≠ Esempio 3: Scultura iniziale ‚Üí Altri attaccano oggetti trovati"
                ]
              },
              {
                title: "Speed Creation 30 Seconds",
                description: "Non c'√® tempo per giudicare",
                prompt: "Timer 30 secondi. Crea qualcosa di completo. Stop quando suona.",
                duration: "30 sec",
                examples: [
                  "‚ö° Esempio 1: Ritratto espressivo in 30 secondi, solo linee essenziali",
                  "üé® Esempio 2: Composizione astratta, getta colori rapidamente",
                  "‚úÇÔ∏è Esempio 3: Collage velocissimo, taglia e incolla senza pensare"
                ]
              },
              {
                title: "Childhood Art Recreation",
                description: "Disegna come quando avevi 5 anni",
                prompt: "Solo forme base: cerchi, linee, quadrati. Colori fuori dalle righe. Zero prospettiva.",
                duration: "15 min",
                examples: [
                  "üë®‚Äçüë©‚Äçüëß Esempio 1: Disegna la Tua famiglia come un bambino (figure stilizzate, sole con faccina)",
                  "üè† Esempio 2: Casa con albero e nuvole, tutto piatto e colorato",
                  "üê∂ Esempio 3: Il tuo animale preferito, versione bambino (sproporzionato e buffo)"
                ]
              },
              {
                title: "No Eraser Challenge",
                description: "Ogni segno resta, ogni 'errore' diventa parte dell'opera",
                prompt: "Usa solo penna. Disegna qualcosa di complesso. Niente cancellature. Gli errori sono features.",
                duration: "20 min",
                examples: [
                  "üèõÔ∏è Esempio 1: Architettura complessa a penna, se sbagli integra l'errore",
                  "üë§ Esempio 2: Ritratto dal vero, linee doppie diventano ombreggiatura",
                  "üåÜ Esempio 3: Cityscape, prospettive sbagliate creano stile surreale"
                ]
              },
              {
                title: "Backwards Process",
                description: "Inverti il tuo processo creativo abituale",
                prompt: "Se inizi con schizzi ‚Üí Inizia col colore. Se pianifichi ‚Üí Improvvisa totalmente.",
                duration: "30 min",
                examples: [
                  "üé® Esempio 1: Stendi colori random prima, POI trova forme al loro interno",
                  "‚úèÔ∏è Esempio 2: Dipingi senza disegno preparatorio, lascia che emerga",
                  "üóø Esempio 3: Modella argilla senza progetto, scopri cosa diventa mentre lavori"
                ]
              },
              {
                title: "Anonymous Gallery Drop",
                description: "Crea e abbandona un'opera in pubblico, senza firmare",
                prompt: "Lascia un'opera finita in un luogo pubblico. Niente firma. Osserva da lontano le reazioni.",
                duration: "1 ora",
                examples: [
                  "üé≠ Esempio 1: Mini-tela in una panchina del parco",
                  "üìù Esempio 2: Disegno alla fermata dell'autobus con nota 'Portami a casa'",
                  "üé® Esempio 3: Scultura di cartapesta in una biblioteca pubblica"
                ]
              },
              {
                title: "Criticism to Art",
                description: "Trasforma una critica ricevuta in opera creativa",
                prompt: "Ricorda una critica dura. Creane un'opera che la reinterpreta, la sfida, o la celebra ironicamente.",
                duration: "40 min",
                examples: [
                  "üí¨ Esempio 1: 'Troppo scuro' ‚Üí Opera intenzionalmente nerissima con solo un punto di luce",
                  "üé® Esempio 2: 'Non tecnico' ‚Üí Collage di tecniche 'sbagliate' che funzionano insieme",
                  "üìê Esempio 3: 'Fuori prospettiva' ‚Üí Lavoro che celebra prospettive impossibili alla Escher"
                ]
              },
              {
                title: "Stream of Consciousness Painting",
                description: "Dipingi/disegna mentre pensi ad alta voce",
                prompt: "Registra audio mentre lavori. Parla di tutto ci√≤ che ti passa per la mente. Non fermarti n√© a pensare n√© a parlare.",
                duration: "20 min",
                examples: [
                  "üé§ Esempio 1: Acquerello astratto + monologo sulle tue giornata",
                  "üó£Ô∏è Esempio 2: Disegno automatico mentre parli dei tuoi dubbi artistici",
                  "üí≠ Esempio 3: Scultura + narrazione stream-of-consciousness della Tua infanzia"
                ]
              },
              {
                title: "Opposite Style Day",
                description: "Fai l'esatto opposto del tuo stile",
                prompt: "Minimal? Oggi fai barocco. Realista? Oggi totalmente astratto. Colori caldi? Solo freddi.",
                duration: "1 ora",
                examples: [
                  "üîÑ Esempio 1: Astrattista ‚Üí Ritratto iperrealista da foto",
                  "üé≠ Esempio 2: Figurativo ‚Üí Composizione totalmente non-oggettiva",
                  "üåà Esempio 3: Monocromatico ‚Üí Esplosione di tutti i colori possibili"
                ]
              },
              {
                title: "Found Objects Sculpture",
                description: "Crea solo con oggetti trovati casualmente",
                prompt: "30 minuti per raccogliere oggetti random. 30 minuti per assemblarli in un'opera. Niente acquisti.",
                duration: "1 ora",
                examples: [
                  "üóëÔ∏è Esempio 1: Scultura da rifiuti trovati per strada",
                  "üçÇ Esempio 2: Installazione con solo elementi naturali (foglie, rami, sassi)",
                  "üì¶ Esempio 3: Assemblaggio di oggetti dismessi da casa (vecchie chiavi, bottoni, tappi)"
                ]
              },
              {
                title: "Time Limit Escalation",
                description: "Stessa opera in tempi progressivamente pi√π stretti",
                prompt: "Versione 1: 30 min. Versione 2: 10 min. Versione 3: 2 min. Confronta i risultati.",
                duration: "42 min totali",
                examples: [
                  "‚è±Ô∏è Esempio 1: Autoritratto in 3 versioni temporali diverse",
                  "üçé Esempio 2: Natura morta, diventa sempre pi√π essenziale",
                  "üèôÔ∏è Esempio 3: Paesaggio urbano, scopri cosa √® davvero essenziale"
                ]
              },
              {
                title: "Blindfold Challenge",
                description: "Crea a occhi chiusi o bendati",
                prompt: "Benda sugli occhi per tutta la durata. Fidati del tatto e dell'istinto.",
                duration: "15 min",
                examples: [
                  "üëÅÔ∏è Esempio 1: Scultura in argilla bendato, lascia che le mani guidino",
                  "üé® Esempio 2: Pittura a dita senza vedere, solo sensazioni tattili",
                  "‚úèÔ∏è Esempio 3: Disegno a carboncino bendato, senti la texture della carta"
                ]
              },
              {
                title: "Social Media Live Creation",
                description: "Crea dal vivo in diretta sui social",
                prompt: "Instagram/TikTok Live o registra video. Mostra errori, indecisioni, tutto il processo grezzo.",
                duration: "30 min",
                examples: [
                  "üì± Esempio 1: Time-lapse di un disegno, mostra TUTTI i tentativi falliti",
                  "üé• Esempio 2: Live painting con commento in tempo reale dei tuoi dubbi",
                  "üì∏ Esempio 3: Stories progressive di un'opera, anche gli 'sbagli'"
                ]
              },
              {
                title: "Extreme Constraint Box",
                description: "Regole assurde che limitano drasticamente",
                prompt: "Solo 1 colore, 3 linee massimo, materiali assurdi. Creativit√† nasce da vincoli estremi.",
                duration: "25 min",
                examples: [
                  "üìè Esempio 1: Ritratto con SOLO 10 linee rette",
                  "üé® Esempio 2: Paesaggio usando SOLO puntini (pointillism estremo)",
                  "‚úÇÔ∏è Esempio 3: Composizione con SOLO forme circolari, niente altro"
                ]
              },
              {
                title: "Audience Choice Creation",
                description: "Il pubblico decide cosa crei",
                prompt: "Chiedi a 5 persone random: soggetto, colore dominante, tecnica. Devi usare TUTTI i suggerimenti.",
                duration: "40 min",
                examples: [
                  "üë• Esempio 1: Sondaggio Instagram per scegliere tema + palette + stile",
                  "üé≤ Esempio 2: Dadi con parole random, tira 3 volte, incorpora tutto",
                  "üì± Esempio 3: Chiedi ai passanti cosa disegnare, prendi primi 3 suggerimenti"
                ]
              },
              {
                title: "Destruction as Creation",
                description: "Crea distruggendo opere precedenti",
                prompt: "Prendi 3 vecchi lavori 'falliti'. Tagliali, strappali, riassemblali in qualcosa di nuovo.",
                duration: "35 min",
                examples: [
                  "‚úÇÔ∏è Esempio 1: Collage da disegni bocciati, sovrapponi frammenti",
                  "üî• Esempio 2: Dipingi sopra a un vecchio dipinto, lascia trasparire il sotto",
                  "üé≠ Esempio 3: Scultura assemblando pezzi rotti di sculture precedenti"
                ]
              },
              {
                title: "Replica Impossibile",
                description: "Prova a rifare esattamente la stessa opera 5 volte",
                prompt: "Crea qualcosa. Ora rifallo identico altre 4 volte. Osserva come ogni tentativo √® diverso.",
                duration: "50 min",
                examples: [
                  "üîÅ Esempio 1: Stesso ritratto 5 volte, nota le variazioni involontarie",
                  "üé® Esempio 2: Stessa composizione astratta, diverge sempre pi√π",
                  "‚úèÔ∏è Esempio 3: Stesso schizzo rapido, celebra le differenze"
                ]
              }
            ],
            'mancanza-ispirazione': [
              {
                title: "Random Art Prompts Generator",
                description: "Tre parole casuali diventano un concept",
                prompt: "Genera 3 parole completamente random. Crea un'opera che le include tutte.",
                duration: "15 min",
                examples: [
                  "üé≤ Esempio 1: 'Malinconia + Geometria + Blu' ‚Üí Opera geometrica fredda con mood triste",
                  "‚ú® Esempio 2: 'Caos + Natura + Materiali riciclati' ‚Üí Installazione organica caotica",
                  "üåô Esempio 3: 'Memoria + Texture + Monocromo' ‚Üí Lavoro tattile sui ricordi"
                ]
              },
              {
                title: "Art History Mashup",
                description: "Combina due movimenti artistici opposti",
                prompt: "Rinascimento + Street Art, o Impressionismo + Futurismo. Crea l'impossibile fusione.",
                duration: "45 min",
                examples: [
                  "üèõÔ∏è Esempio 1: Venere di Botticelli in stile graffiti metropolitano",
                  "üé® Esempio 2: Paesaggio impressionista con elementi cyberpunk",
                  "üóø Esempio 3: Scultura classica assemblata con materiali industriali"
                ]
              },
              {
                title: "Environment Inspiration Hunt",
                description: "Trova ispirazione negli oggetti pi√π banali",
                prompt: "Fotografa 10 dettagli ignorati nella Tua stanza. Usa quei pattern/forme/colori per un'opera.",
                duration: "30 min",
                examples: [
                  "üîç Esempio 1: Texture del muro screpolato ‚Üí Dipinto astratto con stessa tessitura",
                  "üí° Esempio 2: Ombre delle piante sulla finestra ‚Üí Silhouette per un'opera",
                  "üìö Esempio 3: Colori random dei dorsi dei libri ‚Üí Palette per una composizione"
                ]
              },
              {
                title: "Music to Visual",
                description: "Traduci una canzone in arte visiva",
                prompt: "Scegli un brano. Ascoltalo 3 volte. Crea cosa 'vedi' mentre ascolti.",
                duration: "25 min",
                examples: [
                  "üéµ Esempio 1: Jazz ‚Üí Linee fluide e improvvisate, ritmo visivo",
                  "üé∏ Esempio 2: Rock ‚Üí Composizione energetica con colori aggressivi",
                  "üéª Esempio 3: Classica ‚Üí Forme armoniose e bilanciate"
                ]
              },
              {
                title: "Opposite Thinking Exercise",
                description: "Capovolgi completamente la Tua idea iniziale",
                prompt: "Pensa a un progetto che vuoi fare. Ora fai l'ESATTO OPPOSTO di ogni scelta che avresti fatto.",
                duration: "20 min",
                examples: [
                  "‚ÜîÔ∏è Esempio 1: Volevi dipingere piccolo? Fai murale gigante",
                  "üîÑ Esempio 2: Volevi soggetto serio? Fallo ironico e pop",
                  "‚ö° Esempio 3: Volevi processo lento? Completalo in 5 minuti"
                ]
              },
              {
                title: "Constraint Creativity Box",
                description: "Limiti estremi forzano soluzioni creative",
                prompt: "Scegli 3 limiti assurdi: solo 2 colori, solo forme triangolari, solo materiali riciclati, etc.",
                duration: "30 min",
                examples: [
                  "üìê Esempio 1: Solo bianco e nero + solo cerchi ‚Üí Op art geometrica",
                  "‚ôªÔ∏è Esempio 2: Solo carta di giornale + solo colori primari",
                  "‚úÇÔ∏è Esempio 3: Solo ritagli di riviste + nessuna figura umana"
                ]
              },
              {
                title: "Dream Journal Art",
                description: "Trasforma sogni recenti in opere visuali",
                prompt: "Ricorda un sogno degli ultimi giorni. Ricrealo visivamente, anche se assurdo o frammentato.",
                duration: "35 min",
                examples: [
                  "üí§ Esempio 1: Sogno surreale ‚Üí Collage di elementi disconnessi ma emotivamente coerenti",
                  "üåô Esempio 2: Incubo ‚Üí Opera oscura che cattura l'atmosfera",
                  "‚ú® Esempio 3: Sogno lucido ‚Üí Composizione iper-colorata e impossibile"
                ]
              },
              {
                title: "Childhood Nostalgia Mining",
                description: "Torna a cosa ti affascinava da bambino",
                prompt: "3 cose che adoravi a 8 anni. Incorporale in un progetto adulto maturo.",
                duration: "40 min",
                examples: [
                  "ü¶ñ Esempio 1: Amavi dinosauri ‚Üí Serie artistica su estinzione e fossili",
                  "üöÄ Esempio 2: Amavi spazio ‚Üí Installazione su esplorazione e solitudine",
                  "üéÆ Esempio 3: Amavi videogiochi ‚Üí Pixel art concettuale su realt√† virtuale"
                ]
              },
              {
                title: "Cultural Fusion Project",
                description: "Mescola elementi di culture diverse",
                prompt: "Scegli 2 culture lontane. Unisci simboli, pattern, stili artistici in un'opera ibrida.",
                duration: "50 min",
                examples: [
                  "üóæ Esempio 1: Ukiyo-e giapponese + Art Nouveau europeo",
                  "üåç Esempio 2: Arte tribale africana + Minimalismo scandinavo",
                  "üé≠ Esempio 3: Mandala induisti + Street art latinoamericana"
                ]
              },
              {
                title: "Synesthesia Experiment",
                description: "Visualizza un senso con un altro",
                prompt: "Come appare il suono della pioggia? Che colore ha il luned√¨? Che forma ha la felicit√†?",
                duration: "20 min",
                examples: [
                  "üëÉ Esempio 1: Dipingi l'odore del caff√® mattutino",
                  "üëÇ Esempio 2: Disegna il suono del traffico cittadino",
                  "üëÖ Esempio 3: Scultura che rappresenta il sapore del limone"
                ]
              },
              {
                title: "Time Traveler Artist",
                description: "Come sarebbe la Tua Arte in un'altra epoca?",
                prompt: "Immagina il tuo stile nel 1920, o nel 2120. Ricrea con tecniche/materiali di quell'epoca.",
                duration: "45 min",
                examples: [
                  "‚è∞ Esempio 1: Il tuo stile ma con tecniche rinascimentali",
                  "üöÄ Esempio 2: Il tuo soggetto ma in estetica cyberpunk futuristica",
                  "üìú Esempio 3: La Tua visione ma come manoscritto miniato medievale"
                ]
              },
              {
                title: "Emotion Color Mapping",
                description: "Palette emotiva diventa concept",
                prompt: "Scegli un'emozione complessa. Crea palette di 5 colori che la rappresenta. Opera basata solo su quella palette.",
                duration: "30 min",
                examples: [
                  "üòå Esempio 1: 'Nostalgia' ‚Üí Palette seppia, ocra, blu polveroso",
                  "üò∞ Esempio 2: 'Ansia' ‚Üí Giallo acido, grigio, verde elettrico",
                  "ü•∞ Esempio 3: 'Tenerezza' ‚Üí Rosa pallido, beige, lavanda"
                ]
              },
              {
                title: "Fictional Collaboration",
                description: "Lavora 'con' un artista che ammiri",
                prompt: "Se collaborassi con Frida Kahlo / Basquiat / Banksy, cosa creereste? Inizia tu la loro met√†.",
                duration: "40 min",
                examples: [
                  "üé® Esempio 1: Met√† opera nello stile di Van Gogh, met√† nel tuo",
                  "‚úçÔ∏è Esempio 2: Inizia come Picasso cubista, finisci con il tuo approccio",
                  "üñºÔ∏è Esempio 3: Composizione che fonde Klimt e la Tua estetica"
                ]
              },
              {
                title: "Problem Solving Art",
                description: "Risolvi un problema reale con creativit√†",
                prompt: "Problema quotidiano (traffico, spreco, solitudine). 10 soluzioni creative visualizzate.",
                duration: "35 min",
                examples: [
                  "üöó Esempio 1: Traffico ‚Üí Installazione su mobilit√† alternativa",
                  "üå± Esempio 2: Plastica ‚Üí Sculture interamente da rifiuti plastici",
                  "üíî Esempio 3: Isolamento ‚Üí Opera partecipativa che connette persone"
                ]
              },
              {
                title: "ABC Rapid Ideas",
                description: "Un'idea per ogni lettera dell'alfabeto",
                prompt: "A = Arte cyberpunk, B = Bambini come tema, etc. Fino a Z. Lista completa in 15 minuti.",
                duration: "15 min",
                examples: [
                  "üìù Esempio 1: Mini-schizzi per ogni lettera, sviluppi 3 favoriti",
                  "üí° Esempio 2: Solo titoli, poi scegli quale realizzare",
                  "üé® Esempio 3: Palette colori diversa per ogni lettera"
                ]
              },
              {
                title: "Scale Extremes",
                description: "Stessa opera, dimensioni estreme",
                prompt: "Versione 1: grande quanto un'unghia. Versione 2: grande quanto un muro. Confronta.",
                duration: "1 ora",
                examples: [
                  "üî¨ Esempio 1: Miniatura dettagliatissima vs murale essenziale",
                  "üìè Esempio 2: Scultura tascabile vs installazione ambientale",
                  "üé® Esempio 3: Acquarello 5x5cm vs acrilico 2x2m"
                ]
              },
              {
                title: "Remix Your Favorite Artwork",
                description: "Reinterpreta un capolavoro nel tuo stile",
                prompt: "Opera famosa che ami. Ricreala completamente nel tuo linguaggio artistico.",
                duration: "50 min",
                examples: [
                  "üñºÔ∏è Esempio 1: 'La Notte Stellata' in stile urban collage",
                  "üë© Esempio 2: 'Gioconda' in versione astratta espressionista",
                  "üçé Esempio 3: Natura morta barocca in pixel art"
                ]
              },
              {
                title: "Sensory Deprivation Creation",
                description: "Rimuovi un senso per amplificarne altri",
                prompt: "Lavora bendato, con tappi alle orecchie, o in silenzio totale. Intensifica altri sensi.",
                duration: "25 min",
                examples: [
                  "üôà Esempio 1: Scultura a occhi chiusi, solo tatto guida",
                  "üôâ Esempio 2: Dipinto in silenzio assoluto, concentrazione totale",
                  "üé® Esempio 3: Disegno al buio, sorpresa quando accendi luce"
                ]
              },
              {
                title: "Weather as Co-Creator",
                description: "Elementi naturali partecipano alla creazione",
                prompt: "Lascia che pioggia, vento, sole modifichino l'opera mentre la crei all'aperto.",
                duration: "1 ora",
                examples: [
                  "üåßÔ∏è Esempio 1: Acquerello sotto pioggia leggera, effetti casuali",
                  "üí® Esempio 2: Scultura di sabbia, vento come collaboratore",
                  "‚òÄÔ∏è Esempio 3: Pittura al sole, osserva come luce cambia percezione"
                ]
              },
              {
                title: "Future Archaeologist",
                description: "Crea 'reperti' di una civilt√† futura",
                prompt: "Anno 3000. Gli archeologi trovano la tua opera. Cosa racconta della nostra epoca?",
                duration: "45 min",
                examples: [
                  "üè∫ Esempio 1: 'Vaso antico' del 2024 con simboli digitali",
                  "üì± Esempio 2: Smartphone fossilizzato come reperto",
                  "üóø Esempio 3: Totem che rappresenta la societ√† dei social media"
                ]
              }
            ],
            'burnout-accademico': [
              {
                title: "5-Minute Brain Dump",
                description: "Scarica tutte le preoccupazioni su carta",
                prompt: "Timer 5 minuti. Scrivi TUTTO ci√≤ che ti stressa in Accademia, esami, progetti. Poi straccia.",
                duration: "5 min",
                examples: [
                  "üìù Esempio 1: Stream of consciousness su scadenze, poi brucialo",
                  "‚úèÔ∏è Esempio 2: Lista paure/ansie, poi disegnaci sopra patterns rilassanti",
                  "üóëÔ∏è Esempio 3: Lettera all'ansia, leggila ad alta voce, poi butta via"
                ]
              },
              {
                title: "Single Task Promise",
                description: "Oggi fai SOLO una cosa, ma fatta bene",
                prompt: "Lista di 10 cose da fare. Scegline UNA. Fai solo quella oggi. Ignora il resto.",
                duration: "Variabile",
                examples: [
                  "‚úÖ Esempio 1: Solo schizzi preparatori, niente altro",
                  "üé® Esempio 2: Solo stesura colore base, stop",
                  "üìö Esempio 3: Solo ricerca referenze, niente produzione"
                ]
              },
              {
                title: "Digital Detox Studio Time",
                description: "2 ore di lavoro completamente offline",
                prompt: "Spegni telefono e PC. Lavora solo con mani e materiali fisici per 2 ore.",
                duration: "2 ore",
                examples: [
                  "üìµ Esempio 1: Solo matite e carta, niente digitale",
                  "üö´ Esempio 2: Modellazione argilla, zero distrazioni tech",
                  "üé® Esempio 3: Pittura tradizionale, niente tutorial online"
                ]
              },
              {
                title: "Energy Audit Worksheet",
                description: "Mappa cosa ti drena e cosa ti ricarica",
                prompt: "Dividi foglio: sinistra = energy vampires, destra = energy boosters. Riorganizza priorit√†.",
                duration: "15 min",
                examples: [
                  "üîã Esempio 1: Evita progetti che prosciugano, focalizza su quelli energizzanti",
                  "üí° Esempio 2: Identifica persone/situazioni tossiche, riduci esposizione",
                  "‚ö° Esempio 3: Pianifica attivit√† ricostituenti tra quelle impegnative"
                ]
              },
              {
                title: "Micro-Break Protocol",
                description: "Pause di 3 minuti ogni ora di lavoro",
                prompt: "Timer ogni 60 minuti. Stop 3 minuti: stretching, respiro, o guarda fuori. No schermi.",
                duration: "3 min x N",
                examples: [
                  "üßò Esempio 1: Stretching collo e spalle, sciogli tensioni",
                  "üå¨Ô∏è Esempio 2: 10 respiri profondi alla finestra",
                  "üëÄ Esempio 3: Palming (mani su occhi chiusi) per rilassare vista"
                ]
              },
              {
                title: "Permission to Be Mediocre",
                description: "Oggi il 60% di sforzo √® sufficiente",
                prompt: "Scegli un task. Fallo con il 60% dello sforzo abituale. √à abbastanza. Davvero.",
                duration: "Variabile",
                examples: [
                  "üìê Esempio 1: Schizzo abbozzato invece che finito",
                  "üé® Esempio 2: Studio colore approssimativo, non resa finale",
                  "‚úèÔ∏è Esempio 3: Concept grezzo, non presentazione perfetta"
                ]
              },
              {
                title: "Passion Project 30 Minutes",
                description: "Lavora su qualcosa che AMI, non che devi fare",
                prompt: "30 minuti SOLO per progetto personale che ti entusiasma. Zero sensi di colpa.",
                duration: "30 min",
                examples: [
                  "üíú Esempio 1: Illustrazione di fantasia che vuoi fare da mesi",
                  "üé® Esempio 2: Tecnica nuova che vuoi sperimentare",
                  "‚ú® Esempio 3: Serie personale che non c'entra con l'Accademia"
                ]
              },
              {
                title: "Say No Practice",
                description: "Declina educatamente una richiesta oggi",
                prompt: "Identifica qualcosa a cui puoi dire no. Pratica: 'Non posso in questo momento, grazie'.",
                duration: "5 min",
                examples: [
                  "üö´ Esempio 1: Collaborazione non essenziale che ti stressa",
                  "‚ùå Esempio 2: Richiesta social che toglie tempo creativo",
                  "üõë Esempio 3: Impegno extra-accademico non fondamentale"
                ]
              },
              {
                title: "Body Scan Relaxation",
                description: "Rilassa sistematicamente ogni muscolo",
                prompt: "Sdraiati. Parti dai piedi, sali lentamente. Rilassa consapevolmente ogni parte del corpo.",
                duration: "15 min",
                examples: [
                  "ü¶∂ Esempio 1: Piedi ‚Üí gambe ‚Üí bacino ‚Üí schiena ‚Üí spalle ‚Üí testa",
                  "üíÜ Esempio 2: Focus extra su zone tese (spalle, mandibola)",
                  "üòå Esempio 3: Ripeti 2-3 volte se particolarmente stressato"
                ]
              },
              {
                title: "Gratitude Art Journal",
                description: "Disegna 5 cose per cui sei grato oggi",
                prompt: "Sketchbook: 5 mini-disegni di cose positive di oggi, anche minuscole.",
                duration: "10 min",
                examples: [
                  "‚òï Esempio 1: Caff√® buono, luce bella, amico che ha scritto",
                  "üåû Esempio 2: Progetto riuscito, pausa piacevole, bel tramonto",
                  "üíõ Esempio 3: Illustra gratitudine per strumenti, spazio studio, salute"
                ]
              },
              {
                title: "Movement Snack",
                description: "5 minuti di movimento energizzante",
                prompt: "Metti musica. Muoviti liberamente 5 minuti: balla, salta, stretching dinamico.",
                duration: "5 min",
                examples: [
                  "üíÉ Esempio 1: Balla una canzone che ami, scatenati",
                  "ü§∏ Esempio 2: Jumping jacks, stretching, movimenti ampi",
                  "üßò Esempio 3: Yoga flow veloce per riattivare corpo"
                ]
              },
              {
                title: "Sleep Hygiene Setup",
                description: "Crea rituale serale per dormire meglio",
                prompt: "30 min pre-sonno: no schermi, tisana, lettura o stretching. Ripeti ogni sera.",
                duration: "30 min",
                examples: [
                  "üìö Esempio 1: Lettura + camomilla + luci soffuse",
                  "üßò Esempio 2: Meditazione guidata + diario + respirazione",
                  "üé® Esempio 3: Sketchbook rilassante + musica calma + routine"
                ]
              },
              {
                title: "Workload Triage",
                description: "Riorganizza priorit√† realisticamente",
                prompt: "Lista tutto. Categorie: Urgente, Importante, Pu√≤ aspettare, Delegabile. Ricalcola deadline.",
                duration: "20 min",
                examples: [
                  "üìã Esempio 1: Esame settimana prossima = Urgente, tutorial online = Aspetta",
                  "‚úÖ Esempio 2: Portfolio = Importante, pulizia studio = Delega",
                  "üéØ Esempio 3: Progetto finale = Urgente+Importante, side project = Aspetta"
                ]
              },
              {
                title: "Forest Bath (Shinrin-yoku)",
                description: "Immersione consapevole nella natura",
                prompt: "40 minuti in parco/natura. Cammina lentamente. Osserva, annusa, tocca. Zero phone.",
                duration: "40 min",
                examples: [
                  "üå≥ Esempio 1: Parco cittadino, osserva alberi e uccelli",
                  "üåø Esempio 2: Passeggiata in bosco, raccogli foglie interessanti",
                  "üèûÔ∏è Esempio 3: Lago o fiume, ascolta suoni acqua"
                ]
              },
              {
                title: "Worry Time Container",
                description: "15 minuti dedicati SOLO a preoccuparti",
                prompt: "Scegli orario. 15 min per ansie. Fuori da quella finestra, rimanda le preoccupazioni.",
                duration: "15 min",
                examples: [
                  "‚è∞ Esempio 1: Ore 18:00 = worry time, resto giornata = zone free",
                  "üìù Esempio 2: Scrivi ansie durante il worry time, poi chiudi quaderno",
                  "üö´ Esempio 3: Quando preoccupazioni emergono fuori orario: 'Ci penso alle 18'"
                ]
              },
              {
                title: "Perfection Release Exercise",
                description: "Completa qualcosa al 70% e consideralo finito",
                prompt: "Progetto che procrastini per perfezionismo? Portalo a 70% e STOP. √à sufficiente.",
                duration: "Variabile",
                examples: [
                  "‚úÖ Esempio 1: Portfolio 'abbastanza buono' pubblicalo",
                  "üé® Esempio 2: Opera '70% finita' = Done. Inizia nuova",
                  "üì± Esempio 3: Post social 'decente' pubblicalo, non perfetto"
                ]
              },
              {
                title: "Social Battery Check",
                description: "Valuta se hai bisogno di persone o solitudine",
                prompt: "Chiediti: energia sociale alta o bassa? Onora risposta. Ok dire no a uscite, ok chiedere compagnia.",
                duration: "5 min",
                examples: [
                  "üë• Esempio 1: Batteria bassa ‚Üí Declina inviti, ricaricati da solo",
                  "ü§ó Esempio 2: Batteria alta ‚Üí Chiama amico, studia in compagnia",
                  "‚öñÔ∏è Esempio 3: Alterna giorni sociali e giorni solitari"
                ]
              },
              {
                title: "Breathing Reset 4-7-8",
                description: "Tecnica respirazione per calmare sistema nervoso",
                prompt: "Inspira 4 secondi, trattieni 7, espira 8. Ripeti 4 cicli. Resetta ansia acuta.",
                duration: "2 min",
                examples: [
                  "üå¨Ô∏è Esempio 1: Prima di presentazioni o esami",
                  "üò∞ Esempio 2: Quando senti ansia salire improvvisamente",
                  "üßò Esempio 3: Al mattino per iniziare giornata calmo"
                ]
              },
              {
                title: "Studio Environment Reset",
                description: "Riorganizza spazio lavoro per energia fresca",
                prompt: "20 minuti: pulisci, riordina, cambia disposizione. Nuovo spazio = nuova energia.",
                duration: "20 min",
                examples: [
                  "üßπ Esempio 1: Rimuovi progetti vecchi, spazio pulito",
                  "üí° Esempio 2: Cambia illuminazione, aggiungi pianta",
                  "üé® Esempio 3: Organizza materiali per accessibilit√†"
                ]
              },
              {
                title: "Self-Compassion Letter",
                description: "Scrivi a te stesso come faresti con un amico",
                prompt: "Cosa ti stai rimproverando? Scrivi cosa diresti a un amico nella stessa situazione.",
                duration: "10 min",
                examples: [
                  "üíå Esempio 1: 'Sono indietro' ‚Üí 'Stai facendo del tuo meglio'",
                  "üíô Esempio 2: 'Ho sbagliato' ‚Üí 'Errori sono apprendimento'",
                  "ü§ó Esempio 3: 'Non sono abbastanza' ‚Üí 'Stai crescendo, serve tempo'"
                ]
              }
            ],
            'ansia-critica': [
              {
                title: "Small Wins Inventory",
                description: "Celebra anche i successi minuscoli",
                prompt: "5 cose piccole che hai fatto oggi, anche solo alzarti o fare colazione. Sono vittorie.",
                duration: "5 min",
                examples: [
                  "‚ú® Esempio 1: Mi sono alzato ‚Üí Ho fatto stretching ‚Üí Ho aperto sketchbook",
                  "üé® Esempio 2: Ho mescolato colori ‚Üí Ho fatto un segno ‚Üí Ho continuato",
                  "üí™ Esempio 3: Sono andato in Accademia ‚Üí Ho parlato con prof ‚Üí Ho iniziato progetto"
                ]
              },
              {
                title: "Pre-Critique Ritual",
                description: "Routine calmante prima di revisioni/esami",
                prompt: "3 azioni ripetitive che fai sempre prima di critiche. Diventa √†ncora di sicurezza.",
                duration: "10 min",
                examples: [
                  "üßò Esempio 1: Respiro 4-7-8 + Mantra + Visualizzazione positiva",
                  "üéµ Esempio 2: Canzone specifica + Stretching + Affermazioni",
                  "‚òï Esempio 3: Caff√® rituale + Ripassare punti chiave + Toccare talismano"
                ]
              },
              {
                title: "Expectation vs Reality",
                description: "Confronta paure con probabilit√† reali",
                prompt: "Colonna 1: Cosa temi succeda. Colonna 2: Cosa probabilmente succeder√† davvero.",
                duration: "10 min",
                examples: [
                  "üò∞ Esempio 1: Paura: 'Diranno che faccio schifo' ‚Üí Realt√†: 'Daranno feedback costruttivi'",
                  "üéì Esempio 2: Paura: 'Boccer√≤ esame' ‚Üí Realt√†: 'Ho studiato, probabile passare'",
                  "üé® Esempio 3: Paura: 'Rideranno del mio lavoro' ‚Üí Realt√†: 'Critiche tecniche, non personali'"
                ]
              },
              {
                title: "Past Success Recall",
                description: "Ricorda quando hai gi√† fatto bene",
                prompt: "3 situazioni simili passate dove hai avuto successo. Cosa ti ha aiutato allora?",
                duration: "8 min",
                examples: [
                  "üèÜ Esempio 1: Esame anno scorso ‚Üí Preparazione + Respirazione ‚Üí Passato con 27",
                  "‚úÖ Esempio 2: Presentazione progetto ‚Üí Prove + Supporto amici ‚Üí Buon feedback",
                  "üé® Esempio 3: Mostra collettiva ‚Üí Lavoro autentico + Fiducia ‚Üí Apprezzamenti"
                ]
              },
              {
                title: "Lower the Bar Day",
                description: "Ridefinisci successo in modo raggiungibile",
                prompt: "Invece di 'Devo essere perfetto', definisci successo come 'Far√≤ del mio meglio oggi'.",
                duration: "5 min",
                examples: [
                  "üìä Esempio 1: Successo = Completare progetto, non farlo perfetto",
                  "üéØ Esempio 2: Successo = Presentare, non avere standing ovation",
                  "‚úÖ Esempio 3: Successo = Migliorare di 1%, non essere il migliore"
                ]
              },
              {
                title: "Body Anchoring Technique",
                description: "Gesto fisico che ti riporta a calma",
                prompt: "Scegli gesto (toccare pollice-indice, mano sul cuore). Usalo quando ansioso.",
                duration: "3 min",
                examples: [
                  "ü§≤ Esempio 1: Pollice-indice = √†ncora di calma, praticala in momenti sereni",
                  "üíì Esempio 2: Mano sul cuore + respiro profondo = auto-conforto",
                  "‚úä Esempio 3: Pugno gentile = segnale a te stesso 'Ce la fai'"
                ]
              },
              {
                title: "Visualization Practice",
                description: "Immagina performance di successo",
                prompt: "Chiudi occhi. Visualizza te stesso che presenti/esponi con calma e competenza. Dettagli sensoriali.",
                duration: "10 min",
                examples: [
                  "üé¨ Esempio 1: Ti vedi parlare chiaramente, prof annuiscono, Ti senti sicuro",
                  "üñºÔ∏è Esempio 2: Immagina opera esposta, persone interessate, feedback positivi",
                  "üéì Esempio 3: Esame: rispondi con calma, mostri lavoro, va bene"
                ]
              },
              {
                title: "Worst Case Scenario Acceptance",
                description: "Affronta la paura peggiore, poi ridimensionala",
                prompt: "Scenario peggiore possibile. Poi: Come sopravviveresti comunque? Ridimensiona paura.",
                duration: "12 min",
                examples: [
                  "üí≠ Esempio 1: Peggio: 'Bocciato' ‚Üí Sopravvivenza: 'Ripeto esame, imparo, passo'",
                  "üò∞ Esempio 2: Peggio: 'Critica devastante' ‚Üí 'User√≤ feedback, migliorer√≤'",
                  "üé® Esempio 3: Peggio: 'Opera non apprezzata' ‚Üí 'Far√≤ altro, crescer√≤'"
                ]
              },
              {
                title: "Affirmation Recording",
                description: "La tua voce che ti incoraggia",
                prompt: "Registra 5 affermazioni positive. Ascoltale in loop prima di eventi stressanti.",
                duration: "10 min",
                examples: [
                  "üé§ Esempio 1: 'Sono capace' / 'Ho lavorato duramente' / 'Merito successo'",
                  "üí™ Esempio 2: 'Ho talento' / 'Posso gestire critiche' / 'Sto crescendo'",
                  "‚ú® Esempio 3: 'Sono artista valido' / 'Il mio lavoro ha valore' / 'Ce la far√≤'"
                ]
              },
              {
                title: "Progress Not Perfection",
                description: "Celebra il miglioramento, non solo il risultato",
                prompt: "3 modi in cui sei migliorato nell'ultimo mese, anche piccoli progressi.",
                duration: "7 min",
                examples: [
                  "üìà Esempio 1: Disegno prospettiva meglio di prima, anche se non perfetto",
                  "üé® Esempio 2: Gestisco critiche pi√π serenamente che a inizio anno",
                  "üí™ Esempio 3: Finisco progetti pi√π velocemente, anche se non al 100%"
                ]
              },
              {
                title: "Comparison Detox",
                description: "Sfida confronti dannosi con altri",
                prompt: "Chi stai confrontando con te? Scrivi 3 motivi per cui confronto non √® valido/utile.",
                duration: "8 min",
                examples: [
                  "üë• Esempio 1: 'Loro hanno diverso background/tempo/risorse'",
                  "üéØ Esempio 2: 'Vedo solo loro risultato, non loro processo/difficolt√†'",
                  "‚ú® Esempio 3: 'Il mio percorso √® unico, non misurabile con metri altri'"
                ]
              },
              {
                title: "Feedback Filter Practice",
                description: "Distingui critica costruttiva da proiezione",
                prompt: "Ultimo feedback ricevuto. Quali parti utili? Quali proiezioni personali di chi critica?",
                duration: "10 min",
                examples: [
                  "üí¨ Esempio 1: Utile: 'Proporzioni da migliorare' / Proiezione: 'Troppo audace'",
                  "üé® Esempio 2: Utile: 'Tecnica X da studiare' / Proiezione: 'Non il mio stile'",
                  "‚úÖ Esempio 3: Prendo critiche tecniche, ignoro giudizi di gusto personale"
                ]
              },
              {
                title: "Grounding 5-4-3-2-1",
                description: "Tecnica sensoriale per ansia acuta pre-critica",
                prompt: "5 cose che vedi, 4 che tocchi, 3 che senti, 2 che annusi, 1 che assapori. Riporta a presente.",
                duration: "4 min",
                examples: [
                  "üëÄ Esempio 1: Prima di entrare in aula critica, fai esercizio fuori porta",
                  "üß† Esempio 2: Durante pausa esame, reset con 5-4-3-2-1",
                  "‚úã Esempio 3: In attesa risultati, anc√≤rati al presente con esercizio"
                ]
              },
              {
                title: "Process vs Outcome Focus",
                description: "Controlla il controllabile, lascia andare il resto",
                prompt: "Controlli: impegno, preparazione, presenza. Non controlli: voto, reazione prof, confronto con altri.",
                duration: "10 min",
                examples: [
                  "‚úÖ Esempio 1: Focus su: 'Ho dato il massimo nella ricerca e esecuzione'",
                  "üéØ Esempio 2: Focus su: 'Presento con chiarezza ci√≤ che ho fatto'",
                  "üí™ Esempio 3: Lascia andare: 'Se piacer√†', 'Se avr√≤ voto alto'"
                ]
              },
              {
                title: "Support Network Activation",
                description: "Chi pu√≤ supportarti prima/durante/dopo critiche",
                prompt: "3 persone che puoi contattare quando ansioso. Salvale come 'Supporto Esame'.",
                duration: "5 min",
                examples: [
                  "üë• Esempio 1: Amico X per pep talk, Amico Y per distrazione post-esame",
                  "üíô Esempio 2: Compagno corso per studiare insieme, Mentor per dubbi",
                  "ü§ó Esempio 3: Familiare per supporto emotivo, Collega per confronto tecnico"
                ]
              },
              {
                title: "Post-Critique Debrief",
                description: "Analizza oggettivamente dopo critiche/esami",
                prompt: "Cosa √® andato bene? 1 cosa da migliorare? 1 lezione appresa? No catastrofizzazione.",
                duration: "15 min",
                examples: [
                  "üìù Esempio 1: Bene: presentazione chiara / Migliorare: gestione tempo / Lezione: preparare scaletta",
                  "‚úÖ Esempio 2: Bene: concept forte / Migliorare: tecnica colore / Lezione: pi√π prove colore",
                  "üéØ Esempio 3: Focus su dati oggettivi, non su emozioni del momento"
                ]
              },
              {
                title: "Identity Decoupling",
                description: "Separa il tuo valore dal tuo risultato",
                prompt: "Completa: 'Il mio valore come persona NON dipende da [voto/critica/performance]'.",
                duration: "5 min",
                examples: [
                  "üíé Esempio 1: 'Valgo come persona indipendentemente dal voto di oggi'",
                  "‚ú® Esempio 2: 'Un progetto bocciato non mi rende fallimento'",
                  "üåü Esempio 3: 'Il mio valore artistico non si misura con un esame'"
                ]
              },
              {
                title: "Energy Management Pre-Critique",
                description: "Ottimizza energia fisica prima di performance",
                prompt: "Piano giorno prima: cosa mangiare, quando dormire, come muoversi per energia ottimale.",
                duration: "20 min",
                examples: [
                  "ü•ó Esempio 1: Cena leggera sera prima, colazione proteica, idratazione",
                  "üò¥ Esempio 2: Letto presto, 8 ore sonno, sveglia con tempo",
                  "üèÉ Esempio 3: Passeggiata mattina, stretching, evita caffeina eccessiva"
                ]
              },
              {
                title: "Reframe Anxiety as Excitement",
                description: "Trasforma nervosismo in energia positiva",
                prompt: "Quando senti ansia, d√¨ ad alta voce: 'Sono eccitato per questa opportunit√†'. Corpo non sa differenza.",
                duration: "2 min",
                examples: [
                  "üéâ Esempio 1: Battito veloce? 'Sono carico per mostrare il mio lavoro!'",
                  "‚ö° Esempio 2: Mani sudate? 'Sono entusiasta di questa presentazione!'",
                  "‚ú® Esempio 3: Respiro corto? 'Sono energizzato per questa sfida!'"
                ]
              },
              {
                title: "Mentor Visualization",
                description: "Immagina il tuo mentore che ti incoraggia",
                prompt: "Chiudi occhi. Immagina artista/prof/persona che ammiri che ti dice parole di supporto.",
                duration: "7 min",
                examples: [
                  "üë®‚Äçüé® Esempio 1: Van Gogh ti dice: 'Esprimi la tua visione, non cercare approvazione'",
                  "üë©‚Äçüè´ Esempio 2: Prof preferito: 'Hai lavorato bene, mostra con fiducia'",
                  "üé® Esempio 3: Artista ammirato: 'Anche io ho avuto critiche, fa parte del percorso'"
                ]
              }
            ]
          };

          const exerciseCategories = [
            {
              id: 'esercizi-spettrali',
              title: 'üéÉ Esercizi Spettrali!',
              description: 'Pratiche misteriose per liberare la creativit√† oscura',
              icon: Pumpkin,
              color: 'from-orange-600 via-red-600 to-black'
            },
            {
              id: 'blocco-creativo',
              title: 'Blocco Creativo',
              description: 'Supera perfezionismo e paura del foglio bianco',
              icon: Palette,
              color: 'from-orange-500 via-purple-600 to-purple-800'
            },
            {
              id: 'mancanza-ispirazione',
              title: 'Mancanza Ispirazione',
              description: 'Ritrova idee fresche e prospettive nuove',
              icon: Lightbulb,
              color: 'from-orange-400 via-yellow-500 to-orange-700'
            },
            {
              id: 'burnout-accademico',
              title: 'Burnout Accademico',
              description: 'Gestisci stress da progetti e scadenze',
              icon: Zap,
              color: 'from-red-600 via-orange-600 to-yellow-600'
            },
            {
              id: 'ansia-critica',
              title: 'Ansia da esami',
              description: 'Affronta revisioni ed esami con serenit√†',
              icon: Award,
              color: 'from-orange-600 via-pink-600 to-red-700'
            }
          ];

          const getRandomVariant = (category) => {
            const variants = exerciseVariants[category];
            return variants[Math.floor(Math.random() * variants.length)];
          };

          const generateWithGemini = async (category) => {
            if (!geminiApiKey) {
              alert('‚ö†Ô∏è Configura prima la tua API key di Gemini nelle impostazioni!');
              setShowApiSetup(true);
              return null;
            }

            const prompts = {
              'esercizi-spettrali': 'Sei un coach creativo con conoscenza di pratiche artistiche misteriose e psicologia junghiana. Genera un esercizio spettrale/oscuro per artisti che liberi l\'inconscio creativo. Deve essere provocatorio ma sicuro, esplorare ombre interiori, usare simbolismo oscuro, rituali creativi o materiali insoliti. Edizione Halloween: atmosfera misteriosa ma terapeutica. Includi 3 esempi concreti. Rispondi SOLO con JSON: {"title": "Nome con emoji spettrale", "description": "Descrizione", "prompt": "Istruzioni", "duration": "Tempo", "examples": ["Esempio 1: ...", "Esempio 2: ...", "Esempio 3: ..."]}',
              'blocco-creativo': 'Sei un coach per Studenti e Artisti. Genera un esercizio creativo per superare blocco creativo e perfezionismo. Deve essere pratico (5-30 min), provocatorio ma sicuro, focalizzato sull\'azione artistica concreta. Includi 3 esempi diversi. Rispondi SOLO con JSON: {"title": "Nome", "description": "Descrizione", "prompt": "Istruzioni", "duration": "Tempo", "examples": ["Esempio 1: ...", "Esempio 2: ...", "Esempio 3: ..."]}',
              'mancanza-ispirazione': 'Sei un coach creativo per artisti. Genera esercizio per sbloccare ispirazione. Deve stimolare pensiero divergente, essere divertente, generare idee fresche. Includi 3 esempi pratici. Rispondi SOLO con JSON: {"title": "Nome", "description": "Descrizione", "prompt": "Istruzioni", "duration": "Tempo", "examples": ["Esempio 1: ...", "Esempio 2: ...", "Esempio 3: ..."]}',
              'burnout-accademico': 'Sei uno specialista di benessere per Studenti e Artisti. Genera esercizio pratico per gestire stress accademico e burnout. Deve essere rilassante, fattibile anche con poca energia, dare sollievo concreto. Includi 3 varianti. Rispondi SOLO con JSON: {"title": "Nome", "description": "Descrizione", "prompt": "Istruzioni", "duration": "Tempo", "examples": ["Esempio 1: ...", "Esempio 2: ...", "Esempio 3: ..."]}',
              'ansia-critica': 'Sei un coach per gestire ansia da performance artistica. Genera esercizio per affrontare critiche, revisioni, esami con calma. Deve ridurre ansia, aumentare fiducia, separare valore personale dal giudizio. Includi 3 applicazioni diverse. Rispondi SOLO con JSON: {"title": "Nome", "description": "Descrizione", "prompt": "Istruzioni", "duration": "Tempo", "examples": ["Esempio 1: ...", "Esempio 2: ...", "Esempio 3: ..."]}'
            };

            setIsGenerating(true);
            
            try {
              console.log('üîÑ Chiamata API Gemini...');
              console.log('üìç API Key presente:', geminiApiKey ? 'S√¨' : 'No');
              console.log('üìç Lunghezza API Key:', geminiApiKey?.length);

              const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiApiKey}`,
                {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    contents: [{
                      parts: [{
                        text: prompts[category]
                      }]
                    }],
                    generationConfig: {
                      temperature: 0.9,
                      topK: 40,
                      topP: 0.95,
                      maxOutputTokens: 2048,
                    }
                  })
                }
              );

              console.log('üìç Response status:', response.status);
              console.log('üìç Response ok:', response.ok);

              if (!response.ok) {
                const errorData = await response.json().catch(() => ({ error: 'Impossibile leggere risposta' }));
                console.error('‚ùå Errore API completo:', JSON.stringify(errorData, null, 2));

                let errorMessage = 'Errore sconosciuto';
                if (errorData.error) {
                  if (errorData.error.code === 400) {
                    errorMessage = 'API Key non valida o formato richiesta errato';
                  } else if (errorData.error.code === 403) {
                    errorMessage = 'API Key non autorizzata. Verifica che l\'API Gemini sia abilitata nel tuo progetto Google Cloud';
                  } else if (errorData.error.code === 429) {
                    errorMessage = 'Limite rate raggiunto. Riprova tra qualche minuto';
                  } else {
                    errorMessage = errorData.error.message || `Errore ${errorData.error.code}`;
                  }
                }

                throw new Error(errorMessage);
              }

              const data = await response.json();
              console.log('üìç Risposta API ricevuta:', data);

              if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                console.error('‚ùå Struttura risposta non valida:', data);
                throw new Error('Risposta API non valida: struttura mancante');
              }

              const generatedText = data.candidates[0].content.parts[0].text;
              console.log('üìç Testo generato:', generatedText.substring(0, 200) + '...');

              const jsonMatch = generatedText.match(/\{[\s\S]*?\}/);

              if (jsonMatch) {
                const exercise = JSON.parse(jsonMatch[0]);
                setIsGenerating(false);
                console.log('‚úÖ Esercizio generato con successo');
                return exercise;
              } else {
                setIsGenerating(false);
                console.log('‚ö†Ô∏è Formato JSON non trovato, uso testo raw');
                return {
                  title: "Esercizio Generato da AI",
                  description: "Esercizio personalizzato",
                  prompt: generatedText,
                  duration: "15 min",
                  examples: []
                };
              }
            } catch (error) {
              console.error('üí• Errore completo:', error);
              console.error('üí• Stack trace:', error.stack);
              alert(`‚ö†Ô∏è Errore nella generazione:\n\n${error.message}\n\nControlla la console del browser (F12) per maggiori dettagli.`);
              setIsGenerating(false);
              return null;
            }
          };

          const saveApiKey = () => {
            localStorage.setItem('gemini_api_key', geminiApiKey);
            setShowApiSetup(false);
            setApiKeySaved(true);
            setTimeout(() => setApiKeySaved(false), 2000);
          };

          const HomeView = () => (
            <div className="space-y-6">
              <div className="text-center py-8 bg-gradient-to-r from-orange-500/20 via-purple-600/20 to-black/30 rounded-2xl border-2 border-orange-500/40 shadow-lg spooky-glow">
                <h1 className="text-4xl font-bold text-halloween-primary mb-2">
                  üéÉ Artist Mental Health Coach üéÉ
                </h1>
                <p className="text-halloween-accent text-lg font-semibold">üëª Edizione Halloween üëª</p>
                <p className="text-orange-300 text-sm mt-2">Il tuo supporto spettrale per il benessere creativo</p>
              </div>
              
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button
                  onClick={() => setCurrentView('mood')}
                  className="card-hover p-6 bg-gradient-to-br from-orange-600 to-orange-800 rounded-2xl text-white shadow-lg border-2 border-orange-500/50"
                >
                  <Pumpkin className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Traccia il tuo Umore</h3>
                  <p className="text-orange-100">Come Ti senti oggi?</p>
                </button>

                <button
                  onClick={() => setCurrentView('journal')}
                  className="card-hover p-6 bg-gradient-to-br from-purple-600 to-purple-900 rounded-2xl text-white shadow-lg border-2 border-purple-500/50"
                >
                  <Skull className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Diario Creativo</h3>
                  <p className="text-purple-100">Scrivi pensieri e riflessioni</p>
                </button>

                <button
                  onClick={() => setCurrentView('exercises')}
                  className="card-hover p-6 bg-gradient-to-br from-indigo-700 to-black rounded-2xl text-white shadow-lg border-2 border-indigo-500/50"
                >
                  <Spider className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Esercizi Guidati</h3>
                  <p className="text-indigo-100">Centinaia di pratiche per il benessere</p>
                </button>

                <button
                  onClick={() => setCurrentView('progress')}
                  className="card-hover p-6 bg-gradient-to-br from-orange-500 to-red-700 rounded-2xl text-white shadow-lg border-2 border-orange-400/50"
                >
                  <Bat className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">I Tuoi Progressi</h3>
                  <p className="text-orange-100">Visualizza il Tuo percorso</p>
                </button>

                <button
                  onClick={() => setCurrentView('insights')}
                  className="card-hover p-6 bg-gradient-to-br from-purple-700 to-pink-900 rounded-2xl text-white shadow-lg border-2 border-pink-500/50"
                >
                  <Ghost className="w-12 h-12 mb-3" />
                  <h3 className="text-xl font-semibold mb-2">Analisi & Insights</h3>
                  <p className="text-pink-100">Scopri pattern e ricevi feedback</p>
                </button>
              </div>

              <div className="text-center">
                <a
                  href="../assets/Guida_Artist_Mental_Health_Coach_ITA.pdf"
                  download="Guida_Artist_Mental_Health_Coach_ITA.pdf"
                  className="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-green-600 to-green-800 text-white rounded-xl hover:opacity-90 transition-opacity shadow-lg border-2 border-green-500/50 font-semibold text-lg"
                >
                  üì• Scarica la Guida (PDF)
                </a>
              </div>

              <div className="bg-gradient-to-r from-orange-900/40 via-purple-900/40 to-black/60 p-6 rounded-xl border-2 border-orange-500/50 backdrop-blur-sm">
                <h3 className="font-bold text-lg mb-3 flex items-center gap-2 text-halloween-accent">
                  <Candy className="w-6 h-6" />
                  Progettato per Artisti e Studenti
                </h3>
                <p className="text-orange-200 mb-2">
                  Esercizi specifici per Studenti e Artisti: gestisci blocco creativo, burnout da progetti,
                  ansia da esami e ritrova l'ispirazione... anche nelle notti pi√π oscure! üåô
                </p>
                <p className="text-orange-300 text-sm">
                  üéÉ centinaia di esercizi con 3 esempi ciascuno | üìì Diario | üëª Analisi risultati
                </p>
              </div>
            </div>
          );

          const MoodView = () => {
            const handleMoodClick = (mood, event) => {
              // Salva il mood
              setCurrentMood(mood);
              setMoodHistory([...moodHistory, { ...mood, date: new Date().toISOString() }]);
              setSelectedMoodId(mood.id);

              // Ottieni posizione del bottone cliccato
              const rect = event.currentTarget.getBoundingClientRect();
              const targetX = (rect.left / window.innerWidth) * 100;
              const targetY = (rect.top / window.innerHeight) * 100;

              // Fai correre il ragno verso il mood
              setSpiderTarget({ x: targetX, y: targetY });

              // Reset animazione dopo 2 secondi
              setTimeout(() => {
                setSelectedMoodId(null);
                setSpiderTarget(null);
              }, 3000);
            };

            return (
              <div className="space-y-6">
                <h2 className="text-3xl font-bold text-halloween-primary">Come ti senti oggi?</h2>
                <p className="text-orange-300">Traccia il tuo stato emotivo quotidiano</p>

                <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                  {moods.map(mood => (
                    <button
                      key={mood.id}
                      onClick={(e) => handleMoodClick(mood, e)}
                      className={`${mood.color} p-6 rounded-xl hover:scale-105 transition-transform shadow-md ${selectedMoodId === mood.id ? 'mood-selected' : ''}`}
                    >
                      <div className="text-5xl mb-2">{mood.emoji}</div>
                      <p className="text-orange-100 font-semibold">{mood.name}</p>
                    </button>
                  ))}
                </div>

              {currentMood && (
                <div className="bg-gradient-to-r from-orange-900/40 to-black/60 p-6 rounded-xl border-2 border-orange-500 shadow-lg animate-fadeIn backdrop-blur-sm">
                  <h3 className="text-xl font-semibold mb-2 flex items-center gap-2 text-orange-400">
                    <CheckCircle className="w-6 h-6 text-orange-500" />
                    Registrato!
                  </h3>
                  <p className="text-orange-200">
                    Hai registrato: <span className="font-bold text-lg text-halloween-primary">{currentMood.name}</span> {currentMood.emoji}
                  </p>
                </div>
              )}

                <button
                  onClick={() => setCurrentView('home')}
                  className="px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-800 text-white rounded-lg hover:opacity-90 transition-opacity border border-orange-500"
                >
                  ‚Üê Torna Home
                </button>
              </div>
            );
          };

          const JournalView = () => {
            const [entry, setEntry] = useState('');
            
            const saveEntry = () => {
              if (entry.trim()) {
                setJournalEntries([...journalEntries, { text: entry, date: new Date().toISOString() }]);
                setEntry('');
                setJournalSaved(true);
                setTimeout(() => setJournalSaved(false), 2000);
              }
            };

            return (
              <div className="space-y-6 relative">
                {journalSaved && (
                  <div className="absolute top-0 right-0 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 animate-fadeIn z-10">
                    <CheckCircle className="w-5 h-5" />
                    Diario salvato!
                  </div>
                )}

                <h2 className="text-3xl font-bold text-halloween-primary">Il tuo Diario Creativo</h2>
                <p className="text-orange-300">Scrivi pensieri, riflessioni, ispirazioni</p>

                <textarea
                  value={entry}
                  onChange={(e) => setEntry(e.target.value)}
                  placeholder="Scrivi liberamente qui... Pensieri su progetti, ispirazioni, dubbi, successi..."
                  className="w-full h-64 p-4 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-xl focus:border-orange-500 focus:outline-none resize-none placeholder-orange-400/50"
                />

                <button
                  onClick={saveEntry}
                  className="px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-800 text-white rounded-lg hover:opacity-90 transition-opacity border border-orange-500"
                >
                  üíæ Salva Entrata
                </button>

                <div className="space-y-4">
                  <h3 className="text-xl font-semibold text-halloween-accent">Entrate Precedenti:</h3>
                  {journalEntries.length === 0 ? (
                    <p className="text-orange-400 italic">Nessuna entrata ancora. Inizia a scrivere!</p>
                  ) : (
                    <div className="space-y-3">
                      {journalEntries.slice().reverse().map((e, i) => (
                        <div key={i} className="bg-gradient-to-r from-orange-900/40 to-black/60 p-4 rounded-lg border border-orange-600/50 shadow-sm backdrop-blur-sm">
                          <p className="text-orange-400 text-sm mb-2 font-semibold">
                            üìÖ {new Date(e.date).toLocaleDateString('it-IT', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                          </p>
                          <p className="text-orange-100 whitespace-pre-wrap">{e.text}</p>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                <button 
                  onClick={() => setCurrentView('home')} 
                  className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  ‚Üê Torna Home
                </button>
              </div>
            );
          };

          const ExercisesView = () => (
            <div className="space-y-6">
              <div className="flex justify-between items-center flex-wrap gap-4">
                <div>
                  <h2 className="text-3xl font-bold text-halloween-primary">Esercizi per Artisti</h2>
                  <p className="text-orange-300 mt-1">Scegli una categoria per iniziare</p>
                </div>
                <button
                  onClick={() => setShowApiSetup(true)}
                  className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-600 to-purple-700 text-white rounded-lg hover:opacity-90 transition-opacity border-2 border-orange-500/40"
                >
                  <Settings className="w-5 h-5" />
                  API Settings üîÆ
                </button>
              </div>

              <div className="bg-gradient-to-r from-orange-900/40 to-black/60 border-l-4 border-orange-500 p-4 rounded-lg backdrop-blur-sm">
                <div className="flex items-start gap-3">
                  <Info className="w-5 h-5 text-orange-400 mt-0.5 flex-shrink-0" />
                  <div>
                    <p className="text-orange-300 font-semibold mb-1">üí° Come funziona</p>
                    <p className="text-orange-200 text-sm">
                      Ogni esercizio include <strong>3 esempi pratici</strong> diversi.
                      Click su <Shuffle className="w-4 h-4 inline" /> per cambiare esercizio,
                      o attiva <Bot className="w-4 h-4 inline" /> modalit√† API per contenuti infiniti!
                    </p>
                  </div>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-4">
                {exerciseCategories.map(category => (
                  <button
                    key={category.id}
                    onClick={() => {
                      setSelectedExercise(category.id);
                      setCurrentVariant(getRandomVariant(category.id));
                      setCurrentView('exercise-detail');
                    }}
                    className={`card-hover p-6 bg-gradient-to-br ${category.color} rounded-2xl text-white shadow-lg relative transform transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:border-4 hover:border-orange-500`}
                  >
                    <category.icon className="w-16 h-16 mb-3 transform hover:scale-110 transition-transform" />
                    <h3 className="text-2xl font-bold mb-2">{category.title}</h3>
                    <p className="text-white/90 text-lg">{category.description}</p>
                  </button>
                ))}
              </div>

              <button
                onClick={() => setCurrentView('home')}
                className="px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-800 text-white rounded-lg hover:opacity-90 transition-opacity border border-orange-500"
              >
                ‚Üê Torna Home
              </button>
            </div>
          );

          const ExerciseDetailView = () => {
            if (!currentVariant) return null;
            
            const categoryData = exerciseCategories.find(c => c.id === selectedExercise);
            
            const loadNewVariant = async () => {
              if (geminiApiKey && geminiApiKey.trim() !== '') {
                const generated = await generateWithGemini(selectedExercise);
                if (generated) setCurrentVariant(generated);
              } else {
                setCurrentVariant(getRandomVariant(selectedExercise));
              }
            };

            return (
              <div className="space-y-6">
                <div className="flex justify-between items-start flex-wrap gap-4">
                  <div>
                    <h2 className="text-4xl font-bold text-halloween-primary">{categoryData.title}</h2>
                    <p className="text-orange-300 mt-1 text-lg">{categoryData.description}</p>
                  </div>
                </div>

                <div className={`bg-gradient-to-br ${categoryData.color} p-8 rounded-2xl text-white relative shadow-2xl border-4 border-orange-500/50`}>
                  
                  <div className="flex items-start justify-between mb-4 flex-wrap gap-3">
                    <div className="flex-1 min-w-[200px]">
                      <h3 className="text-2xl font-bold mb-2">{currentVariant.title}</h3>
                      <p className="text-white/90 text-lg">{currentVariant.description}</p>
                    </div>
                    <div className="flex items-center gap-2 bg-gradient-to-r from-orange-600 to-red-700 border-2 border-orange-400 backdrop-blur px-4 py-2 rounded-full flex-shrink-0 shadow-lg">
                      <Clock className="w-5 h-5" />
                      <span className="font-semibold text-lg">{currentVariant.duration}</span>
                    </div>
                  </div>

                  <div className="bg-gradient-to-r from-orange-800/60 to-black/80 border-2 border-orange-500 backdrop-blur p-6 rounded-xl mb-4 shadow-inner">
                    <p className="text-xl leading-relaxed font-medium">{currentVariant.prompt}</p>
                  </div>

                  <div className="bg-gradient-to-r from-orange-800/60 to-black/80 border-2 border-orange-500 backdrop-blur p-6 rounded-xl mb-4 shadow-inner">
                    <div className="flex items-center justify-between flex-wrap gap-4">
                      <div className="flex items-center gap-3">
                        <Timer className="w-6 h-6" />
                        <span className="text-xl font-bold">
                          {timerSeconds > 0 ? formatTime(timerSeconds) : currentVariant.duration}
                        </span>
                        {timerActive && timerDuration > 0 && (
                          <div className="text-sm opacity-80">
                            ({Math.round((timerSeconds / timerDuration) * 100)}% rimanente)
                          </div>
                        )}
                      </div>
                      <div className="flex gap-2">
                        {timerSeconds === 0 ? (
                          <button
                            onClick={() => startTimer(currentVariant.duration)}
                            className="flex items-center gap-2 bg-gradient-to-r from-orange-600 to-orange-800 border-2 border-orange-400 hover:from-orange-500 hover:to-orange-700 px-5 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold"
                          >
                            <Play className="w-5 h-5" />
                            Avvia Timer
                          </button>
                        ) : (
                          <>
                            <button
                              onClick={timerActive ? pauseTimer : resumeTimer}
                              className="flex items-center gap-2 bg-gradient-to-r from-orange-600 to-orange-800 border-2 border-orange-400 hover:from-orange-500 hover:to-orange-700 px-5 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold"
                            >
                              {timerActive ? (
                                <>
                                  <Pause className="w-5 h-5" />
                                  Pausa
                                </>
                              ) : (
                                <>
                                  <Play className="w-5 h-5" />
                                  Riprendi
                                </>
                              )}
                            </button>
                            <button
                              onClick={resetTimer}
                              className="flex items-center gap-2 bg-gradient-to-r from-red-600 to-orange-700 border-2 border-orange-400 hover:from-red-500 hover:to-orange-600 px-5 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold"
                            >
                              <RotateCcw className="w-5 h-5" />
                              Reset
                            </button>
                          </>
                        )}
                      </div>
                    </div>
                    {timerActive && timerDuration > 0 && (
                      <div className="mt-3 bg-black/60 border-2 border-orange-600 rounded-full h-3 overflow-hidden shadow-inner">
                        <div
                          className="bg-gradient-to-r from-orange-500 via-orange-600 to-red-600 h-full transition-all duration-1000 shadow-lg"
                          style={{ width: `${(timerSeconds / timerDuration) * 100}%` }}
                        />
                      </div>
                    )}
                  </div>

                  {currentVariant.examples && currentVariant.examples.length > 0 && (
                    <div className="bg-gradient-to-r from-orange-800/60 to-black/80 border-2 border-orange-500 backdrop-blur p-6 rounded-xl shadow-inner">
                      <button
                        onClick={() => setShowExamples(!showExamples)}
                        className="flex items-center gap-2 font-bold text-xl mb-3 hover:text-orange-300 transition-colors"
                      >
                        <Lightbulb className="w-6 h-6" />
                        {showExamples ? 'Nascondi' : 'Mostra'} 3 Esempi Pratici
                        <span className="text-lg ml-2">({showExamples ? '‚ñº' : '‚ñ∂'})</span>
                      </button>

                      {showExamples && (
                        <div className="space-y-3 mt-4 animate-fadeIn">
                          {currentVariant.examples.map((example, idx) => (
                            <div key={idx} className="bg-gradient-to-r from-orange-700/40 to-black/60 border-2 border-orange-600 p-4 rounded-lg shadow-md">
                              <p className="leading-relaxed text-lg">{example}</p>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}

                  <div className="flex gap-3 mt-6 flex-wrap">
                    <button
                      onClick={loadNewVariant}
                      disabled={isGenerating}
                      className="flex-1 min-w-[200px] flex items-center justify-center gap-2 bg-gradient-to-r from-orange-600 to-red-700 border-2 border-orange-400 hover:from-orange-500 hover:to-red-600 px-6 py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {isGenerating ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          Generando...
                        </>
                      ) : (
                        <>
                          <Shuffle className="w-5 h-5" />
                          {geminiApiKey ? 'Genera Esercizio' : 'Nuovo Esercizio'}
                        </>
                      )}
                    </button>
                    
                    <button className="flex items-center justify-center gap-2 bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 text-gray-800 hover:bg-orange-900/50 px-6 py-3 rounded-xl font-semibold transition-all">
                      <CheckCircle className="w-5 h-5" />
                      Completato
                    </button>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-gray-900 via-orange-950/50 to-black p-6 rounded-2xl shadow-lg relative border-2 border-orange-600/40">
                  {uploadSuccess && lastUploadedImage && (
                    <div className="absolute top-4 right-4 bg-gradient-to-r from-green-600 to-green-700 text-white p-4 rounded-xl shadow-2xl animate-fadeIn z-10 max-w-md">
                      <div className="flex items-start gap-3 mb-3">
                        <CheckCircle className="w-6 h-6 flex-shrink-0 mt-1" />
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-1">Foto caricata!</h4>
                          <p className="text-sm text-green-100">L'AI ha analizzato la tua opera</p>
                        </div>
                      </div>
                      {lastUploadedImage.aiComment && (
                        <>
                          <div className="bg-white/20 rounded-lg p-3 mb-3 text-sm">
                            <p className="text-white leading-relaxed">{lastUploadedImage.aiComment}</p>
                          </div>
                          <button
                            onClick={() => {
                              const text = `üé® *${lastUploadedImage.exerciseTitle}*\n\n${lastUploadedImage.aiComment}\n\n_Analisi generata da Artist Mental Health Coach_`;
                              const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
                              window.open(whatsappUrl, '_blank');
                            }}
                            className="w-full bg-white text-green-700 px-4 py-2 rounded-lg font-semibold hover:bg-green-50 transition-colors flex items-center justify-center gap-2"
                          >
                            <Share2 className="w-4 h-4" />
                            Condividi su WhatsApp
                          </button>
                        </>
                      )}
                    </div>
                  )}

                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <Camera className="w-6 h-6" />
                    Carica il tuo Lavoro
                  </h3>
                  <p className="text-orange-300 mb-4">
                    Condividi un'immagine del tuo esercizio e ricevi un feedback
                  </p>

                  {!geminiApiKey || geminiApiKey.trim() === '' ? (
                    <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
                      <div className="flex items-start gap-3">
                        <AlertCircle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                        <div>
                          <p className="font-semibold text-yellow-800 mb-2">API Key richiesta</p>
                          <p className="text-sm text-yellow-700 mb-3">
                            Per caricare immagini e ricevere feedback, devi configurare la tua API key di Google Gemini.
                          </p>
                          <button
                            onClick={() => setShowApiSetup(true)}
                            className="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm font-semibold"
                          >
                            Configura API Key
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <>
                      {isGenerating ? (
                        <div className="flex items-center justify-center gap-3 px-6 py-4 bg-gray-300 rounded-xl cursor-not-allowed">
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          <span className="font-semibold text-gray-700">Caricamento in corso...</span>
                        </div>
                      ) : (
                        <label className="flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl cursor-pointer hover:from-purple-600 hover:to-pink-600 transition-all">
                          <Upload className="w-5 h-5" />
                          <span className="font-semibold">Seleziona Immagine</span>
                          <input
                            type="file"
                            accept="image/*,.heic,.heif"
                            className="hidden"
                            onChange={(e) => {
                              if (e.target.files[0]) {
                                handleImageUpload(e.target.files[0]);
                                e.target.value = '';
                              }
                            }}
                          />
                        </label>
                      )}
                    </>
                  )}

                  {uploadedImages.filter(img => img.exerciseId === selectedExercise).length > 0 && (
                    <div className="mt-6">
                      <h4 className="text-lg font-semibold text-gray-800 mb-3">Le tue immagini per questo esercizio:</h4>
                      <div className="grid md:grid-cols-2 gap-4">
                        {uploadedImages
                          .filter(img => img.exerciseId === selectedExercise)
                          .map(img => (
                            <div key={img.id} className="bg-black/40 border border-orange-700/30 rounded-lg overflow-hidden shadow">
                              <img src={img.dataUrl} alt="Lavoro artistico" className="w-full h-48 object-cover" />
                              <div className="p-4">
                                <div className="flex justify-between items-start mb-2">
                                  <span className="text-sm text-gray-500">
                                    {new Date(img.uploadDate).toLocaleDateString('it-IT')}
                                  </span>
                                  <button
                                    onClick={() => deleteImage(img.id)}
                                    className="text-red-500 hover:text-red-700"
                                    title="Elimina"
                                  >
                                    <X className="w-5 h-5" />
                                  </button>
                                </div>
                                {img.aiComment && (
                                  <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 p-3 rounded-lg text-sm text-gray-700 border-l-4 border-purple-500">
                                    <div className="flex items-start gap-2">
                                      <Bot className="w-5 h-5 text-purple-500 flex-shrink-0 mt-0.5" />
                                      <p>{img.aiComment}</p>
                                    </div>
                                  </div>
                                )}
                              </div>
                            </div>
                          ))}
                      </div>
                    </div>
                  )}
                </div>

                <button
                  onClick={() => setCurrentView('exercises')}
                  className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  ‚Üê Torna agli Esercizi
                </button>
              </div>
            );
          };

          const ProgressView = () => (
            <div className="space-y-6">
              <h2 className="text-3xl font-bold text-gray-800">I Tuoi Progressi</h2>
              
              <div className="grid md:grid-cols-3 gap-4">
                <div className="bg-blue-100 p-6 rounded-xl shadow-md">
                  <Calendar className="w-10 h-10 text-blue-600 mb-3" />
                  <h3 className="text-3xl font-bold text-gray-800">{moodHistory.length}</h3>
                  <p className="text-orange-300">Tracciamenti Umore</p>
                </div>

                <div className="bg-purple-100 p-6 rounded-xl shadow-md">
                  <BookOpen className="w-10 h-10 text-purple-600 mb-3" />
                  <h3 className="text-3xl font-bold text-gray-800">{journalEntries.length}</h3>
                  <p className="text-orange-300">Entrate Diario</p>
                </div>

                <div className="bg-green-100 p-6 rounded-xl shadow-md">
                  <TrendingUp className="w-10 h-10 text-green-600 mb-3" />
                  <h3 className="text-3xl font-bold text-gray-800">{Math.max(1, moodHistory.length + journalEntries.length)}</h3>
                  <p className="text-orange-300">Giorni Attivi</p>
                </div>
              </div>

              <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 p-6 rounded-xl border border-orange-600/40 shadow-md">
                <h3 className="text-xl font-semibold mb-4">Storico Umore Recente</h3>
                {moodHistory.length === 0 ? (
                  <p className="text-orange-400 italic">Inizia a tracciare il tuo umore per vedere i progressi!</p>
                ) : (
                  <div className="space-y-2">
                    {moodHistory.slice(-10).reverse().map((mood, i) => (
                      <div key={i} className="flex items-center gap-3 p-3 bg-black/40 border border-orange-700/30 rounded-lg hover:bg-orange-900/50 transition-colors">
                        <span className="text-3xl">{mood.emoji}</span>
                        <div className="flex-1">
                          <p className="font-semibold">{mood.name}</p>
                          <p className="text-sm text-gray-500">
                            {new Date(mood.date).toLocaleDateString('it-IT', { weekday: 'long', day: 'numeric', month: 'long' })}
                          </p>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              <button
                onClick={() => setCurrentView('home')}
                className="px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-800 text-white rounded-lg hover:opacity-90 transition-opacity border border-orange-500"
              >
                ‚Üê Torna Home
              </button>
            </div>
          );

          const InsightsView = () => {
            const [aiReport, setAiReport] = React.useState(null);
            const stats = calculateMoodStats();
            const patterns = findMoodPatterns();

            const handleGenerateReport = async () => {
              console.log('üîò Click su Genera Report');

              const report = await generateAIReport();
              console.log('üìÑ Report ricevuto:', !!report);

              if (report) {
                const reportData = {
                  id: Date.now(),
                  content: report,
                  date: new Date().toISOString(),
                  stats: {
                    totalMoods: stats?.totalMoods || 0,
                    avgMood: stats?.avgMood || 0,
                    trend: stats?.trend || 0
                  }
                };

                setSavedReports(prev => [reportData, ...prev]);

                setCurrentReport(reportData);
                setShowReportModal(true);

                const wordCount = report.split(/\s+/).length;
                const duration = (wordCount / 2) * 1000;
                console.log(`üìä ${wordCount} parole, durata: ${duration}ms (${duration/1000}s)`);

                setTimeout(() => {
                  setShowReportModal(false);
                }, duration);

                console.log('‚úÖ Report salvato e visualizzato');
              } else {
                console.log('‚ö†Ô∏è Nessun report generato');
              }
            };

            console.log('üé® Render InsightsView - aiReport:', !!aiReport, aiReport ? `(${aiReport.length} caratteri)` : 'null');

            return (
              <div className="space-y-6">
                <h2 className="text-4xl font-bold text-halloween-primary flex items-center gap-3">
                  <Brain className="w-10 h-10 text-orange-500" />
                  Analisi & Insights
                </h2>

                <div className="grid md:grid-cols-4 gap-4">
                  <div className="bg-gradient-to-br from-orange-600 to-red-700 p-6 rounded-xl shadow-lg text-white border-2 border-orange-400">
                    <Calendar className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">{stats?.totalMoods || 0}</h3>
                    <p className="text-orange-100">Mood tracciati</p>
                  </div>

                  <div className="bg-gradient-to-br from-purple-600 to-orange-700 p-6 rounded-xl shadow-lg text-white border-2 border-orange-400">
                    <Heart className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">{stats?.avgMood.toFixed(1) || '0'}/5</h3>
                    <p className="text-orange-100">Mood medio</p>
                  </div>

                  <div className="bg-gradient-to-br from-red-600 to-orange-600 p-6 rounded-xl shadow-lg text-white border-2 border-orange-400">
                    <Pumpkin className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">{uploadedImages.length}</h3>
                    <p className="text-orange-100">Immagini caricate</p>
                  </div>

                  <div className="bg-gradient-to-br from-orange-500 to-yellow-600 p-6 rounded-xl shadow-lg text-white border-2 border-orange-400">
                    <TrendingUp className="w-8 h-8 mb-2 opacity-80" />
                    <h3 className="text-3xl font-bold">
                      {stats?.trend > 0 ? 'üìà' : stats?.trend < 0 ? 'üìâ' : '‚û°Ô∏è'}
                    </h3>
                    <p className="text-orange-100">
                      {stats?.trend > 0 ? 'In miglioramento' : stats?.trend < 0 ? 'Da monitorare' : 'Stabile'}
                    </p>
                  </div>
                </div>

                {patterns.length > 0 && (
                  <div className="bg-gradient-to-r from-orange-900/40 to-black/70 border-2 border-orange-500 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-2xl font-bold text-halloween-primary mb-4 flex items-center gap-2">
                      <Sparkles className="w-6 h-6 text-orange-400" />
                      Pattern Identificati
                    </h3>
                    <div className="grid md:grid-cols-2 gap-4">
                      {patterns.map((pattern, idx) => (
                        <div
                          key={idx}
                          className={`p-4 rounded-lg border-2 ${
                            pattern.type === 'positive'
                              ? 'bg-gradient-to-r from-green-900/40 to-orange-900/40 border-green-500'
                              : 'bg-gradient-to-r from-orange-900/40 to-red-900/40 border-orange-500'
                          }`}
                        >
                          <h4 className="font-bold text-orange-200 mb-1 text-lg">{pattern.title}</h4>
                          <p className="text-sm text-orange-300">{pattern.description}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {stats && stats.recentMoods.length > 0 && (
                  <div className="bg-gradient-to-r from-orange-900/40 to-black/70 border-2 border-orange-500 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-2xl font-bold text-halloween-primary mb-4 flex items-center gap-2">
                      <BarChart className="w-6 h-6 text-orange-400" />
                      Mood Ultimi 7 Giorni
                    </h3>
                    <div className="space-y-3">
                      {stats.recentMoods.slice(-7).reverse().map((entry, idx) => (
                        <div key={idx} className="flex items-center gap-3">
                          <div className="w-32 text-sm text-orange-300 font-semibold">
                            {new Date(entry.date).toLocaleDateString('it-IT', { weekday: 'short', day: 'numeric', month: 'short' })}
                          </div>
                          <div className="flex-1 bg-black/60 border-2 border-orange-600 rounded-full h-10 overflow-hidden">
                            <div
                              className={`h-full flex items-center px-3 text-white font-semibold ${
                                entry.mood >= 4 ? 'bg-gradient-to-r from-green-600 to-orange-500' :
                                entry.mood === 3 ? 'bg-gradient-to-r from-yellow-600 to-orange-600' :
                                'bg-gradient-to-r from-red-600 to-orange-600'
                              }`}
                              style={{ width: `${(entry.mood / 5) * 100}%` }}
                            >
                              {entry.emoji} {entry.name}
                            </div>
                          </div>
                          <div className="w-12 text-right font-bold text-orange-200 text-lg">
                            {entry.mood}/5
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div className="bg-gradient-to-br from-orange-900/40 to-black/60 p-6 rounded-2xl border-2 border-orange-500 shadow-lg">
                  <h3 className="text-2xl font-bold text-halloween-primary mb-4 flex items-center gap-2">
                    <Pumpkin className="w-8 h-8" />
                    Genera Nuovo Report
                  </h3>

                  <div className="text-center py-6">
                    <p className="text-orange-200 mb-4 text-lg">
                      Genera un report personalizzato basato sui tuoi dati
                    </p>
                    <button
                      onClick={handleGenerateReport}
                      disabled={generatingReport}
                      className="flex items-center justify-center gap-2 mx-auto px-8 py-4 bg-gradient-to-r from-orange-600 to-red-700 border-2 border-orange-400 text-white rounded-xl font-bold text-lg hover:from-orange-500 hover:to-red-600 transition-all transform hover:scale-105 shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {generatingReport ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          Generazione in corso...
                        </>
                      ) : (
                        <>
                          <Sparkles className="w-5 h-5" />
                          Genera Report
                        </>
                      )}
                    </button>
                  </div>
                </div>

                {uploadedImages.length > 0 && (
                  <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <Camera className="w-6 h-6" />
                      Galleria Lavori ({uploadedImages.length})
                    </h3>
                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {uploadedImages.map(img => (
                        <div key={img.id} className="bg-black/40 border border-orange-700/30 rounded-lg overflow-hidden shadow hover:shadow-lg transition-shadow">
                          <img src={img.dataUrl} alt="Lavoro" className="w-full h-48 object-cover" />
                          <div className="p-4 space-y-3">
                            <div>
                              <p className="text-sm font-semibold text-orange-300">{img.exerciseTitle}</p>
                              <p className="text-xs text-orange-400/70">{new Date(img.uploadDate).toLocaleDateString('it-IT')}</p>
                            </div>

                            {img.aiComment && (
                              <div className="bg-purple-900/30 border border-purple-600/30 rounded-lg p-3">
                                <p className="text-xs text-orange-200 leading-relaxed">{img.aiComment}</p>
                              </div>
                            )}

                            <div className="flex gap-2">
                              <button
                                onClick={() => {
                                  const text = `üé® *${img.exerciseTitle}*\n\n${img.aiComment || 'Nessun commento disponibile'}\n\n_Creato con Artist Mental Health Coach_`;
                                  const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
                                  window.open(whatsappUrl, '_blank');
                                }}
                                className="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-semibold transition-colors flex items-center justify-center gap-2"
                                title="Condividi su WhatsApp"
                              >
                                <Share2 className="w-4 h-4" />
                                WhatsApp
                              </button>
                              <button
                                onClick={() => deleteImage(img.id)}
                                className="bg-red-900/50 hover:bg-red-900/70 text-red-300 px-3 py-2 rounded-lg transition-colors"
                                title="Elimina immagine"
                              >
                                <Trash2 className="w-4 h-4" />
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {savedReports.length > 0 && (
                  <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 p-6 rounded-2xl shadow-lg">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <FileText className="w-6 h-6 text-purple-600" />
                      Report Storici ({savedReports.length})
                    </h3>
                    <div className="space-y-4">
                      {savedReports.map(report => (
                        <div
                          key={report.id}
                          className="bg-gradient-to-br from-orange-900/40 to-black/60 p-4 rounded-xl border-2 border-purple-200 hover:shadow-md transition-shadow cursor-pointer"
                          onClick={() => {
                            setCurrentReport(report);
                            setShowReportModal(true);
                          }}
                        >
                          <div className="flex justify-between items-start mb-3">
                            <div className="flex items-center gap-2">
                              <Bot className="w-5 h-5 text-purple-600" />
                              <span className="font-semibold text-gray-800">
                                {new Date(report.date).toLocaleDateString('it-IT', {
                                  day: 'numeric',
                                  month: 'short',
                                  year: 'numeric',
                                  hour: '2-digit',
                                  minute: '2-digit'
                                })}
                              </span>
                            </div>
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                const updatedReports = savedReports.filter(r => r.id !== report.id);
                                setSavedReports(updatedReports);
                                localStorage.setItem('aiReports', JSON.stringify(updatedReports));
                              }}
                              className="p-1 hover:bg-red-100 rounded-lg transition-colors"
                              title="Elimina report"
                            >
                              <Trash2 className="w-4 h-4 text-red-500" />
                            </button>
                          </div>

                          <div className="grid grid-cols-3 gap-3 mb-3 text-sm">
                            <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40/60 rounded-lg p-2 text-center">
                              <div className="font-bold text-purple-600">{report.stats.totalMoods}</div>
                              <div className="text-xs text-gray-600">Mood</div>
                            </div>
                            <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40/60 rounded-lg p-2 text-center">
                              <div className="font-bold text-pink-600">{report.stats.avgMood.toFixed(1)}/5</div>
                              <div className="text-xs text-gray-600">Media</div>
                            </div>
                            <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40/60 rounded-lg p-2 text-center">
                              <div className={`font-bold ${report.stats.trend > 0 ? 'text-green-600' : report.stats.trend < 0 ? 'text-orange-600' : 'text-gray-600'}`}>
                                {report.stats.trend > 0 ? '+' : ''}{report.stats.trend.toFixed(1)}%
                              </div>
                              <div className="text-xs text-gray-600">Trend</div>
                            </div>
                          </div>

                          <p className="text-sm text-gray-600 line-clamp-2">
                            {report.content.substring(0, 150)}...
                          </p>

                          <div className="mt-3 text-sm text-purple-600 font-semibold flex items-center gap-1">
                            Leggi report completo
                            <ChevronRight className="w-4 h-4" />
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <button
                  onClick={() => setCurrentView('home')}
                  className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                >
                  ‚Üê Torna Home
                </button>
              </div>
            );
          };

          const ReportModal = () => {
            if (!showReportModal || !currentReport) return null;

            return (
              <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 rounded-2xl max-w-3xl w-full max-h-[85vh] overflow-y-auto shadow-2xl animate-slideIn">
                  <div className="sticky top-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-2xl flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <Brain className="w-8 h-8" />
                      <div>
                        <h2 className="text-2xl font-bold">Report Generato</h2>
                        <p className="text-sm text-white/80">
                          {new Date(currentReport.date).toLocaleDateString('it-IT', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                          })}
                        </p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowReportModal(false)}
                      className="p-2 hover:bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <div className="p-8">
                    <div className="prose prose-sm max-w-none text-gray-700 whitespace-pre-line leading-relaxed">
                      {currentReport.content}
                    </div>

                    <div className="mt-6 pt-6 border-t border-orange-600/40 grid grid-cols-3 gap-4">
                      <div className="text-center">
                        <div className="text-2xl font-bold text-purple-600">{currentReport.stats.totalMoods}</div>
                        <div className="text-sm text-gray-600">Mood tracciati</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-pink-600">{currentReport.stats.avgMood.toFixed(1)}/5</div>
                        <div className="text-sm text-gray-600">Mood medio</div>
                      </div>
                      <div className="text-center">
                        <div className="text-2xl font-bold text-blue-600">
                          {currentReport.stats.trend > 0 ? 'üìà' : currentReport.stats.trend < 0 ? 'üìâ' : '‚û°Ô∏è'}
                        </div>
                        <div className="text-sm text-gray-600">Trend</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const GuideModal = () => {
            if (!showGuide) return null;

            return (
              <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                  <div className="sticky top-0 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6 rounded-t-2xl flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <HelpCircle className="w-8 h-8" />
                      <div>
                        <h2 className="text-2xl font-bold">Guida e Istruzioni</h2>
                        <p className="text-sm text-white/80">Come usare Artist Mental Health Coach</p>
                      </div>
                    </div>
                    <button
                      onClick={() => setShowGuide(false)}
                      className="p-2 hover:bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <div className="p-8 space-y-8">
                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Heart className="w-7 h-7 text-red-500" />
                        1. Traccia il tuo Mood
                      </h3>
                      <div className="bg-red-50 p-5 rounded-xl space-y-3">
                        <p className="text-orange-200"><strong>Cosa fa:</strong> Registra come ti senti ogni giorno usando 5 emoji (da pessimo a ottimo).</p>
                        <p className="text-orange-200"><strong>Come usarlo:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Clicca su "Traccia Mood" dalla home</li>
                          <li>Seleziona l'emoji che rappresenta il tuo stato d'animo</li>
                          <li>Aggiungi una nota opzionale per ricordare perch√© ti senti cos√¨</li>
                          <li>I tuoi mood vengono salvati automaticamente</li>
                        </ul>
                        <p className="text-orange-200"><strong>Perch√© √® utile:</strong> Tenere traccia del tuo umore ti aiuta a identificare pattern e capire cosa influenza il tuo benessere.</p>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <BookOpen className="w-7 h-7 text-blue-500" />
                        2. Diario Personale
                      </h3>
                      <div className="bg-blue-50 p-5 rounded-xl space-y-3">
                        <p className="text-orange-200"><strong>Cosa fa:</strong> Scrivi pensieri, riflessioni e esperienze quotidiane.</p>
                        <p className="text-orange-200"><strong>Come usarlo:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Clicca su "Diario" dalla home</li>
                          <li>Scrivi liberamente nel campo di testo</li>
                          <li>Premi "Salva Diario" per conservare la tua riflessione</li>
                          <li>Visualizza i tuoi diari precedenti scorrendo in basso</li>
                        </ul>
                        <p className="text-orange-200"><strong>Perch√© √® utile:</strong> La scrittura terapeutica aiuta a processare emozioni e ridurre lo stress.</p>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Palette className="w-7 h-7 text-purple-500" />
                        3. Esercizi Creativi
                      </h3>
                      <div className="bg-purple-50 p-5 rounded-xl space-y-3">
                        <p className="text-orange-200"><strong>Cosa fa:</strong> Centinaia di esercizi creativi specifici per Studenti e Artisti.</p>
                        <p className="text-orange-200"><strong>Come usarlo:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Clicca su "Esercizi" dalla home</li>
                          <li>Scegli una categoria (Disegno, Pittura, Scultura, etc.)</li>
                          <li>Ogni esercizio ha 3 varianti con esempi</li>
                          <li>Clicca "Genera Nuovo" per ottenere nuove idee (richiede API)</li>
                        </ul>
                        <p className="text-orange-200"><strong>Funzioni extra:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li><strong>Timer:</strong> Imposta durate (es: "5m", "30m", "1h") per esercizi cronometrati</li>
                          <li><strong>Upload Foto:</strong> Carica immagini dei tuoi lavori e ricevi feedback</li>
                        </ul>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <BarChart className="w-7 h-7 text-green-500" />
                        4. Analisi e Insights
                      </h3>
                      <div className="bg-green-50 p-5 rounded-xl space-y-3">
                        <p className="text-orange-200"><strong>Cosa fa:</strong> Analizza i tuoi dati e identifica pattern nel tuo benessere.</p>
                        <p className="text-orange-200"><strong>Cosa trovi:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li><strong>Statistiche:</strong> Mood totali tracciati, media, trend in aumento/calo</li>
                          <li><strong>Pattern:</strong> Giorni della settimana migliori/peggiori, streak positivi</li>
                          <li><strong>Grafico:</strong> Visualizzazione ultimi 7 giorni</li>
                          <li><strong>Report:</strong> Analisi personalizzata con consigli (richiede API)</li>
                          <li><strong>Report Storici:</strong> Tutti i report generati in passato</li>
                          <li><strong>Galleria:</strong> Tutte le tue immagini caricate</li>
                        </ul>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Key className="w-7 h-7 text-yellow-500" />
                        5. Configurazione API (Opzionale)
                      </h3>
                      <div className="bg-yellow-50 p-5 rounded-xl space-y-3">
                        <p className="text-orange-200"><strong>Cosa fa:</strong> Abilita funzionalit√† avanzate usando Google Gemini.</p>
                        <p className="text-orange-200"><strong>Come configurare:</strong></p>
                        <ol className="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                          <li>Vai su <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener" className="text-blue-600 underline">Google AI Studio</a></li>
                          <li>Accedi con il tuo account Google</li>
                          <li>Clicca "Create API Key"</li>
                          <li>Copia la chiave generata</li>
                          <li>Torna all'app e clicca "Configura API Key", poi incolla la chiave</li>
                        </ol>
                        <p className="text-orange-200"><strong>Funzioni sbloccate con API:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Generazione infinita di nuovi esercizi creativi</li>
                          <li>Feedback sulle tue opere caricate</li>
                          <li>Report personalizzati basati sui tuoi dati</li>
                        </ul>
                        <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 p-4 rounded-lg border-l-4 border-yellow-500 mt-3">
                          <p className="text-sm text-gray-700"><strong>üîí Privacy:</strong> La tua API key viene salvata solo sul tuo dispositivo (localStorage). Non viene mai inviata a server esterni se non direttamente a Google Gemini.</p>
                          <p className="text-sm text-gray-700 mt-2"><strong>üí∞ Costo:</strong> Google Gemini ha un tier gratuito generoso. Perfetto per uso personale!</p>
                        </div>
                      </div>
                    </section>

                    <section>
                      <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <Camera className="w-7 h-7 text-indigo-500" />
                        6. Upload Foto (iPhone Compatible)
                      </h3>
                      <div className="bg-indigo-50 p-5 rounded-xl space-y-3">
                        <p className="text-orange-200"><strong>Cosa fa:</strong> Carica foto delle tue opere e ricevi feedback.</p>
                        <p className="text-orange-200"><strong>Come usarlo:</strong></p>
                        <ul className="list-disc list-inside space-y-2 text-gray-700 ml-4">
                          <li>Vai in un esercizio specifico</li>
                          <li>Clicca "Seleziona Immagine"</li>
                          <li>Scegli foto dalla galleria o scatta una nuova</li>
                          <li>L'immagine viene automaticamente ridimensionata (ottimizzato per iPhone)</li>
                          <li>Se API attiva, ricevi un feedback personalizzato</li>
                        </ul>
                        <p className="text-orange-200"><strong>Formati supportati:</strong> JPG, PNG, HEIC (foto iPhone native)</p>
                      </div>
                    </section>

                    <section className="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-xl">
                      <h3 className="text-xl font-bold text-gray-800 mb-3">üí° Consigli Utili</h3>
                      <ul className="space-y-2 text-gray-700">
                        <li>‚úÖ Traccia il tuo mood ogni giorno per ottenere analisi accurate</li>
                        <li>‚úÖ Scrivi nel diario quando ti senti sopraffatto - aiuta!</li>
                        <li>‚úÖ Prova diversi esercizi creativi per trovare ci√≤ che ti rilassa</li>
                        <li>‚úÖ Usa il timer per sessioni di lavoro concentrate</li>
                        <li>‚úÖ Carica foto dei tuoi lavori per tracciare progressi</li>
                        <li>‚úÖ Genera report ogni settimana per vedere i tuoi progressi</li>
                      </ul>
                    </section>

                    <section className="text-center pt-4 border-t border-orange-600/40">
                      <p className="text-orange-300">
                        Sviluppato con ‚ù§Ô∏è per Studenti e Artisti
                      </p>
                      <p className="text-sm text-orange-400 mt-2">
                        Hai domande o suggerimenti? <button onClick={() => { setShowGuide(false); setShowContactForm(true); }} className="text-purple-400 hover:text-purple-300 underline font-semibold">Contattami</button>
                      </p>
                    </section>
                  </div>
                </div>
              </div>
            );
          };

          const ContactFormModal = () => {
            const [formData, setFormData] = useState({
              name: userProfile?.name || '',
              email: userProfile?.email || '',
              message: ''
            });
            const [sending, setSending] = useState(false);
            const [sent, setSent] = useState(false);
            const [error, setError] = useState('');

            if (!showContactForm) return null;

            const handleSubmit = async (e) => {
              e.preventDefault();
              setSending(true);
              setError('');

              try {
                // Usa Web3Forms per inviare email direttamente
                const response = await fetch('https://api.web3forms.com/submit', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    access_key: 'c99e581c-6e45-4d7a-b889-abeb30f38fb1',
                    name: formData.name,
                    email: formData.email,
                    message: formData.message,
                    subject: 'üé® Nuovo messaggio da Artist Mental Health Coach',
                  })
                });

                const result = await response.json();

                if (result.success) {
                  setSent(true);
                  setTimeout(() => {
                    setShowContactForm(false);
                    setSent(false);
                    setFormData({
                      name: userProfile?.name || '',
                      email: userProfile?.email || '',
                      message: ''
                    });
                  }, 3000);
                } else {
                  setError('Errore nell\'invio. Riprova pi√π tardi.');
                }
              } catch (err) {
                setError('Errore di connessione. Verifica la tua rete.');
              } finally {
                setSending(false);
              }
            };

            return (
              <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 rounded-2xl max-w-lg w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-2xl flex justify-between items-center">
                    <div>
                      <h2 className="text-2xl font-bold">üì¨ Contattami</h2>
                      <p className="text-sm text-white/80">Invia un messaggio o suggerimento</p>
                    </div>
                    <button
                      onClick={() => setShowContactForm(false)}
                      className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <div className="p-6">
                    {sent ? (
                      <div className="text-center py-8">
                        <CheckCircle className="w-16 h-16 text-green-400 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-green-300 mb-2">Messaggio inviato!</h3>
                        <p className="text-orange-300">Ti risponder√≤ al pi√π presto. Grazie! üé®</p>
                      </div>
                    ) : (
                      <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                          <label className="block text-orange-300 font-semibold mb-2">Nome</label>
                          <input
                            type="text"
                            required
                            value={formData.name}
                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                            className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                            placeholder="Il tuo nome"
                          />
                        </div>

                        <div>
                          <label className="block text-orange-300 font-semibold mb-2">Email</label>
                          <input
                            type="email"
                            required
                            value={formData.email}
                            onChange={(e) => setFormData({...formData, email: e.target.value})}
                            className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                            placeholder="tua@email.com"
                          />
                        </div>

                        <div>
                          <label className="block text-orange-300 font-semibold mb-2">Messaggio</label>
                          <textarea
                            required
                            value={formData.message}
                            onChange={(e) => setFormData({...formData, message: e.target.value})}
                            rows="5"
                            className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none resize-none placeholder-orange-400/50"
                            placeholder="Scrivi il tuo messaggio, suggerimento o domanda..."
                          />
                        </div>

                        {error && (
                          <div className="bg-red-900/30 border border-red-500 text-red-300 p-3 rounded-lg text-sm">
                            {error}
                          </div>
                        )}

                        <button
                          type="submit"
                          disabled={sending}
                          className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                          {sending ? (
                            <>
                              <RefreshCw className="w-5 h-5 animate-spin" />
                              Invio in corso...
                            </>
                          ) : (
                            <>
                              üì§ Invia Messaggio
                            </>
                          )}
                        </button>
                      </form>
                    )}
                  </div>
                </div>
              </div>
            );
          };

          const ProfileBenefitsModal = () => {
            if (!showProfileBenefits) return null;

            return (
              <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-purple-900/30 to-black/70 border border-purple-600/40 rounded-2xl max-w-lg w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-2xl">
                    <h2 className="text-2xl font-bold flex items-center gap-2">
                      <Sparkles className="w-8 h-8" />
                      Perch√© creare un Profilo?
                    </h2>
                    <p className="text-sm text-white/80 mt-1">Scopri i vantaggi di avere un profilo personalizzato</p>
                  </div>

                  <div className="p-6 space-y-4">
                    <div className="space-y-3">
                      <div className="flex items-start gap-3 bg-purple-900/20 p-4 rounded-lg border border-purple-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-orange-300">Saluto personalizzato</h3>
                          <p className="text-sm text-orange-200">Ti accoglieremo con il tuo nome ogni volta</p>
                        </div>
                      </div>

                      <div className="flex items-start gap-3 bg-purple-900/20 p-4 rounded-lg border border-purple-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-orange-300">Form contatto rapido</h3>
                          <p className="text-sm text-orange-200">Email pre-compilata quando mi contatti</p>
                        </div>
                      </div>

                      <div className="flex items-start gap-3 bg-purple-900/20 p-4 rounded-lg border border-purple-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-orange-300">Badge Utente Registrato</h3>
                          <p className="text-sm text-orange-200">Mostra il tuo status speciale nell'app</p>
                        </div>
                      </div>

                      <div className="flex items-start gap-3 bg-purple-900/20 p-4 rounded-lg border border-purple-600/30">
                        <CheckCircle className="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5" />
                        <div>
                          <h3 className="font-semibold text-orange-300">Dati sempre tuoi</h3>
                          <p className="text-sm text-orange-200">Tutto salvato localmente sul tuo dispositivo</p>
                        </div>
                      </div>
                    </div>

                    <div className="bg-yellow-900/30 border-l-4 border-yellow-500 p-4 rounded">
                      <p className="text-sm text-yellow-200">
                        <strong>100% Gratuito</strong> ‚Ä¢ Nessuna email di spam ‚Ä¢ Privacy garantita
                      </p>
                    </div>

                    <div className="flex gap-3">
                      <button
                        onClick={() => {
                          setShowProfileBenefits(false);
                          setShowProfileModal(true);
                        }}
                        className="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                      >
                        ‚ú® Crea il mio Profilo
                      </button>
                      <button
                        onClick={() => setShowProfileBenefits(false)}
                        className="px-6 py-3 bg-orange-900/50 text-orange-200 rounded-lg hover:bg-orange-900/70 transition-colors border border-orange-600"
                      >
                        Forse dopo
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const ProfileModal = () => {
            const [formData, setFormData] = useState({ name: '', email: '' });
            const [error, setError] = useState('');

            if (!showProfileModal) return null;

            const handleSubmit = (e) => {
              e.preventDefault();
              if (!formData.name.trim() || !formData.email.trim()) {
                setError('Compila tutti i campi');
                return;
              }

              setUserProfile({
                name: formData.name,
                email: formData.email,
                createdAt: new Date().toISOString()
              });

              setShowProfileModal(false);
            };

            return (
              <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 rounded-2xl max-w-md w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-2xl flex justify-between items-center">
                    <div>
                      <h2 className="text-2xl font-bold">üé® Crea il tuo Profilo</h2>
                      <p className="text-sm text-white/80">Servono solo 2 informazioni</p>
                    </div>
                    <button
                      onClick={() => setShowProfileModal(false)}
                      className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <form onSubmit={handleSubmit} className="p-6 space-y-4">
                    <div>
                      <label className="block text-orange-300 font-semibold mb-2">Come ti chiami?</label>
                      <input
                        type="text"
                        required
                        value={formData.name}
                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                        placeholder="Il tuo nome"
                      />
                    </div>

                    <div>
                      <label className="block text-orange-300 font-semibold mb-2">Email</label>
                      <input
                        type="email"
                        required
                        value={formData.email}
                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                        placeholder="tua@email.com"
                      />
                      <p className="text-xs text-orange-400 mt-1">
                        üîí Salvata solo sul tuo dispositivo
                      </p>
                    </div>

                    {error && (
                      <div className="bg-red-900/30 border border-red-500 text-red-300 p-3 rounded-lg text-sm">
                        {error}
                      </div>
                    )}

                    <button
                      type="submit"
                      className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity"
                    >
                      ‚ú® Crea Profilo
                    </button>
                  </form>
                </div>
              </div>
            );
          };

          const FirebaseAuthModal = () => {
            const [isLogin, setIsLogin] = useState(true);
            const [formData, setFormData] = useState({ email: '', password: '', name: '' });
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            if (!showFirebaseAuth) return null;

            const handleSubmit = async (e) => {
              e.preventDefault();
              setError('');
              setLoading(true);

              try {
                if (isLogin) {
                  // Login
                  await auth.signInWithEmailAndPassword(formData.email, formData.password);
                  setShowFirebaseAuth(false);
                } else {
                  // Registrazione
                  const userCredential = await auth.createUserWithEmailAndPassword(formData.email, formData.password);
                  // Aggiorna il profilo con il nome
                  await userCredential.user.updateProfile({
                    displayName: formData.name
                  });
                  setShowFirebaseAuth(false);
                }
              } catch (err) {
                console.error('Errore auth:', err);
                if (err.code === 'auth/email-already-in-use') {
                  setError('Email gi√† registrata. Prova ad accedere.');
                } else if (err.code === 'auth/weak-password') {
                  setError('Password troppo debole. Usa almeno 6 caratteri.');
                } else if (err.code === 'auth/invalid-email') {
                  setError('Email non valida.');
                } else if (err.code === 'auth/user-not-found' || err.code === 'auth/wrong-password') {
                  setError('Email o password errati.');
                } else {
                  setError('Errore di autenticazione. Riprova.');
                }
              } finally {
                setLoading(false);
              }
            };

            return (
              <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
                <div className="bg-gradient-to-r from-purple-900/30 to-black/70 border border-purple-600/40 rounded-2xl max-w-md w-full shadow-2xl">
                  <div className="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-t-2xl flex justify-between items-center">
                    <div>
                      <h2 className="text-2xl font-bold flex items-center gap-2">
                        <Cloud className="w-7 h-7" />
                        {isLogin ? 'Accedi' : 'Registrati'}
                      </h2>
                      <p className="text-sm text-white/80">Sincronizza i tuoi dati su cloud</p>
                    </div>
                    <button
                      onClick={() => setShowFirebaseAuth(false)}
                      className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                    >
                      <X className="w-6 h-6" />
                    </button>
                  </div>

                  <form onSubmit={handleSubmit} className="p-6 space-y-4">
                    {!isLogin && (
                      <div>
                        <label className="block text-orange-300 font-semibold mb-2">Nome</label>
                        <input
                          type="text"
                          required
                          value={formData.name}
                          onChange={(e) => setFormData({...formData, name: e.target.value})}
                          className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                          placeholder="Il tuo nome"
                        />
                      </div>
                    )}

                    <div>
                      <label className="block text-orange-300 font-semibold mb-2">Email</label>
                      <input
                        type="email"
                        required
                        value={formData.email}
                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                        placeholder="tua@email.com"
                      />
                    </div>

                    <div>
                      <label className="block text-orange-300 font-semibold mb-2">Password</label>
                      <input
                        type="password"
                        required
                        value={formData.password}
                        onChange={(e) => setFormData({...formData, password: e.target.value})}
                        className="w-full px-4 py-2 border-2 border-orange-600 bg-black/50 text-orange-100 rounded-lg focus:border-purple-500 focus:outline-none placeholder-orange-400/50"
                        placeholder="Minimo 6 caratteri"
                        minLength="6"
                      />
                    </div>

                    {error && (
                      <div className="bg-red-900/30 border border-red-500 text-red-300 p-3 rounded-lg text-sm">
                        {error}
                      </div>
                    )}

                    <button
                      type="submit"
                      disabled={loading}
                      className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      {loading ? (
                        <>
                          <RefreshCw className="w-5 h-5 animate-spin" />
                          {isLogin ? 'Accesso...' : 'Registrazione...'}
                        </>
                      ) : (
                        <>
                          <Cloud className="w-5 h-5" />
                          {isLogin ? 'Accedi' : 'Registrati'}
                        </>
                      )}
                    </button>

                    <div className="text-center">
                      <button
                        type="button"
                        onClick={() => {
                          setIsLogin(!isLogin);
                          setError('');
                          setFormData({ email: '', password: '', name: '' });
                        }}
                        className="text-orange-300 hover:text-orange-200 text-sm underline"
                      >
                        {isLogin ? 'Non hai un account? Registrati' : 'Hai gi√† un account? Accedi'}
                      </button>
                    </div>

                    <div className="bg-blue-900/30 border-l-4 border-blue-500 p-3 rounded">
                      <p className="text-xs text-blue-200">
                        <strong>üîí Sicuro e privato</strong> ‚Ä¢ I tuoi dati sono sincronizzati su Firebase Cloud ‚Ä¢ Accessibili da qualsiasi dispositivo
                      </p>
                    </div>
                  </form>
                </div>
              </div>
            );
          };

          const ApiSetupModal = () => (
            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
              <div className="bg-gradient-to-r from-orange-900/30 to-black/70 border border-orange-600/40 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 shadow-2xl">
                <div className="flex justify-between items-start mb-6">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">ü§ñ Configurazione Gemini API</h2>
                    <p className="text-orange-300">Attiva API per esercizi personalizzati infiniti</p>
                  </div>
                  <button 
                    onClick={() => setShowApiSetup(false)} 
                    className="p-2 hover:bg-orange-900/50 rounded-lg transition-colors"
                  >
                    <X className="w-6 h-6" />
                  </button>
                </div>

                <div className="space-y-6">
                  <div className="bg-gradient-to-br from-orange-900/40 to-black/60 p-6 rounded-xl border-2 border-purple-200">
                    <h3 className="font-bold text-lg mb-3 flex items-center gap-2">
                      <Sparkles className="w-5 h-5 text-purple-600" />
                      Vantaggi Modalit√† API
                    </h3>
                    <ul className="space-y-2 text-gray-700">
                      <li className="flex items-start gap-2">
                        <CheckCircle className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                        <span><strong>Esercizi infiniti:</strong> Contenuti sempre nuovi e diversi</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <CheckCircle className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                        <span><strong>Personalizzati:</strong> Esercizi specifici per il tuo contesto artistico</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <CheckCircle className="w-5 h-5 text-green-600 mt-0.5 flex-shrink-0" />
                        <span><strong>Gratis:</strong> Google Gemini API ha un tier gratuito generoso (60 richieste/minuto)</span>
                      </li>
                    </ul>
                  </div>

                  <div className="space-y-4">
                    <h3 className="font-bold text-lg">üìã Setup Veloce (5 minuti)</h3>
                    <div className="space-y-3">
                      {[
                        { 
                          n: 1, 
                          title: "Vai su Google AI Studio", 
                          content: <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline text-sm flex items-center gap-1">https://aistudio.google.com/app/apikey <span className="text-xs">üîó</span></a> 
                        },
                        { n: 2, title: "Accedi con Google", content: "Usa qualsiasi account Gmail personale" },
                        { n: 3, title: 'Click "Create API Key"', content: "Scegli progetto esistente o crea nuovo" },
                        { n: 4, title: "Copia la tua API Key", content: "Stringa tipo: AIzaSy..." },
                        { n: 5, title: "Incolla qui sotto", content: "Salvata solo sul tuo dispositivo, 100% privata" }
                      ].map(step => (
                        <div key={step.n} className="flex gap-3">
                          <div className="flex-shrink-0 w-8 h-8 bg-purple-500 text-white rounded-full flex items-center justify-center font-bold text-sm">
                            {step.n}
                          </div>
                          <div className="flex-1">
                            <p className="font-semibold mb-1">{step.title}</p>
                            <div className="text-sm text-gray-600">{step.content}</div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block font-semibold mb-2 flex items-center gap-2">
                      <Key className="w-5 h-5" />
                      Inserisci la tua API Key
                    </label>
                    <input
                      type="password"
                      value={geminiApiKey}
                      onChange={(e) => setGeminiApiKey(e.target.value)}
                      placeholder="AIzaSy..."
                      className="w-full px-4 py-3 border-2 border-orange-600 rounded-lg focus:border-purple-500 focus:outline-none font-mono text-sm"
                    />
                    <p className="text-xs text-gray-500 mt-2 flex items-center gap-1">
                      üîí Salvata solo localmente nel browser, mai inviata a server esterni
                    </p>
                  </div>

                  <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    <div className="flex gap-3">
                      <AlertCircle className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
                      <div className="text-sm text-yellow-800">
                        <p className="font-semibold mb-1">‚ö†Ô∏è Sicurezza</p>
                        <p>Non condividere mai la tua API key. Il tier gratuito di Gemini ha limiti che proteggono da abusi accidentali.</p>
                      </div>
                    </div>
                  </div>

                  <div className="flex gap-3 flex-wrap">
                    <button
                      onClick={saveApiKey}
                      disabled={!geminiApiKey.trim()}
                      className="flex-1 min-w-[150px] bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      üíæ Salva API Key
                    </button>
                    <button
                      onClick={() => setShowApiSetup(false)}
                      className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
                    >
                      Chiudi
                    </button>
                  </div>

                  {geminiApiKey && (
                    <div className="bg-green-50 border-l-4 border-green-400 p-4 rounded animate-fadeIn">
                      <div className="flex items-center gap-2 text-green-800">
                        <CheckCircle className="w-5 h-5" />
                        <span className="font-semibold">API Key configurata!</span>
                      </div>
                      <p className="text-sm text-green-700 mt-1">
                        Ora puoi attivare la modalit√† API negli esercizi per generare contenuti infiniti 
                      </p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );

          return (
            <div className="min-h-screen bg-black p-4">
              {/* Bottoni Profilo e Firebase Fissi */}
              <div className="fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-[200px]">
                {/* Bottone Cambia Versione */}
                <a
                  href="../index.html"
                  className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all border-2 border-purple-400 flex items-center gap-2 justify-center text-sm font-semibold"
                  title="Cambia lingua o tema"
                >
                  <span>üåç</span>
                  <span>Cambia Versione</span>
                </a>
                {firebaseUser ? (
                  <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded-full shadow-lg border-2 border-blue-400 flex items-center gap-2">
                    <Cloud className="w-5 h-5" />
                    <span className="font-semibold">{firebaseUser.displayName || firebaseUser.email}</span>
                    <button
                      onClick={() => auth.signOut()}
                      className="ml-2 p-1 hover:bg-white/20 rounded-full transition-colors"
                      title="Logout"
                    >
                      <LogOut className="w-4 h-4" />
                    </button>
                  </div>
                ) : userProfile ? (
                  <>
                    <div className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-full shadow-lg border-2 border-purple-400 flex items-center gap-2">
                      <User className="w-5 h-5" />
                      <span className="font-semibold">Ciao, {userProfile.name}!</span>
                    </div>
                    <button
                      onClick={() => setShowFirebaseAuth(true)}
                      className="bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-full shadow-lg hover:shadow-xl transition-all border-2 border-blue-400 flex items-center gap-2"
                      title="Sincronizza su Cloud"
                    >
                      <Cloud className="w-5 h-5" />
                      <span className="font-semibold text-sm">Sincronizza Cloud</span>
                    </button>
                  </>
                ) : (
                  <>
                    <button
                      onClick={() => setShowFirebaseAuth(true)}
                      className="bg-gradient-to-r from-orange-500/90 via-orange-600/90 to-orange-700/90 md:from-orange-500 md:via-orange-600 md:to-orange-700 text-white px-4 py-2 md:px-6 md:py-3 rounded-xl shadow-2xl hover:shadow-3xl hover:scale-105 transition-all border-2 border-orange-400/50 backdrop-blur-sm spooky-glow animate-pulse"
                    >
                      <div className="flex items-center gap-2 font-bold">
                        <span className="text-xl md:text-2xl">üéÉ</span>
                        <div className="text-left">
                          <div className="text-xs md:text-sm leading-tight">Registrati GRATIS</div>
                          <div className="text-[10px] md:text-xs font-normal opacity-90">Ottieni i dolcetti</div>
                        </div>
                      </div>
                    </button>
                    <button
                      onClick={() => setShowProfileBenefits(true)}
                      className="bg-gray-700/60 md:bg-gray-700/80 hover:bg-gray-600/80 text-gray-300 px-3 py-1.5 md:px-4 md:py-2 rounded-lg shadow-md hover:shadow-lg transition-all border border-gray-600/50 backdrop-blur-sm flex items-center gap-2 text-xs md:text-sm"
                    >
                      <span>üë§</span>
                      <span className="font-medium">Solo Visita <span className="text-[10px] md:text-xs opacity-70">(niente caramelle)</span></span>
                    </button>
                  </>
                )}
              </div>

              {/* Ragno animato controllato */}
              <div
                className={`spider-crawl ${spiderScared ? 'spider-scared' : spiderTarget ? 'spider-run-to-target' : ''}`}
                onClick={(e) => {
                  e.stopPropagation();
                  // Calcola posizione casuale lontana per scappare
                  const randomX = Math.random() * 100;
                  const randomY = Math.random() * 100;
                  setSpiderScared({ x: randomX, y: randomY });
                  setSpiderTarget(null);

                  // Torna normale dopo che ha finito di scappare
                  setTimeout(() => {
                    setSpiderScared(false);
                  }, 3000);
                }}
                style={{
                  ...(spiderTarget || spiderScared) ? {
                    top: `${(spiderTarget || spiderScared)?.y || 0}%`,
                    left: `${(spiderTarget || spiderScared)?.x || 0}%`
                  } : {},
                  cursor: 'pointer',
                  pointerEvents: 'auto'
                }}
              >
                üï∑Ô∏è
              </div>

              <div className="max-w-5xl mx-auto py-6">
                <div className="bg-gradient-to-br from-gray-900 via-orange-950 to-black rounded-3xl shadow-2xl p-6 md:p-8 border-2 border-orange-600/30">
                  {currentView === 'home' && <HomeView />}
                  {currentView === 'mood' && <MoodView />}
                  {currentView === 'journal' && <JournalView />}
                  {currentView === 'exercises' && <ExercisesView />}
                  {currentView === 'exercise-detail' && <ExerciseDetailView />}
                  {currentView === 'progress' && <ProgressView />}
                  {currentView === 'insights' && <InsightsView />}
                </div>

                <div className="text-center mt-6 text-orange-300 text-sm space-y-4">
                  <p className="text-halloween-primary font-bold">üéÉ Artist Mental Health Coach v2.0 - Halloween Edition üéÉ</p>
                  <p className="mt-1 text-halloween-accent">Made with üß° for artists ‚Ä¢ centinaia di esercizi spettrali</p>

                  {/* Bottoni Condivisione e Donazione */}
                  <div className="flex justify-center gap-3 flex-wrap mt-4">
                    <button
                      onClick={() => {
                        const text = `üéÉ *Artist Mental Health Coach* üé®\n\nUn'app gratuita per il benessere mentale dedicata a studenti e artisti!\n\n‚ú® Traccia il tuo mood\nüìù Diario personale\nüñºÔ∏è Analisi AI delle tue opere\nüßò Centinaia di esercizi creativi\n\nProva ora: ${window.location.href}`;
                        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
                        window.open(whatsappUrl, '_blank');
                      }}
                      className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 shadow-lg"
                    >
                      <Share2 className="w-4 h-4" />
                      WhatsApp
                    </button>

                    <button
                      onClick={() => {
                        const shareUrl = window.location.href;
                        const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
                        window.open(facebookUrl, '_blank');
                      }}
                      className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 shadow-lg"
                    >
                      <Share2 className="w-4 h-4" />
                      Facebook
                    </button>

                    <button
                      onClick={() => {
                        alert('Per condividere su Instagram:\n\n1. Fai uno screenshot dell\'app\n2. Apri Instagram\n3. Crea una nuova Storia\n4. Carica lo screenshot\n5. Aggiungi il link: ' + window.location.href);
                      }}
                      className="bg-gradient-to-r from-pink-600 to-purple-700 hover:opacity-90 text-white px-4 py-2 rounded-lg font-semibold transition-opacity flex items-center gap-2 shadow-lg"
                    >
                      <Share2 className="w-4 h-4" />
                      Instagram
                    </button>

                    <button
                      onClick={() => {
                        window.open('https://paypal.me/FrancescoMarianoIT', '_blank');
                      }}
                      className="bg-gradient-to-r from-orange-600 to-red-600 hover:opacity-90 text-white px-4 py-2 rounded-lg font-semibold transition-opacity flex items-center gap-2 shadow-lg"
                    >
                      ‚ù§Ô∏è Supporta il progetto
                    </button>
                  </div>

                  <div className="mt-4 pt-4 border-t border-orange-500/30">
                    <p className="text-orange-200 font-medium">Ideato e sviluppato da: Francesco Mariano</p>
                    <p className="text-orange-400 text-xs mt-1">2023 ‚Ä¢ Edizione Halloween: 31 ottobre 2025</p>
                    <p className="text-orange-300 mt-2">
                      <button
                        onClick={() => setShowContactForm(true)}
                        className="text-halloween-primary hover:text-halloween-accent underline font-semibold"
                      >
                        üì¨ Invia feedback o suggerimenti
                      </button>
                    </p>
                  </div>
                </div>
              </div>

              {showApiSetup && <ApiSetupModal />}
              <ReportModal />
              <GuideModal />
              <ContactFormModal />
              <ProfileBenefitsModal />
              <ProfileModal />
              <FirebaseAuthModal />

              <button
                onClick={() => setShowGuide(true)}
                className="fixed bottom-24 right-6 bg-gradient-to-r from-orange-600 to-purple-700 text-white p-4 rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 z-40 flex items-center gap-2 group spooky-glow border-2 border-orange-500/50"
                title="Guida e Istruzioni"
              >
                <Pumpkin className="w-6 h-6" />
                <span className="hidden group-hover:inline-block font-semibold pr-2 whitespace-nowrap">
                  Guida
                </span>
              </button>

              {apiKeySaved && (
                <div className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-fadeIn z-50">
                  <CheckCircle className="w-5 h-5" />
                  API Key salvata con successo!
                </div>
              )}
            </div>
          );
        };

        ReactDOM.render(<MentalHealthCoachArte />, document.getElementById('root'));
    </script>
</body>
</html>